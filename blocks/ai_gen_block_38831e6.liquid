{% doc %}
  @prompt
    generate a modern mobile friendly items  shopping card section. shopify 2.0, with options to modify it. , add margins left and right for mobile and desktop.
    
     container maximum width 1450px
    
    Create a modern, minimalist shopping cart layout similar to HelloPrint's style.
    
    - Show a large product card with image, title, quantity, delivery time, and editable actions (edit, duplicate, delete).
    - On the right, add an order summary card with subtotals, taxes, and total in bold.
    - Use clean white background, soft shadows, rounded corners, and subtle dividers.
    - Include upsell options below the product (checkboxes with green accent and prices on the right).
    - Add a green ‚ÄúContinue‚Äù button with right arrow icon.
    - Typography: use Barlow or Inter, medium weight, with clear spacing.
    - Keep the layout responsive and visually balanced.
    - Language: English.
    , images always square,
    
    force the section box to be a maximum of 1450px wide. 
    
    in mobile leave 20px margin left and right sides. 
    
    , upsell does not add to the cart summary when i chose it.    
    
    Add a "Recommended Products" module below the cart summary.
    
    - Suggest items related to the current cart contents.
    - Each product card should include image, name, price, and an ‚ÄúAdd to cart‚Äù button.
    - When clicked, the product should be added instantly to the cart without reloading the page.
    - Keep the same clean, minimalist style as the cart page (white background, soft shadows, rounded corners).
    - Responsive and visually consistent with the rest of the design.
    , the recommended products should be detectect automatly based in the category of the products already in the cart. , 
    
    
      - Suggested products must be dynamically based on matching product tags from the current cart items.
      - Each upsell card should include image, title, price, and an ‚ÄúAdd to cart‚Äù button that adds the product instantly (AJAX, no reload).
      - Keep spacing consistent and layout responsive.
    
    - Free Shipping:
      - Add full controls for free shipping logic.
      - When the subtotal is $50 or more, show a green check-circle SVG icon with the text ‚ÄúFREE SHIPPING available‚Äù.
      - When below $50, show a truck SVG icon and text ‚ÄúAdd  $ more to unlock FREE SHIPPING‚Äù ($ = remaining amount, rounded, no decimals).
      - Ensure this text always appears and updates dynamically.
    
    - Edit / Remove actions:
      - Replace text links (‚ÄúEdit‚Äù and ‚ÄúRemove‚Äù) with SVG icons (e.g., pencil and trash can).
      - Align icons vertically to the right side of each product card, one below the other.
      - Use hover effects with subtle color change or opacity to indicate interactivity.
    
    - Design:
      - Maintain HelloPrint-style minimalism: soft shadows, rounded corners, white background, and clean typography (Barlow or Inter preferred).
      - Align elements neatly with clear spacing and visual hierarchy.
    , For the mobile version of the cart page:
    
    - Move the product price below the product title.
    - Place the edit and delete buttons (as SVG icons) below the product image, aligned horizontally and centered.
    - Replace both ‚ÄúShipping calculated at checkout‚Äù and ‚ÄúTaxes calculated at checkout‚Äù with one simple gray text line that says:
      ‚ÄúShipping and taxes calculated at checkout.‚Äù
    - Keep the overall HelloPrint-inspired style: clean layout, clear spacing, rounded corners, and minimalist typography.
    - Language: English.
    , change only this: Shipping and taxes calculated at checkout message, has to be  be a nice box color gray  text left aligned 
    
    remove the Upsells, Move the product price above the edit and delete icons in the cart layout.
    
    - The edit and delete buttons should remain as SVG icons, aligned vertically below the price.
    - Keep spacing consistent and maintain the clean HelloPrint-inspired design.
    - Apply this change for both desktop and mobile layouts.
    For desktop, limit the cart content width to a maximum of 1200px and center it on the page.  
    For mobile, add 20px padding on both the left and right sides.  
    Keep the design consistent with the current style. , Mobile version adjustments only:
    
    - Shorten the estimated shipping message to show only a truck SVG icon and the text ‚Äú3‚Äì5 days‚Äù.
    - Move the price below the product title.
    - Place the edit and delete icons below the product image, side by side and centered.
    - Do not move or modify anything else., Do not move or modify anything else.
    
    Make the "Recommended Products" section automatically display items based on the tags of the products currently in the cart.
    
    Keep the layout and style consistent with the existing design., dont make changes.   add adjustment functions, üß† Prompt
    Make the "You may also like" section automatically display recommended products based on the items currently in the cart.
    
    - Use product tags or collections to determine related products.
    - Update recommendations dynamically as the cart contents change.
    - Allow horizontal scrolling on mobile with smooth animation and visible ‚ÄúAdd to cart‚Äù buttons.
    - Keep the same clean HelloPrint-inspired design and spacing.
    - Do not modify anything else.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-cart-wrapper-{{ ai_gen_id }} {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
  }

  @media screen and (min-width: 750px) {
    .ai-cart-wrapper-{{ ai_gen_id }} {
      padding: 60px 40px;
    }
  }

  .ai-cart-container-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
  }

  @media screen and (min-width: 990px) {
    .ai-cart-container-{{ ai_gen_id }} {
      grid-template-columns: 1fr 400px;
      gap: 32px;
    }
  }

  .ai-cart-items-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .ai-cart-item-{{ ai_gen_id }} {
    background: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_radius }}px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 16px;
    position: relative;
  }

  @media screen and (min-width: 750px) {
    .ai-cart-item-{{ ai_gen_id }} {
      padding: 24px;
      grid-template-columns: 140px 1fr auto;
      gap: 24px;
    }
  }

  .ai-cart-item-left-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .ai-cart-item-image-{{ ai_gen_id }} {
    width: 120px;
    height: 120px;
    border-radius: 8px;
    overflow: hidden;
    background: #f5f5f5;
  }

  @media screen and (min-width: 750px) {
    .ai-cart-item-image-{{ ai_gen_id }} {
      width: 140px;
      height: 140px;
    }
  }

  .ai-cart-item-image-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-cart-item-mobile-actions-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    gap: 12px;
  }

  @media screen and (min-width: 750px) {
    .ai-cart-item-mobile-actions-{{ ai_gen_id }} {
      display: none;
    }
  }

  .ai-cart-item-details-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .ai-cart-item-title-{{ ai_gen_id }} {
    font-family: {{ block.settings.heading_font.family }}, {{ block.settings.heading_font.fallback_families }};
    font-weight: 500;
    font-size: 16px;
    line-height: 1.4;
    color: {{ block.settings.text_color }};
    margin: 0;
  }

  @media screen and (min-width: 750px) {
    .ai-cart-item-title-{{ ai_gen_id }} {
      font-size: 18px;
    }
  }

  .ai-cart-item-price-mobile-{{ ai_gen_id }} {
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-weight: 600;
    font-size: 16px;
    color: {{ block.settings.text_color }};
    display: block;
  }

  @media screen and (min-width: 750px) {
    .ai-cart-item-price-mobile-{{ ai_gen_id }} {
      display: none;
    }
  }

  .ai-cart-item-meta-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .ai-cart-item-variant-{{ ai_gen_id }} {
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 13px;
    color: {{ block.settings.secondary_text_color }};
  }

  .ai-cart-item-delivery-{{ ai_gen_id }} {
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 13px;
    color: {{ block.settings.secondary_text_color }};
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .ai-cart-item-delivery-{{ ai_gen_id }} svg {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }

  .ai-cart-item-delivery-{{ ai_gen_id }} .full-text {
    display: none;
  }

  .ai-cart-item-delivery-{{ ai_gen_id }} .short-text {
    display: inline;
  }

  @media screen and (min-width: 750px) {
    .ai-cart-item-delivery-{{ ai_gen_id }} .full-text {
      display: inline;
    }

    .ai-cart-item-delivery-{{ ai_gen_id }} .short-text {
      display: none;
    }
  }

  .ai-cart-item-quantity-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .ai-cart-quantity-selector-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    border: 1px solid {{ block.settings.border_color }};
    border-radius: 6px;
    overflow: hidden;
  }

  .ai-cart-quantity-btn-{{ ai_gen_id }} {
    background: transparent;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    color: {{ block.settings.text_color }};
    font-size: 18px;
    line-height: 1;
    transition: background 0.2s;
  }

  .ai-cart-quantity-btn-{{ ai_gen_id }}:hover {
    background: #f5f5f5;
  }

  .ai-cart-quantity-input-{{ ai_gen_id }} {
    border: none;
    width: 40px;
    text-align: center;
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 14px;
    font-weight: 500;
    color: {{ block.settings.text_color }};
    padding: 8px 4px;
  }

  .ai-cart-item-right-{{ ai_gen_id }} {
    display: none;
    flex-direction: column;
    align-items: flex-end;
    gap: 12px;
  }

  @media screen and (min-width: 750px) {
    .ai-cart-item-right-{{ ai_gen_id }} {
      display: flex;
    }
  }

  .ai-cart-item-price-{{ ai_gen_id }} {
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-weight: 600;
    font-size: 18px;
    color: {{ block.settings.text_color }};
    white-space: nowrap;
  }

  .ai-cart-item-actions-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
  }

  .ai-cart-action-icon-btn-{{ ai_gen_id }} {
    background: none;
    border: none;
    padding: 8px;
    cursor: pointer;
    color: {{ block.settings.secondary_text_color }};
    transition: all 0.2s;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-cart-action-icon-btn-{{ ai_gen_id }}:hover {
    background: #f5f5f5;
    color: {{ block.settings.text_color }};
  }

  .ai-cart-action-icon-btn-{{ ai_gen_id }}.remove:hover {
    color: #d32f2f;
    background: #ffebee;
  }

  .ai-cart-action-icon-btn-{{ ai_gen_id }} svg {
    width: 20px;
    height: 20px;
  }

  .ai-cart-summary-{{ ai_gen_id }} {
    background: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_radius }}px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    height: fit-content;
    position: sticky;
    top: 20px;
  }

  .ai-cart-summary-title-{{ ai_gen_id }} {
    font-family: {{ block.settings.heading_font.family }}, {{ block.settings.heading_font.fallback_families }};
    font-size: 20px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
    margin: 0 0 20px 0;
  }

  .ai-cart-shipping-message-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 13px;
    line-height: 1.4;
  }

  .ai-cart-shipping-message-{{ ai_gen_id }}.success {
    background: {{ block.settings.shipping_success_bg }};
    color: {{ block.settings.shipping_success_text }};
  }

  .ai-cart-shipping-message-{{ ai_gen_id }}.progress {
    background: {{ block.settings.shipping_progress_bg }};
    color: {{ block.settings.shipping_progress_text }};
  }

  .ai-cart-shipping-message-{{ ai_gen_id }} svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  .ai-cart-shipping-message-{{ ai_gen_id }} strong {
    font-weight: 600;
  }

  .ai-cart-summary-row-{{ ai_gen_id }} {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 14px;
    color: {{ block.settings.text_color }};
  }

  .ai-cart-summary-row-{{ ai_gen_id }}.divider {
    border-top: 1px solid {{ block.settings.border_color }};
    margin-top: 8px;
    padding-top: 20px;
  }

  .ai-cart-summary-row-{{ ai_gen_id }}.total {
    font-size: 18px;
    font-weight: 700;
    padding-top: 16px;
  }

  .ai-cart-summary-label-{{ ai_gen_id }} {
    color: {{ block.settings.secondary_text_color }};
  }

  .ai-cart-summary-value-{{ ai_gen_id }} {
    font-weight: 500;
  }

  .ai-cart-summary-note-{{ ai_gen_id }} {
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 13px;
    color: {{ block.settings.note_text_color }};
    background: {{ block.settings.note_background }};
    padding: 12px 16px;
    border-radius: 8px;
    margin: 12px 0;
    text-align: left;
    line-height: 1.5;
  }

  .ai-cart-checkout-btn-{{ ai_gen_id }} {
    width: 100%;
    background: {{ block.settings.button_background }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: 8px;
    padding: 16px 24px;
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
    transition: background 0.2s;
  }

  .ai-cart-checkout-btn-{{ ai_gen_id }}:hover {
    background: {{ block.settings.button_hover_background }};
  }

  .ai-cart-checkout-btn-{{ ai_gen_id }} svg {
    width: 18px;
    height: 18px;
  }

  .ai-cart-recommended-{{ ai_gen_id }} {
    margin-top: 48px;
  }

  .ai-cart-recommended-title-{{ ai_gen_id }} {
    font-family: {{ block.settings.heading_font.family }}, {{ block.settings.heading_font.fallback_families }};
    font-size: 22px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
    margin: 0 0 24px 0;
  }

  .ai-cart-recommended-scroll-{{ ai_gen_id }} {
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .ai-cart-recommended-scroll-{{ ai_gen_id }}::-webkit-scrollbar {
    display: none;
  }

  .ai-cart-recommended-grid-{{ ai_gen_id }} {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: 280px;
    gap: 16px;
    padding-bottom: 8px;
  }

  @media screen and (min-width: 990px) {
    .ai-cart-recommended-scroll-{{ ai_gen_id }} {
      overflow-x: visible;
    }

    .ai-cart-recommended-grid-{{ ai_gen_id }} {
      grid-auto-flow: row;
      grid-template-columns: repeat(4, 1fr);
      grid-auto-columns: auto;
      gap: 20px;
    }
  }

  .ai-cart-recommended-product-{{ ai_gen_id }} {
    background: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_radius }}px;
    padding: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .ai-cart-recommended-image-{{ ai_gen_id }} {
    width: 100%;
    aspect-ratio: 1;
    border-radius: 8px;
    overflow: hidden;
    background: #f5f5f5;
  }

  .ai-cart-recommended-image-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-cart-recommended-info-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex: 1;
  }

  .ai-cart-recommended-name-{{ ai_gen_id }} {
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 14px;
    font-weight: 500;
    color: {{ block.settings.text_color }};
    line-height: 1.4;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .ai-cart-recommended-price-{{ ai_gen_id }} {
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 16px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
  }

  .ai-cart-recommended-add-btn-{{ ai_gen_id }} {
    width: 100%;
    background: {{ block.settings.secondary_button_background }};
    color: {{ block.settings.secondary_button_text_color }};
    border: 1px solid {{ block.settings.border_color }};
    border-radius: 6px;
    padding: 10px 16px;
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .ai-cart-recommended-add-btn-{{ ai_gen_id }}:hover {
    background: {{ block.settings.accent_color }};
    color: #ffffff;
    border-color: {{ block.settings.accent_color }};
  }

  .ai-cart-recommended-add-btn-{{ ai_gen_id }}.adding {
    opacity: 0.6;
    pointer-events: none;
  }

  .ai-cart-empty-{{ ai_gen_id }} {
    text-align: center;
    padding: 60px 20px;
  }

  .ai-cart-empty-title-{{ ai_gen_id }} {
    font-family: {{ block.settings.heading_font.family }}, {{ block.settings.heading_font.fallback_families }};
    font-size: 24px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
    margin: 0 0 12px 0;
  }

  .ai-cart-empty-text-{{ ai_gen_id }} {
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 16px;
    color: {{ block.settings.secondary_text_color }};
    margin: 0 0 24px 0;
  }

  .ai-cart-empty-btn-{{ ai_gen_id }} {
    display: inline-block;
    background: {{ block.settings.button_background }};
    color: {{ block.settings.button_text_color }};
    padding: 14px 32px;
    border-radius: 8px;
    text-decoration: none;
    font-family: {{ block.settings.body_font.family }}, {{ block.settings.body_font.fallback_families }};
    font-size: 16px;
    font-weight: 600;
    transition: background 0.2s;
  }

  .ai-cart-empty-btn-{{ ai_gen_id }}:hover {
    background: {{ block.settings.button_hover_background }};
  }
{% endstyle %}

<cart-items-{{ ai_gen_id }} class="ai-cart-wrapper-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  {% if cart.item_count > 0 %}
    <div class="ai-cart-container-{{ ai_gen_id }}">
      <div class="ai-cart-items-{{ ai_gen_id }}">
        {% for item in cart.items %}
          <div class="ai-cart-item-{{ ai_gen_id }}" data-line-item="{{ forloop.index }}">
            <div class="ai-cart-item-left-{{ ai_gen_id }}">
              <div class="ai-cart-item-image-{{ ai_gen_id }}">
                {% if item.image %}
                  <img
                    src="{{ item.image | image_url: width: 280 }}"
                    alt="{{ item.image.alt | escape }}"
                    loading="lazy"
                    width="140"
                    height="140"
                  >
                {% else %}
                  {{ 'product-1' | placeholder_svg_tag }}
                {% endif %}
              </div>
              <div class="ai-cart-item-mobile-actions-{{ ai_gen_id }}">
                <button
                  class="ai-cart-action-icon-btn-{{ ai_gen_id }} edit"
                  data-action="edit"
                  data-product-url="{{ item.product.url }}"
                  aria-label="Edit product"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <button
                  class="ai-cart-action-icon-btn-{{ ai_gen_id }} remove"
                  data-action="remove"
                  data-line="{{ forloop.index }}"
                  aria-label="Remove product"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="ai-cart-item-details-{{ ai_gen_id }}">
              <h3 class="ai-cart-item-title-{{ ai_gen_id }}">{{ item.product.title }}</h3>
              <div class="ai-cart-item-price-mobile-{{ ai_gen_id }}">{{ item.final_line_price | money }}</div>
              <div class="ai-cart-item-meta-{{ ai_gen_id }}">
                {% if item.variant.title != 'Default Title' %}
                  <div class="ai-cart-item-variant-{{ ai_gen_id }}">
                    {{ item.variant.title }}
                  </div>
                {% endif %}
                <div class="ai-cart-item-delivery-{{ ai_gen_id }}">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="1" y="3" width="15" height="13"></rect>
                    <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                    <circle cx="5.5" cy="18.5" r="2.5"></circle>
                    <circle cx="18.5" cy="18.5" r="2.5"></circle>
                  </svg>
                  <span class="short-text">3‚Äì5 days</span>
                  <span class="full-text">{{ block.settings.delivery_text }}</span>
                </div>
                <div class="ai-cart-item-quantity-{{ ai_gen_id }}">
                  <div class="ai-cart-quantity-selector-{{ ai_gen_id }}">
                    <button
                      class="ai-cart-quantity-btn-{{ ai_gen_id }}"
                      data-action="decrease"
                      data-line="{{ forloop.index }}"
                      aria-label="Decrease quantity"
                    >
                      ‚àí
                    </button>
                    <input
                      type="number"
                      class="ai-cart-quantity-input-{{ ai_gen_id }}"
                      value="{{ item.quantity }}"
                      min="0"
                      data-line="{{ forloop.index }}"
                      aria-label="Quantity"
                    >
                    <button
                      class="ai-cart-quantity-btn-{{ ai_gen_id }}"
                      data-action="increase"
                      data-line="{{ forloop.index }}"
                      aria-label="Increase quantity"
                    >
                      +
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="ai-cart-item-right-{{ ai_gen_id }}">
              <div class="ai-cart-item-price-{{ ai_gen_id }}">{{ item.final_line_price | money }}</div>
              <div class="ai-cart-item-actions-{{ ai_gen_id }}">
                <button
                  class="ai-cart-action-icon-btn-{{ ai_gen_id }} edit"
                  data-action="edit"
                  data-product-url="{{ item.product.url }}"
                  aria-label="Edit product"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <button
                  class="ai-cart-action-icon-btn-{{ ai_gen_id }} remove"
                  data-action="remove"
                  data-line="{{ forloop.index }}"
                  aria-label="Remove product"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="ai-cart-summary-{{ ai_gen_id }}">
        <h2 class="ai-cart-summary-title-{{ ai_gen_id }}">{{ block.settings.summary_title }}</h2>
        
        <div class="ai-cart-shipping-message-{{ ai_gen_id }}" data-shipping-threshold="{{ block.settings.free_shipping_threshold }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <span></span>
        </div>

        <div class="ai-cart-summary-row-{{ ai_gen_id }}">
          <span class="ai-cart-summary-label-{{ ai_gen_id }}">Subtotal</span>
          <span class="ai-cart-summary-value-{{ ai_gen_id }}" data-cart-subtotal>{{ cart.total_price | money }}</span>
        </div>
        
        <div class="ai-cart-summary-note-{{ ai_gen_id }}">
          {{ block.settings.checkout_note }}
        </div>

        <div class="ai-cart-summary-row-{{ ai_gen_id }} divider total">
          <span>Total</span>
          <span data-cart-total>{{ cart.total_price | money }}</span>
        </div>
        <button class="ai-cart-checkout-btn-{{ ai_gen_id }}" onclick="window.location.href='/checkout'">
          {{ block.settings.checkout_button_text }}
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </button>
      </div>
    </div>

    {% if block.settings.show_recommended %}
      <div class="ai-cart-recommended-{{ ai_gen_id }}">
        <h2 class="ai-cart-recommended-title-{{ ai_gen_id }}">{{ block.settings.recommended_title }}</h2>
        <div class="ai-cart-recommended-scroll-{{ ai_gen_id }}">
          <div class="ai-cart-recommended-grid-{{ ai_gen_id }}" data-recommended-products></div>
        </div>
      </div>
    {% endif %}
  {% else %}
    <div class="ai-cart-empty-{{ ai_gen_id }}">
      <h2 class="ai-cart-empty-title-{{ ai_gen_id }}">Your cart is empty</h2>
      <p class="ai-cart-empty-text-{{ ai_gen_id }}">Add some products to get started</p>
      <a href="/collections/all" class="ai-cart-empty-btn-{{ ai_gen_id }}">Continue shopping</a>
    </div>
  {% endif %}
</cart-items-{{ ai_gen_id }}>

<script>
  (function() {
    class CartItems{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.cart = {{ cart | json }};
        this.freeShippingThreshold = {{ block.settings.free_shipping_threshold | times: 100 }};
      }

      connectedCallback() {
        this.setupEventListeners();
        this.updateShippingMessage();
        this.loadRecommendedProducts();
      }

      setupEventListeners() {
        this.querySelectorAll('.ai-cart-quantity-btn-{{ ai_gen_id }}').forEach(btn => {
          btn.addEventListener('click', (e) => this.handleQuantityChange(e));
        });

        this.querySelectorAll('.ai-cart-quantity-input-{{ ai_gen_id }}').forEach(input => {
          input.addEventListener('change', (e) => this.handleQuantityInput(e));
        });

        this.querySelectorAll('.ai-cart-action-icon-btn-{{ ai_gen_id }}[data-action="remove"]').forEach(btn => {
          btn.addEventListener('click', (e) => this.handleRemove(e));
        });

        this.querySelectorAll('.ai-cart-action-icon-btn-{{ ai_gen_id }}[data-action="edit"]').forEach(btn => {
          btn.addEventListener('click', (e) => this.handleEdit(e));
        });
      }

      async handleQuantityChange(e) {
        const button = e.currentTarget;
        const action = button.dataset.action;
        const line = button.dataset.line;
        const input = this.querySelector(`.ai-cart-quantity-input-{{ ai_gen_id }}[data-line="${line}"]`);
        let quantity = parseInt(input.value);

        if (action === 'increase') {
          quantity++;
        } else if (action === 'decrease' && quantity > 0) {
          quantity--;
        }

        await this.updateCart(line, quantity);
      }

      async handleQuantityInput(e) {
        const input = e.currentTarget;
        const line = input.dataset.line;
        const quantity = parseInt(input.value) || 0;
        await this.updateCart(line, quantity);
      }

      async handleRemove(e) {
        const button = e.currentTarget;
        const line = button.dataset.line;
        await this.updateCart(line, 0);
      }

      handleEdit(e) {
        const button = e.currentTarget;
        const productUrl = button.dataset.productUrl;
        window.location.href = productUrl;
      }

      async addToCart(variantId) {
        try {
          const response = await fetch('/cart/add.js', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              id: variantId,
              quantity: 1
            })
          });

          if (response.ok) {
            window.location.reload();
          }
        } catch (error) {
          console.error('Error adding to cart:', error);
        }
      }

      async updateCart(line, quantity) {
        try {
          const response = await fetch('/cart/change.js', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              line: line,
              quantity: quantity
            })
          });

          if (response.ok) {
            window.location.reload();
          }
        } catch (error) {
          console.error('Error updating cart:', error);
        }
      }

      updateShippingMessage() {
        const messageEl = this.querySelector('.ai-cart-shipping-message-{{ ai_gen_id }}');
        if (!messageEl) return;

        const cartTotal = this.cart.total_price;
        const threshold = this.freeShippingThreshold;
        const remaining = threshold - cartTotal;

        const textEl = messageEl.querySelector('span');
        const iconEl = messageEl.querySelector('svg');

        if (cartTotal >= threshold) {
          messageEl.classList.remove('progress');
          messageEl.classList.add('success');
          textEl.innerHTML = '<strong>FREE SHIPPING</strong> available';
          iconEl.innerHTML = '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>';
        } else {
          messageEl.classList.remove('success');
          messageEl.classList.add('progress');
          const remainingAmount = Math.ceil(remaining / 100);
          textEl.innerHTML = `Add <strong>$${remainingAmount}</strong> more to unlock <strong>FREE SHIPPING</strong>`;
          iconEl.innerHTML = '<rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle>';
        }
      }

      async loadRecommendedProducts() {
        const container = this.querySelector('[data-recommended-products]');
        if (!container) return;

        const cartTags = [...new Set(this.cart.items.flatMap(item => item.product.tags || []))];
        const cartProductIds = this.cart.items.map(item => item.product_id);
        
        if (cartTags.length === 0) {
          container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No recommendations available</p>';
          return;
        }

        try {
          const searchPromises = cartTags.slice(0, 8).map(tag => 
            fetch(`/search/suggest.json?q=${encodeURIComponent(tag)}&resources[type]=product&resources[limit]=8`)
              .then(res => res.json())
              .then(data => data.resources?.results?.products || [])
              .catch(() => [])
          );

          const results = await Promise.all(searchPromises);
          const allProducts = results
            .flat()
            .filter(product => !cartProductIds.includes(product.id) && product.available);

          const uniqueProducts = Array.from(
            new Map(allProducts.map(p => [p.id, p])).values()
          ).slice(0, 8);

          this.renderRecommendedProducts(uniqueProducts, container);
        } catch (error) {
          console.error('Error loading recommended products:', error);
          container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Unable to load recommendations</p>';
        }
      }

      renderRecommendedProducts(products, container) {
        if (products.length === 0) {
          container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No recommendations available</p>';
          return;
        }

        container.innerHTML = products.map(product => {
          const imageUrl = product.featured_image || product.image;
          return `
            <div class="ai-cart-recommended-product-{{ ai_gen_id }}">
              <div class="ai-cart-recommended-image-{{ ai_gen_id }}">
                ${imageUrl ? 
                  `<img src="${imageUrl}" alt="${this.escapeHtml(product.title)}" loading="lazy">` :
                  '{{ "product-1" | placeholder_svg_tag }}'
                }
              </div>
              <div class="ai-cart-recommended-info-{{ ai_gen_id }}">
                <h3 class="ai-cart-recommended-name-{{ ai_gen_id }}">${this.escapeHtml(product.title)}</h3>
                <div class="ai-cart-recommended-price-{{ ai_gen_id }}">${this.formatMoney(product.price)}</div>
              </div>
              <button 
                class="ai-cart-recommended-add-btn-{{ ai_gen_id }}"
                data-variant-id="${product.variants?.[0]?.id || product.id}"
              >
                Add to cart
              </button>
            </div>
          `;
        }).join('');

        container.querySelectorAll('.ai-cart-recommended-add-btn-{{ ai_gen_id }}').forEach(btn => {
          btn.addEventListener('click', async (e) => {
            const button = e.currentTarget;
            const variantId = button.dataset.variantId;
            button.classList.add('adding');
            button.textContent = 'Adding...';
            await this.addToCart(variantId);
          });
        });
      }

      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      formatMoney(cents) {
        const amount = (cents / 100).toFixed(2);
        return `$${amount}`;
      }
    }

    customElements.define('cart-items-{{ ai_gen_id }}', CartItems{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Shopping cart",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "General"
    },
    {
      "type": "text",
      "id": "summary_title",
      "label": "Summary title",
      "default": "Order Summary"
    },
    {
      "type": "text",
      "id": "delivery_text",
      "label": "Delivery text",
      "default": "Estimated delivery: 3-5 business days"
    },
    {
      "type": "text",
      "id": "checkout_button_text",
      "label": "Checkout button text",
      "default": "Continue to Checkout"
    },
    {
      "type": "text",
      "id": "checkout_note",
      "label": "Checkout note",
      "default": "Shipping and taxes calculated at checkout."
    },
    {
      "type": "header",
      "content": "Free shipping"
    },
    {
      "type": "range",
      "id": "free_shipping_threshold",
      "min": 0,
      "max": 500,
      "step": 10,
      "unit": "$",
      "label": "Threshold amount",
      "default": 50
    },
    {
      "type": "color",
      "id": "shipping_success_bg",
      "label": "Success background",
      "default": "#e8f5e9"
    },
    {
      "type": "color",
      "id": "shipping_success_text",
      "label": "Success text",
      "default": "#2e7d32"
    },
    {
      "type": "color",
      "id": "shipping_progress_bg",
      "label": "Progress background",
      "default": "#fff3e0"
    },
    {
      "type": "color",
      "id": "shipping_progress_text",
      "label": "Progress text",
      "default": "#e65100"
    },
    {
      "type": "header",
      "content": "Recommended products"
    },
    {
      "type": "checkbox",
      "id": "show_recommended",
      "label": "Show recommended products",
      "default": true
    },
    {
      "type": "text",
      "id": "recommended_title",
      "label": "Recommended section title",
      "default": "You may also like"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "font_picker",
      "id": "heading_font",
      "label": "Heading font",
      "default": "assistant_n4"
    },
    {
      "type": "font_picker",
      "id": "body_font",
      "label": "Body font",
      "default": "assistant_n4"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#222222"
    },
    {
      "type": "color",
      "id": "secondary_text_color",
      "label": "Secondary text color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent color",
      "default": "#4caf50"
    },
    {
      "type": "color",
      "id": "note_background",
      "label": "Note background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "note_text_color",
      "label": "Note text color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background",
      "default": "#4caf50"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_background",
      "label": "Button hover background",
      "default": "#45a049"
    },
    {
      "type": "color",
      "id": "secondary_button_background",
      "label": "Secondary button background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "secondary_button_text_color",
      "label": "Secondary button text",
      "default": "#222222"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "card_radius",
      "min": 0,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 12
    }
  ],
  "presets": [
    {
      "name": "Shopping cart"
    }
  ]
}
{% endschema %}