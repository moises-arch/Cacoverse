{% comment %}
  Discover our categories — slider con imagen hover
{% endcomment %}

{% assign ai_gen_id = block.id | replace: '_' , '' | downcase %}

{% style %}
/* =============================
   Estética base + hover full color
   ============================= */

/* Card base + focus */
.ai-categories-card-{{ ai_gen_id }}{
  position: relative;
  -webkit-tap-highlight-color: transparent;
  border-radius: {{ block.settings.card_border_radius }}px;
  overflow: hidden;
  transition: transform .3s ease, box-shadow .3s ease;
  box-shadow: {{ block.settings.card_shadow_horizontal }}px {{ block.settings.card_shadow_vertical }}px {{ block.settings.card_shadow_blur }}px rgba(0,0,0,{{ block.settings.card_shadow_opacity | divided_by: 100.0 }});
  display: block;
  text-decoration: none;
  height: {{ block.settings.card_height }}px;
  cursor: pointer;
}
.ai-categories-card-{{ ai_gen_id }}:hover{
  transform: translateY(-{{ block.settings.hover_lift }}px);
  box-shadow: {{ block.settings.card_shadow_horizontal }}px {{ block.settings.card_shadow_vertical | plus: 5 }}px {{ block.settings.card_shadow_blur | plus: 10 }}px rgba(0,0,0, {{ block.settings.card_shadow_opacity | divided_by: 100.0 | times: 1.5 }});
}
.ai-categories-card-{{ ai_gen_id }}:focus-within{
  outline: 2px solid rgba(3,57,144,.14);
  outline-offset: 2px;
}

/* Overlay azul leve por encima de imagen y debajo del texto */
.ai-categories-card-{{ ai_gen_id }}::after{
  content:""; position:absolute; inset:0; pointer-events:none; z-index:1;
  mix-blend-mode: multiply;
  transition: background .35s ease, opacity .35s ease;
}
.ai-categories-card-{{ ai_gen_id }}:hover::after,
.ai-categories-card-{{ ai_gen_id }}:focus-within::after{ background: rgba(3,57,144,0); opacity:0; }

/* === FIX: arrows visibles sobre cards, debajo del header === */
.ai-categories-slider-{{ ai_gen_id }},
.ai-categories-slider-wrapper-{{ ai_gen_id }}{
  position: relative;
  isolation: isolate;
  z-index: 0;
}

.ai-categories-slide-{{ ai_gen_id }}{ position: relative; z-index: 1; }
.ai-categories-card-overlay-{{ ai_gen_id }}{ z-index: 2; }

.ai-categories-nav-{{ ai_gen_id }}{
  position: absolute;
  z-index: 3 !important;
  pointer-events: auto;
  opacity: 1; visibility: visible;
}

@media (max-width: 749px){
  .ai-categories-slider-wrapper-{{ ai_gen_id }}{ overflow: hidden; }
  .ai-categories-nav-prev-{{ ai_gen_id }}{ left: {{ block.settings.nav_button_offset | plus: 6 }}px; }
  .ai-categories-nav-next-{{ ai_gen_id }}{ right: {{ block.settings.nav_button_offset | plus: 6 }}px; }
}

.ai-categories-card-{{ ai_gen_id }}::after{ z-index: 1; }
.ai-categories-card-media-{{ ai_gen_id }}{ z-index: 0; }

/* Contenedor de imágenes (principal + hover) */
.ai-categories-card-media-{{ ai_gen_id }}{
  position: absolute; inset: 0; overflow: hidden; z-index:0;
}
.ai-categories-card-image-main-{{ ai_gen_id }},
.ai-categories-card-image-hover-{{ ai_gen_id }}{
  position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
  transition: opacity .35s ease, transform .35s ease, filter .35s ease;
  will-change: opacity, transform, filter;
}
.ai-categories-card-image-main-{{ ai_gen_id }}{}
.ai-categories-card-image-hover-{{ ai_gen_id }}{ opacity:0; }

.ai-categories-card-{{ ai_gen_id }}:hover .ai-categories-card-image-main-{{ ai_gen_id }},
.ai-categories-card-{{ ai_gen_id }}:focus-within .ai-categories-card-image-main-{{ ai_gen_id }}{
  opacity:0; transform: scale({{ block.settings.image_zoom_scale }}); filter:none;
}
.ai-categories-card-{{ ai_gen_id }}:hover .ai-categories-card-image-hover-{{ ai_gen_id }},
.ai-categories-card-{{ ai_gen_id }}:focus-within .ai-categories-card-image-hover-{{ ai_gen_id }}{
  opacity:1; transform: scale({{ block.settings.image_zoom_scale }}); filter:none;
}

/* Touch fallback */
@supports (-webkit-overflow-scrolling: touch){
  .ai-categories-card-{{ ai_gen_id }}:active .ai-categories-card-image-main-{{ ai_gen_id }}{ opacity:0; }
  .ai-categories-card-{{ ai_gen_id }}:active .ai-categories-card-image-hover-{{ ai_gen_id }}{ opacity:1; }
}

/* Texto overlay */
.ai-categories-card-overlay-{{ ai_gen_id }}{
  position:absolute; inset:0; z-index:2;
  background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0, {{ block.settings.overlay_opacity | divided_by: 100.0 }}) 100%);
  display:flex; flex-direction:column; justify-content:flex-end;
  padding: {{ block.settings.card_padding }}px;
}
.ai-categories-card-title-{{ ai_gen_id }}{
  color: {{ block.settings.card_text_color }}; font-size: {{ block.settings.card_title_size }}px;
  font-weight:600; margin:0 0 5px; line-height:1.2;
}
.ai-categories-card-description-{{ ai_gen_id }}{
  color: {{ block.settings.card_text_color }}; font-size: {{ block.settings.card_description_size }}px;
  margin:0; opacity:.9; line-height:1.3;
}

/* Slider wrapper */
.ai-categories-slider-{{ ai_gen_id }}{
  padding: 0 0 {{ block.settings.section_padding_bottom }}px;
  background-color: {{ block.settings.background_color }};
}
.ai-categories-slider-container-{{ ai_gen_id }}{
  max-width: {{ settings.page_width }}px;
  margin: 0 auto;
  padding: 0 19px;
}

@media (max-width: 749px) {
  .ai-categories-slider-{{ ai_gen_id }} .ai-categories-slider-header-{{ ai_gen_id }},
  .ai-categories-slider-{{ ai_gen_id }} .ai-categories-slider-heading-{{ ai_gen_id }},
  .ai-categories-slider-{{ ai_gen_id }} .ai-categories-slider-subtitle-{{ ai_gen_id }} {
    text-align: center !important;
  }
}

.ai-categories-slider-header-{{ ai_gen_id }}{
  text-align: {{ block.settings.text_alignment }};
  margin-bottom: {{ block.settings.header_spacing }}px;
}
.ai-categories-slider-heading-{{ ai_gen_id }}{
  font-family: {{ block.settings.heading_font.family }}, {{ block.settings.heading_font.fallback_families }};
  font-weight: {{ block.settings.heading_font.weight }};
  font-size: {{ block.settings.heading_size }}px; color: {{ block.settings.heading_color }};
  margin:0 0 {{ block.settings.subtitle_spacing }}px; line-height:1.2;
}
.ai-categories-slider-subtitle-{{ ai_gen_id }}{
  font-family: {{ block.settings.subtitle_font.family }}, {{ block.settings.subtitle_font.fallback_families }};
  font-weight: {{ block.settings.subtitle_font.weight }};
  font-size: {{ block.settings.subtitle_size }}px; color: {{ block.settings.subtitle_color }};
  margin:0; line-height:1.4;
}

/* Track + slides */
.ai-categories-slider-wrapper-{{ ai_gen_id }}{ position:relative; margin-top: {{ block.settings.content_spacing }}px; }
.ai-categories-slider-track-{{ ai_gen_id }}{
  display:flex; gap: {{ block.settings.slide_gap }}px; overflow-x:auto; scroll-behavior:smooth;
  scrollbar-width:none; -ms-overflow-style:none; padding-bottom:10px;
}
.ai-categories-slider-track-{{ ai_gen_id }}::-webkit-scrollbar{ display:none; }
.ai-categories-slide-{{ ai_gen_id }}{
  flex:0 0 auto;
  width: calc((100% - ({{ block.settings.slides_desktop | minus: 1 }} * {{ block.settings.slide_gap }}px)) / {{ block.settings.slides_desktop }});
  overflow: visible !important;
}

/* Placeholder */
.ai-categories-card-placeholder-{{ ai_gen_id }}{ width:100%; height:100%; background:#f4f4f4; display:flex; align-items:center; justify-content:center; position:relative; }
.ai-categories-card-placeholder-{{ ai_gen_id }} svg{ width:60%; height:60%; opacity:.3; }

/* Dots */
.ai-categories-dots-{{ ai_gen_id }}{ display:flex; justify-content:center; gap:8px; margin-top: {{ block.settings.dots_spacing }}px; }
.ai-categories-dot-{{ ai_gen_id }}{
  width: {{ block.settings.dot_size }}px; height: {{ block.settings.dot_size }}px; border-radius:50%;
  background: {{ block.settings.dot_color }}; border:none; cursor:pointer; transition: all .3s ease; opacity:.4;
}
.ai-categories-dot-{{ ai_gen_id }}.active{ background: {{ block.settings.dot_active_color }}; opacity:1; transform: scale(1.2); }

/* Nav */
.ai-categories-nav-{{ ai_gen_id }}{
  position:absolute; top:50%; transform: translateY(-50%);
  background: {{ block.settings.nav_button_color }}; color: {{ block.settings.nav_button_text_color }};
  border:none; border-radius:50%; width: {{ block.settings.nav_button_size }}px; height: {{ block.settings.nav_button_size }}px;
  display:flex; align-items:center; justify-content:center; cursor:pointer; transition: all .3s ease; z-index:2; box-shadow:0 2px 10px rgba(0,0,0,.1);
}
.ai-categories-nav-{{ ai_gen_id }}:hover{ background: {{ block.settings.nav_button_hover_color }}; transform: translateY(-50%) scale(1.1); }
.ai-categories-nav-prev-{{ ai_gen_id }}{ left: {{ block.settings.nav_button_offset }}px; }
.ai-categories-nav-next-{{ ai_gen_id }}{ right: {{ block.settings.nav_button_offset }}px; }
.ai-categories-nav-{{ ai_gen_id }} svg{ width:20px; height:20px; }

/* Responsive widths */
@media (max-width: 990px){
  .ai-categories-slide-{{ ai_gen_id }}{
    width: calc((100% - ({{ block.settings.slides_tablet | minus: 1 }} * {{ block.settings.slide_gap }}px)) / {{ block.settings.slides_tablet }});
  }
}
@media (max-width: 749px){
  .ai-categories-slide-{{ ai_gen_id }}{
    width: calc((100% - ({{ block.settings.slides_mobile | minus: 1 }} * {{ block.settings.slide_gap }}px)) / {{ block.settings.slides_mobile }});
  }
  .ai-categories-slider-heading-{{ ai_gen_id }}{ font-size: {{ block.settings.heading_size | times: 0.8 }}px; }
  .ai-categories-slider-subtitle-{{ ai_gen_id }}{ font-size: {{ block.settings.subtitle_size | times: 0.9 }}px; }
  .ai-categories-card-{{ ai_gen_id }}{ height: {{ block.settings.card_height | times: 0.8 }}px; }
  .ai-categories-nav-{{ ai_gen_id }}{
    width: {{ block.settings.nav_button_size | times: 0.8 }}px;
    height: {{ block.settings.nav_button_size | times: 0.8 }}px;
  }
  .ai-categories-nav-prev-{{ ai_gen_id }}{ left: {{ block.settings.nav_button_offset | times: 0.5 }}px; }
  .ai-categories-nav-next-{{ ai_gen_id }}{ right: {{ block.settings.nav_button_offset | times: 0.5 }}px; }
}

/* NAV: siempre arriba y fáciles de tocar */
.ai-categories-slider-wrapper-{{ ai_gen_id }}{ position: relative; }
.ai-categories-nav-{{ ai_gen_id }}{
  z-index: 9;
  pointer-events: auto;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  outline: none;
}
.ai-categories-nav-{{ ai_gen_id }}::after{
  content:"";
  position:absolute; inset:-12px;
  border-radius: 50%;
  pointer-events: none;
}
.ai-categories-slide-{{ ai_gen_id }}{ position: relative; z-index: 1; }

/* iOS Safari: keep rounded corners */
:root { --card-r-{{ ai_gen_id }}: {{ block.settings.card_border_radius }}px; }

.ai-categories-card-{{ ai_gen_id }}{
  border-radius: var(--card-r-{{ ai_gen_id }});
  overflow: hidden;
  -webkit-mask-image: -webkit-radial-gradient(white, black);
  clip-path: inset(0 round var(--card-r-{{ ai_gen_id }}));
  transform: translateZ(0);
}
.ai-categories-card-media-{{ ai_gen_id }}{
  border-radius: inherit;
  overflow: hidden;
  -webkit-mask-image: -webkit-radial-gradient(white, black);
  clip-path: inset(0 round var(--card-r-{{ ai_gen_id }}));
  transform: translateZ(0);
}
.ai-categories-card-image-main-{{ ai_gen_id }},
.ai-categories-card-image-hover-{{ ai_gen_id }}{
  border-radius: inherit;
  -webkit-backface-visibility: hidden;
  transform-origin: center center;
  will-change: opacity, transform;
}

/* Mobile-only card height */
@media (max-width: 749px){
  .ai-categories-card-{{ ai_gen_id }}{
    height: 310px;
    margin-top: 25px;
  }
  .ai-categories-card-media-{{ ai_gen_id }},
  .ai-categories-card-image-main-{{ ai_gen_id }},
  .ai-categories-card-image-hover-{{ ai_gen_id }}{
    height: 100%;
  }
}

/* Mobile-only: hide slider arrows por completo */
@media (max-width: 749px){
  .ai-categories-nav-{{ ai_gen_id }},
  .ai-categories-nav-{{ ai_gen_id }}::after{
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
  }
}
{% endstyle %}

<categories-slider-{{ ai_gen_id }}
  class="ai-categories-slider-{{ ai_gen_id }}"
  data-autoplay="{{ block.settings.autoplay_enabled }}"
  data-autoplay-speed="{{ block.settings.autoplay_speed }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-categories-slider-container-{{ ai_gen_id }}">
    {% if block.settings.heading != blank or block.settings.subtitle != blank %}
      <div class="ai-categories-slider-header-{{ ai_gen_id }}">
        {% if block.settings.heading != blank %}
          <h2 class="ai-categories-slider-heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
        {% endif %}
        {% if block.settings.subtitle != blank %}
          <div class="ai-categories-slider-subtitle-{{ ai_gen_id }}">{{ block.settings.subtitle }}</div>
        {% endif %}
      </div>
    {% endif %}

    {% assign active_categories = 0 %}
    {% for i in (1..8) %}
      {% liquid
        assign enabled_key = 'category_' | append: i | append: '_enabled'
        if block.settings[enabled_key]
          assign active_categories = active_categories | plus: 1
        endif
      %}
    {% endfor %}

    {% if active_categories > 0 %}
      <div class="ai-categories-slider-wrapper-{{ ai_gen_id }}">
        {% if block.settings.show_navigation %}
          <button class="ai-categories-nav-{{ ai_gen_id }} ai-categories-nav-prev-{{ ai_gen_id }}" aria-label="Previous slide">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15,18 9,12 15,6"/></svg>
          </button>
          <button class="ai-categories-nav-{{ ai_gen_id }} ai-categories-nav-next-{{ ai_gen_id }}" aria-label="Next slide">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"/></svg>
          </button>
        {% endif %}

        <div class="ai-categories-slider-track-{{ ai_gen_id }}">
          {% for i in (1..8) %}
            {% liquid
              assign enabled_key = 'category_' | append: i | append: '_enabled'
              assign collection_key = 'category_' | append: i | append: '_collection'
              assign name_key = 'category_' | append: i | append: '_name'
              assign description_key = 'category_' | append: i | append: '_description'
              assign image_key = 'category_' | append: i | append: '_image'
              assign image_hover_key = 'category_' | append: i | append: '_image_hover'
              assign url_key = 'category_' | append: i | append: '_url'

              assign enabled = block.settings[enabled_key]
              assign collection = block.settings[collection_key]
              assign custom_name = block.settings[name_key]
              assign custom_description = block.settings[description_key]
              assign custom_image = block.settings[image_key]
              assign custom_image_hover = block.settings[image_hover_key]
              assign custom_url = block.settings[url_key]

              if collection != blank
                assign category_name = collection.title
                assign category_url = collection.url
                assign category_image = collection.featured_image
                assign category_description = collection.description
              endif

              if custom_name != blank
                assign category_name = custom_name
              endif
              if custom_description != blank
                assign category_description = custom_description
              endif
              if custom_image != blank
                assign category_image = custom_image
              endif
              if custom_image_hover != blank
                assign category_image_hover = custom_image_hover
              endif
              if custom_url != blank
                assign category_url = custom_url
              endif
              if category_name == blank
                assign category_name = 'Category ' | append: i
              endif
              if category_url == blank
                assign category_url = '#'
              endif
            %}

            {% if enabled %}
              <div class="ai-categories-slide-{{ ai_gen_id }}">
                <a href="{{ category_url }}" class="ai-categories-card-{{ ai_gen_id }}">
                  <div class="ai-categories-card-media-{{ ai_gen_id }}">
                    {% if category_image %}
                      {%- assign main_img = category_image -%}
                    {% endif %}
                    {% if category_image_hover %}
                      {%- assign hover_img = category_image_hover -%}
                    {% endif %}

                    {% if hover_img == blank and main_img != blank %}
                      {% assign hover_img = main_img %}
                    {% endif %}

                    {% if main_img %}
                      <img
                        src="{{ main_img | image_url: width: 720 }}"
                        srcset="{{ main_img | image_url: width: 480 }} 480w, {{ main_img | image_url: width: 720 }} 720w, {{ main_img | image_url: width: 1080 }} 1080w"
                        sizes="(max-width: 749px) 100vw, (max-width: 990px) 50vw, 25vw"
                        alt="{{ main_img.alt | default: category_name | escape }}"
                        width="720" height="{{ block.settings.card_height }}" loading="lazy"
                        class="ai-categories-card-image-main-{{ ai_gen_id }}">
                    {% else %}
                      <div class="ai-categories-card-placeholder-{{ ai_gen_id }}">
                        {{ 'collection-1' | placeholder_svg_tag }}
                      </div>
                    {% endif %}

                    {% if hover_img %}
                      <img
                        src="{{ hover_img | image_url: width: 720 }}"
                        srcset="{{ hover_img | image_url: width: 480 }} 480w, {{ hover_img | image_url: width: 720 }} 720w, {{ hover_img | image_url: width: 1080 }} 1080w"
                        sizes="(max-width: 749px) 100vw, (max-width: 990px) 50vw, 25vw"
                        alt="{{ hover_img.alt | default: category_name | escape }}"
                        width="720" height="{{ block.settings.card_height }}" loading="lazy" aria-hidden="true"
                        class="ai-categories-card-image-hover-{{ ai_gen_id }}">
                    {% endif %}
                  </div>

                  <div class="ai-categories-card-overlay-{{ ai_gen_id }}">
                    <h3 class="ai-categories-card-title-{{ ai_gen_id }}">{{ category_name }}</h3>
                    {% if category_description != blank %}
                      <p class="ai-categories-card-description-{{ ai_gen_id }}">{{ category_description | truncate: 80 }}</p>
                    {% endif %}
                  </div>
                </a>
              </div>
            {% endif %}
          {% endfor %}
        </div>

        {% if block.settings.show_dots and active_categories > 1 %}
          <div class="ai-categories-dots-{{ ai_gen_id }}">
            {% for i in (1..active_categories) %}
              <button class="ai-categories-dot-{{ ai_gen_id }} {% if forloop.first %}active{% endif %}" aria-label="Go to slide {{ i }}" data-slide="{{ forloop.index0 }}"></button>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    {% else %}
      <div class="ai-categories-empty-state-{{ ai_gen_id }}">
        <p>Enable categories to display them in the slider</p>
      </div>
    {% endif %}
  </div>
</categories-slider-{{ ai_gen_id }}>

<script>
  (function(){
    class CategoriesSlider{{ ai_gen_id }} extends HTMLElement{
      constructor(){
        super();
        this.currentSlide = 0;
        this.autoplayInterval = null;
        this.didSwipe = false;
      }

      connectedCallback(){
        this.track = this.querySelector('.ai-categories-slider-track-{{ ai_gen_id }}');
        this.slides = this.querySelectorAll('.ai-categories-slide-{{ ai_gen_id }}');
        this.prevButton = this.querySelector('.ai-categories-nav-prev-{{ ai_gen_id }}');
        this.nextButton = this.querySelector('.ai-categories-nav-next-{{ ai_gen_id }}');
        this.dots = this.querySelectorAll('.ai-categories-dot-{{ ai_gen_id }}');

        if(!this.track || this.slides.length === 0) return;

        this.slidesPerView = this.getSlidesPerView();
        this.maxSlide = Math.max(0, this.slides.length - this.slidesPerView);

        this.setupEventListeners();
        this.setupAutoplay();
        this.updateNavigation();

        window.addEventListener('resize', () => {
          this.slidesPerView = this.getSlidesPerView();
          this.maxSlide = Math.max(0, this.slides.length - this.slidesPerView);
          this.currentSlide = Math.min(this.currentSlide, this.maxSlide);
          this.updateSlider();
        });
      }

      getSlidesPerView(){
        const w = window.innerWidth;
        if (w <= 749) return {{ block.settings.slides_mobile }};
        if (w <= 990) return {{ block.settings.slides_tablet }};
        return {{ block.settings.slides_desktop }};
      }

      setupEventListeners(){
        const isMobile = window.matchMedia('(max-width: 749px)').matches;

        /* Arrows */
        if (this.prevButton){
          this.prevButton.addEventListener('click', (e)=>{
            e.preventDefault();
            e.stopPropagation();
            this.prevSlide();
          });
        }
        if (this.nextButton){
          this.nextButton.addEventListener('click', (e)=>{
            e.preventDefault();
            e.stopPropagation();
            this.nextSlide();
          });
        }

        /* Dots */
        this.dots.forEach((dot, idx)=>{
          dot.addEventListener('click', (e)=>{
            e.preventDefault();
            e.stopPropagation();
            this.goToSlide(idx);
          });
        });

        /* Solo desktop/tablet: swipe controlado.
           En mobile dejamos scroll libre nativo sobre el track. */
        if (!isMobile){
          let startX = 0, currentX = 0, isDragging = false;

          this.track.addEventListener('touchstart', (e)=>{
            if(e.touches.length > 1) return;
            startX = e.touches[0].clientX;
            currentX = startX;
            isDragging = true;
            this.didSwipe = false;
            this.pauseAutoplay();
          }, { passive: true });

          this.track.addEventListener('touchmove', (e)=>{
            if (!isDragging) return;
            currentX = e.touches[0].clientX;
          }, { passive: true });

          this.track.addEventListener('touchend', ()=>{
            if (!isDragging) return;
            isDragging = false;
            const diff = startX - currentX;

            if (Math.abs(diff) > 50){
              this.didSwipe = true;
              if (diff > 0) this.nextSlide();
              else this.prevSlide();
            }
            this.resumeAutoplay();
          });

          /* Si hubo swipe, cancelamos el click sintético posterior */
          this.track.addEventListener('click', (e)=>{
            if (this.didSwipe){
              e.preventDefault();
              e.stopPropagation();
              this.didSwipe = false;
            }
          }, true);
        }

        /* Pausa autoplay en hover (desktop) */
        this.addEventListener('mouseenter', ()=>this.pauseAutoplay());
        this.addEventListener('mouseleave', ()=>this.resumeAutoplay());
      }

      setupAutoplay(){
        if (this.dataset.autoplay === 'true'){
          this.startAutoplay();
        }
      }

      startAutoplay(){
        const speed = parseInt(this.dataset.autoplaySpeed) || 3000;
        this.autoplayInterval = setInterval(()=>this.nextSlide(), speed);
      }

      pauseAutoplay(){
        if (this.autoplayInterval){
          clearInterval(this.autoplayInterval);
          this.autoplayInterval = null;
        }
      }

      resumeAutoplay(){
        if (this.dataset.autoplay === 'true' && !this.autoplayInterval){
          this.startAutoplay();
        }
      }

      /* FINITO: sin loop, no regresa al primero ni salta al último */
      prevSlide(){
        if (this.currentSlide <= 0) return;
        this.currentSlide = this.currentSlide - 1;
        this.updateSlider();
      }

      nextSlide(){
        if (this.currentSlide >= this.maxSlide) return;
        this.currentSlide = this.currentSlide + 1;
        this.updateSlider();
      }

      goToSlide(i){
        this.currentSlide = Math.max(0, Math.min(i, this.maxSlide));
        this.updateSlider();
      }

      updateSlider(){
        if (!this.slides.length || !this.track) return;
        const slideWidth = this.slides[0].offsetWidth;
        const gap = {{ block.settings.slide_gap }};
        const offset = this.currentSlide * (slideWidth + gap);
        this.track.scrollTo({ left: offset, behavior: 'smooth' });
        this.updateNavigation();
        this.updateDots();
      }

      updateNavigation(){
        const noScroll = this.maxSlide === 0;

        if (this.prevButton){
          const disabledPrev = noScroll || this.currentSlide === 0;
          this.prevButton.style.opacity = disabledPrev ? '0.3' : '1';
          this.prevButton.style.pointerEvents = disabledPrev ? 'none' : 'auto';
        }
        if (this.nextButton){
          const disabledNext = noScroll || this.currentSlide === this.maxSlide;
          this.nextButton.style.opacity = disabledNext ? '0.3' : '1';
          this.nextButton.style.pointerEvents = disabledNext ? 'none' : 'auto';
        }
      }

      updateDots(){
        this.dots.forEach((d, i)=>d.classList.toggle('active', i === this.currentSlide));
      }

      disconnectedCallback(){
        this.pauseAutoplay();
      }
    }

    if (!customElements.get('categories-slider-{{ ai_gen_id }}')){
      customElements.define('categories-slider-{{ ai_gen_id }}', CategoriesSlider{{ ai_gen_id }});
    }
  })();
</script>

{% schema %}
{
  "name": "Discover our categories",
  "settings": [
    { "type": "header", "content": "Content" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Discover our categories" },
    { "type": "textarea", "id": "subtitle", "label": "Subtitle", "default": "Explore our wide range of products" },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },

    { "type": "header", "content": "Slider layout" },
    { "type": "range", "id": "slides_desktop", "min": 2, "max": 6, "step": 1, "label": "Slides per view (desktop)", "default": 4 },
    { "type": "range", "id": "slides_tablet", "min": 2, "max": 4, "step": 1, "label": "Slides per view (tablet)", "default": 3 },
    { "type": "range", "id": "slides_mobile", "min": 1, "max": 3, "step": 1, "label": "Slides per view (mobile)", "default": 1 },
    { "type": "range", "id": "slide_gap", "min": 10, "max": 40, "step": 1, "unit": "px", "label": "Gap between slides", "default": 20 },
    { "type": "range", "id": "card_height", "min": 200, "max": 400, "step": 20, "unit": "px", "label": "Card height", "default": 280 },

    { "type": "header", "content": "Navigation" },
    { "type": "checkbox", "id": "show_navigation", "label": "Show navigation arrows", "default": true },
    { "type": "checkbox", "id": "show_dots", "label": "Show dot navigation", "default": true },
    { "type": "range", "id": "nav_button_size", "min": 30, "max": 60, "step": 5, "unit": "px", "label": "Navigation button size", "default": 45 },
    { "type": "range", "id": "nav_button_offset", "min": 10, "max": 30, "step": 5, "unit": "px", "label": "Navigation button offset", "default": 15 },
    { "type": "range", "id": "dot_size", "min": 8, "max": 16, "step": 2, "unit": "px", "label": "Dot size", "default": 10 },

    { "type": "header", "content": "Auto play" },
    { "type": "checkbox", "id": "autoplay_enabled", "label": "Enable auto play", "default": false },
    { "type": "range", "id": "autoplay_speed", "min": 2000, "max": 8000, "step": 500, "unit": "ms", "label": "Auto play speed", "default": 4000 },

    { "type": "header", "content": "Typography" },
    { "type": "font_picker", "id": "heading_font", "label": "Heading font", "default": "assistant_n4" },
    { "type": "range", "id": "heading_size", "min": 20, "max": 60, "step": 2, "unit": "px", "label": "Heading size", "default": 36 },
    { "type": "font_picker", "id": "subtitle_font", "label": "Subtitle font", "default": "assistant_n4" },
    { "type": "range", "id": "subtitle_size", "min": 12, "max": 24, "step": 1, "unit": "px", "label": "Subtitle size", "default": 16 },
    { "type": "range", "id": "card_title_size", "min": 14, "max": 28, "step": 2, "unit": "px", "label": "Card title size", "default": 18 },
    { "type": "range", "id": "card_description_size", "min": 12, "max": 18, "step": 1, "unit": "px", "label": "Card description size", "default": 14 },

    { "type": "header", "content": "Colors" },
    { "type": "color", "id": "background_color", "label": "Background color", "default": "#ffffff" },
    { "type": "color", "id": "heading_color", "label": "Heading color", "default": "#121212" },
    { "type": "color", "id": "subtitle_color", "label": "Subtitle color", "default": "#666666" },
    { "type": "color", "id": "card_text_color", "label": "Card text color", "default": "#ffffff" },
    { "type": "color", "id": "nav_button_color", "label": "Navigation button color", "default": "#ffffff" },
    { "type": "color", "id": "nav_button_text_color", "label": "Navigation button text color", "default": "#121212" },
    { "type": "color", "id": "nav_button_hover_color", "label": "Navigation button hover color", "default": "#f0f0f0" },
    { "type": "color", "id": "dot_color", "label": "Dot color", "default": "#cccccc" },
    { "type": "color", "id": "dot_active_color", "label": "Active dot color", "default": "#121212" },

    { "type": "header", "content": "Card styling" },
    { "type": "range", "id": "card_border_radius", "min": 0, "max": 20, "step": 2, "unit": "px", "label": "Card border radius", "default": 8 },
    { "type": "range", "id": "card_padding", "min": 15, "max": 35, "step": 5, "unit": "px", "label": "Card text padding", "default": 20 },
    { "type": "range", "id": "overlay_opacity", "min": 0, "max": 80, "step": 10, "unit": "%", "label": "Overlay opacity", "default": 50 },
    { "type": "range", "id": "hover_lift", "min": 0, "max": 10, "step": 2, "unit": "px", "label": "Hover lift effect", "default": 4 },
    { "type": "range", "id": "image_zoom_scale", "min": 1.0, "max": 1.2, "step": 0.1, "label": "Image zoom on hover", "default": 1.1 },

    { "type": "header", "content": "Spacing" },
    { "type": "range", "id": "section_padding_top", "min": 0, "max": 100, "step": 10, "unit": "px", "label": "Section padding top", "default": 50 },
    { "type": "range", "id": "section_padding_bottom", "min": 0, "max": 100, "step": 10, "unit": "px", "label": "Section padding bottom", "default": 50 },
    { "type": "range", "id": "header_spacing", "min": 20, "max": 60, "step": 10, "unit": "px", "label": "Header bottom spacing", "default": 40 },
    { "type": "range", "id": "subtitle_spacing", "min": 5, "max": 25, "step": 5, "unit": "px", "label": "Subtitle spacing", "default": 10 },
    { "type": "range", "id": "content_spacing", "min": 20, "max": 60, "step": 10, "unit": "px", "label": "Content top spacing", "default": 30 },
    { "type": "range", "id": "dots_spacing", "min": 20, "max": 40, "step": 5, "unit": "px", "label": "Dots spacing", "default": 30 },

    { "type": "header", "content": "Category 1" },
    { "type": "checkbox", "id": "category_1_enabled", "label": "Enable category 1", "default": true },
    { "type": "collection", "id": "category_1_collection", "label": "Collection" },
    { "type": "text", "id": "category_1_name", "label": "Custom name" },
    { "type": "textarea", "id": "category_1_description", "label": "Custom description" },
    { "type": "image_picker", "id": "category_1_image", "label": "Custom image" },
    { "type": "image_picker", "id": "category_1_image_hover", "label": "Hover image (optional)" },
    { "type": "url", "id": "category_1_url", "label": "Custom URL" },

    { "type": "header", "content": "Category 2" },
    { "type": "checkbox", "id": "category_2_enabled", "label": "Enable category 2", "default": true },
    { "type": "collection", "id": "category_2_collection", "label": "Collection" },
    { "type": "text", "id": "category_2_name", "label": "Custom name" },
    { "type": "textarea", "id": "category_2_description", "label": "Custom description" },
    { "type": "image_picker", "id": "category_2_image", "label": "Custom image" },
    { "type": "image_picker", "id": "category_2_image_hover", "label": "Hover image (optional)" },
    { "type": "url", "id": "category_2_url", "label": "Custom URL" },

    { "type": "header", "content": "Category 3" },
    { "type": "checkbox", "id": "category_3_enabled", "label": "Enable category 3", "default": true },
    { "type": "collection", "id": "category_3_collection", "label": "Collection" },
    { "type": "text", "id": "category_3_name", "label": "Custom name" },
    { "type": "textarea", "id": "category_3_description", "label": "Custom description" },
    { "type": "image_picker", "id": "category_3_image", "label": "Custom image" },
    { "type": "image_picker", "id": "category_3_image_hover", "label": "Hover image (optional)" },
    { "type": "url", "id": "category_3_url", "label": "Custom URL" },

    { "type": "header", "content": "Category 4" },
    { "type": "checkbox", "id": "category_4_enabled", "label": "Enable category 4", "default": true },
    { "type": "collection", "id": "category_4_collection", "label": "Collection" },
    { "type": "text", "id": "category_4_name", "label": "Custom name" },
    { "type": "textarea", "id": "category_4_description", "label": "Custom description" },
    { "type": "image_picker", "id": "category_4_image", "label": "Custom image" },
    { "type": "image_picker", "id": "category_4_image_hover", "label": "Hover image (optional)" },
    { "type": "url", "id": "category_4_url", "label": "Custom URL" },

    { "type": "header", "content": "Category 5" },
    { "type": "checkbox", "id": "category_5_enabled", "label": "Enable category 5", "default": false },
    { "type": "collection", "id": "category_5_collection", "label": "Collection" },
    { "type": "text", "id": "category_5_name", "label": "Custom name" },
    { "type": "textarea", "id": "category_5_description", "label": "Custom description" },
    { "type": "image_picker", "id": "category_5_image", "label": "Custom image" },
    { "type": "image_picker", "id": "category_5_image_hover", "label": "Hover image (optional)" },
    { "type": "url", "id": "category_5_url", "label": "Custom URL" },

    { "type": "header", "content": "Category 6" },
    { "type": "checkbox", "id": "category_6_enabled", "label": "Enable category 6", "default": false },
    { "type": "collection", "id": "category_6_collection", "label": "Collection" },
    { "type": "text", "id": "category_6_name", "label": "Custom name" },
    { "type": "textarea", "id": "category_6_description", "label": "Custom description" },
    { "type": "image_picker", "id": "category_6_image", "label": "Custom image" },
    { "type": "image_picker", "id": "category_6_image_hover", "label": "Hover image (optional)" },
    { "type": "url", "id": "category_6_url", "label": "Custom URL" },

    { "type": "header", "content": "Category 7" },
    { "type": "checkbox", "id": "category_7_enabled", "label": "Enable category 7", "default": false },
    { "type": "collection", "id": "category_7_collection", "label": "Collection" },
    { "type": "text", "id": "category_7_name", "label": "Custom name" },
    { "type": "textarea", "id": "category_7_description", "label": "Custom description" },
    { "type": "image_picker", "id": "category_7_image", "label": "Custom image" },
    { "type": "image_picker", "id": "category_7_image_hover", "label": "Hover image (optional)" },
    { "type": "url", "id": "category_7_url", "label": "Custom URL" },

    { "type": "header", "content": "Category 8" },
    { "type": "checkbox", "id": "category_8_enabled", "label": "Enable category 8", "default": false },
    { "type": "collection", "id": "category_8_collection", "label": "Collection" },
    { "type": "text", "id": "category_8_name", "label": "Custom name" },
    { "type": "textarea", "id": "category_8_description", "label": "Custom description" },
    { "type": "image_picker", "id": "category_8_image", "label": "Custom image" },
    { "type": "image_picker", "id": "category_8_image_hover", "label": "Hover image (optional)" },
    { "type": "url", "id": "category_8_url", "label": "Custom URL" }
  ],
  "presets": [
    { "name": "Discover our categories" }
  ]
}
{% endschema %}
