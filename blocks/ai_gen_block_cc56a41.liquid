{% doc %}
  @prompt
    create a Best seller trending products with 6 columns with slider navigation., Show the lowest price available.
    do not show view product  button
    the image size, column, etc can be adjustable
    
    display the series ( can be turned off)
    display the short description ( can be turned off), add card size and style adjustments, should be responsive content into the frame 1500px
    display 6 products at a time, Navigation buttons
    out of the product cards, make the 1500px frame size adjustable, add brand  with turn on and off 
    Navigation buttons out of the frame, Navigation buttons must be placed outside of the main content frame, show the navigation menu like before
    
    add Product Title 
    Color swatches/boxes showing all available product colors
    
    Price display: show the lowest available price with the label “From $X”. This should update dynamically if variants/prices change.
    
    Auto-slideshow feature for product images:
    
    Images rotate automatically every 5 seconds.
    
    Timing should be adjustable via settings in the theme editor.
    
    Slideshow must pause on hover (desktop) and allow manual swipe/tap (mobile)., add to Product info
     Title. 
    
    add customization, remove navigation  buttons, adjust  the content limited to 1500px width maximun

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-bestseller-slider-{{ ai_gen_id }} {
    max-width: {{ block.settings.frame_width }}px;
    margin: 0 auto;
    position: relative;
    padding: 0 20px;
  }

  .ai-bestseller-header-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 30px;
  }

  .ai-bestseller-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.title_size }}px;
    color: {{ block.settings.title_color }};
    margin: 0;
  }

  .ai-bestseller-slider-container-{{ ai_gen_id }} {
    position: relative;
    overflow: hidden;
    border-radius: {{ block.settings.card_border_radius }}px;
    max-width: 100%;
  }

  .ai-bestseller-slider-track-{{ ai_gen_id }} {
    display: flex;
    transition: transform0.3s ease;
    gap: {{ block.settings.gap_size }}px;
    max-width: 100%;
  }

  .ai-bestseller-product-card-{{ ai_gen_id }} {
    flex: 0 0 calc((100% - {{ block.settings.gap_size | times: 5 }}px) / 6);
    max-width: calc(({{ block.settings.frame_width }}px - {{ block.settings.gap_size | times: 5 }}px -40px) / 6);
    background: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_border_radius }}px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);transition: transform 0.3s ease;
  }

  .ai-bestseller-product-card-{{ ai_gen_id }}:hover {
    transform: translateY(-5px);
  }

  .ai-bestseller-image-container-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    height: {{ block.settings.image_height }}px;
    overflow: hidden;
  }

  .ai-bestseller-image-slider-{{ ai_gen_id }} {
    display: flex;
    width: 100%;
    height: 100%;
    transition: transform 0.3s ease;
  }

  .ai-bestseller-image-slide-{{ ai_gen_id }} {
    flex: 0 0 100%;
    width: 100%;
    height: 100%;
  }

  .ai-bestseller-image-slide-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-bestseller-image-slide-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    object-fit: cover;
    background: #f4f4f4;
  }

  .ai-bestseller-product-info-{{ ai_gen_id }} {
    padding: {{ block.settings.card_padding }}px;
  }

  .ai-bestseller-brand-{{ ai_gen_id }} {
    font-size: {{ block.settings.brand_size }}px;
    color: {{ block.settings.brand_color }};
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: {{ block.settings.brand_weight }};
  }

  .ai-bestseller-product-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.product_title_size }}px;
    color: {{ block.settings.product_title_color }};
    margin: 0 0 8px;
    font-weight: {{ block.settings.product_title_weight }};
    line-height: 1.3;
    text-transform: {{ block.settings.product_title_transform }};
  }

  .ai-bestseller-product-title-{{ ai_gen_id }} a {
    color: inherit;
    text-decoration: none;
  }

  .ai-bestseller-product-title-{{ ai_gen_id }} a:hover {
    color: {{ block.settings.product_title_hover_color }};
  }

  .ai-bestseller-series-{{ ai_gen_id }} {
    font-size: {{ block.settings.series_size }}px;
    color: {{ block.settings.series_color }};
    margin-bottom: 8px;
    font-style: {{ block.settings.series_style }};
    font-weight: {{ block.settings.series_weight }};
  }

  .ai-bestseller-description-{{ ai_gen_id }} {
    font-size: {{ block.settings.description_size }}px;
    color: {{ block.settings.description_color }};
    margin-bottom: 12px;
    line-height: 1.4;
    font-weight: {{ block.settings.description_weight }};
  }

  .ai-bestseller-color-swatches-{{ ai_gen_id }} {
    display: flex;
    gap: 6px;
    margin-bottom: 12px;
    flex-wrap: wrap;
  }

  .ai-bestseller-color-swatch-{{ ai_gen_id }} {
    width: {{ block.settings.swatch_size }}px;
    height: {{ block.settings.swatch_size }}px;
    border-radius: {{ block.settings.swatch_border_radius }}px;
    border: {{ block.settings.swatch_border_width }}px solid {{ block.settings.swatch_border_color }};
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .ai-bestseller-color-swatch-{{ ai_gen_id }}:hover {
    transform: scale(1.1);
  }

  .ai-bestseller-price-{{ ai_gen_id }} {
    font-size: {{ block.settings.price_size }}px;
    color: {{ block.settings.price_color }};
    font-weight: {{ block.settings.price_weight }};}

  @media screen and (max-width: 1200px) {
    .ai-bestseller-product-card-{{ ai_gen_id }} {
      flex: 0 0 calc((100% - {{ block.settings.gap_size | times: 3 }}px) / 4);
      max-width: calc((100% - {{ block.settings.gap_size | times: 3 }}px) / 4);
    }
  }

  @media screen and (max-width: 990px) {
    .ai-bestseller-product-card-{{ ai_gen_id }} {
      flex: 0 0 calc((100% - {{ block.settings.gap_size | times: 2 }}px) / 3);
      max-width: calc((100% - {{ block.settings.gap_size | times: 2 }}px) / 3);
    }
  }

  @media screen and (max-width: 749px) {
    .ai-bestseller-product-card-{{ ai_gen_id }} {
      flex: 0 0 calc((100% - {{ block.settings.gap_size }}px) / 2);
      max-width: calc((100% - {{ block.settings.gap_size }}px) / 2);
    }

    .ai-bestseller-slider-{{ ai_gen_id }} {
      padding: 0 15px;
    }
  }

  @media screen and (max-width: 480px) {
    .ai-bestseller-product-card-{{ ai_gen_id }} {
      flex: 0 0 100%;
      max-width: 100%;
    }

    .ai-bestseller-slider-{{ ai_gen_id }} {
      padding: 0 10px;
    }
  }
{% endstyle %}<bestseller-slider-{{ ai_gen_id }}
  class="ai-bestseller-slider-{{ ai_gen_id }}"
  data-autoplay="{{ block.settings.autoplay_enabled }}"
  data-autoplay-speed="{{ block.settings.autoplay_speed }}"
  {{ block.shopify_attributes }}
>
  {% if block.settings.section_title != blank %}
    <div class="ai-bestseller-header-{{ ai_gen_id }}">
      <h2 class="ai-bestseller-title-{{ ai_gen_id }}">{{ block.settings.section_title }}</h2>
    </div>
  {% endif %}

  <div class="ai-bestseller-slider-container-{{ ai_gen_id }}">
    <div class="ai-bestseller-slider-track-{{ ai_gen_id }}">
      {% if block.settings.product_collection != blank %}
        {% for product in block.settings.product_collection.products limit: 24 %}
          <div class="ai-bestseller-product-card-{{ ai_gen_id }}">
            <div class="ai-bestseller-image-container-{{ ai_gen_id }}"><div class="ai-bestseller-image-slider-{{ ai_gen_id }}" data-product-images>
                {% if product.images.size > 0 %}
                  {% for image in product.images limit: 5 %}
                    <div class="ai-bestseller-image-slide-{{ ai_gen_id }}">
                      <img
                        src="{{ image | image_url: width: 400 }}"
                        alt="{{ image.alt | escape }}"
                        loading="lazy"
                        width="400"
                        height="{{ block.settings.image_height }}"
                      >
                    </div>
                  {% endfor %}
                {% else %}
                  <div class="ai-bestseller-image-slide-{{ ai_gen_id }}">
                    {{ 'product-1' | placeholder_svg_tag }}
                  </div>
                {% endif %}
              </div>
            </div>

            <div class="ai-bestseller-product-info-{{ ai_gen_id }}">
              {% if block.settings.show_brand and product.vendor != blank %}
                <div class="ai-bestseller-brand-{{ ai_gen_id }}">{{ product.vendor }}</div>
              {% endif %}

              {% if block.settings.show_title %}
                <h3 class="ai-bestseller-product-title-{{ ai_gen_id }}">
                  <a href="{{ product.url }}">{{ product.title }}</a>
                </h3>
              {% endif %}

              {% if block.settings.show_series and product.metafields.custom.series != blank %}
                <div class="ai-bestseller-series-{{ ai_gen_id }}">{{ product.metafields.custom.series }}</div>
              {% endif %}

              {% if block.settings.show_description and product.description != blank %}
                <div class="ai-bestseller-description-{{ ai_gen_id }}">
                  {{ product.description | strip_html | truncate: block.settings.description_length }}
                </div>
              {% endif %}

              {% if block.settings.show_color_swatches and product.options contains 'Color' %}
                <div class="ai-bestseller-color-swatches-{{ ai_gen_id }}">
                  {% assign color_option = product.options_by_name['Color'] %}
                  {% if color_option %}
                    {% for value in color_option.values limit: 6 %}
                      {% assign color_handle = value | handle %}
                      <div
                        class="ai-bestseller-color-swatch-{{ ai_gen_id }}"
                        style="background-color: {{ value | downcase }};"
                        title="{{ value }}"
                      ></div>
                    {% endfor %}
                  {% endif %}
                </div>
              {% endif %}

              <div class="ai-bestseller-price-{{ ai_gen_id }}">
                {% if product.price_varies %}
                  From {{ product.price_min | money }}
                {% else %}
                  {{ product.price | money }}
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        {% for i in (1..12) %}
          <div class="ai-bestseller-product-card-{{ ai_gen_id }}">
            <div class="ai-bestseller-image-container-{{ ai_gen_id }}">
              <div class="ai-bestseller-image-slider-{{ ai_gen_id }}">
                <div class="ai-bestseller-image-slide-{{ ai_gen_id }}">
                  {{ 'product-1' | placeholder_svg_tag }}
                </div>
              </div>
            </div>
            <div class="ai-bestseller-product-info-{{ ai_gen_id }}">
              {% if block.settings.show_title %}
                <h3 class="ai-bestseller-product-title-{{ ai_gen_id }}">Sample Product {{ i }}</h3>
              {% endif %}<div class="ai-bestseller-price-{{ ai_gen_id }}">From $29.99</div>
            </div>
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</bestseller-slider-{{ ai_gen_id }}>

<script>
(function() {
  class BestsellerSlider{{ ai_gen_id }} extends HTMLElement {
    constructor() {
      super();
      this.currentSlide = 0;
      this.slidesToShow = 6;
      this.autoplayInterval = null;
      this.autoplaySpeed = parseInt(this.dataset.autoplaySpeed) * 1000 || 5000;
      this.autoplayEnabled = this.dataset.autoplay === 'true';
    }

    connectedCallback() {
      this.track = this.querySelector('.ai-bestseller-slider-track-{{ ai_gen_id }}');
      this.cards = this.querySelectorAll('.ai-bestseller-product-card-{{ ai_gen_id }}');
      this.imageSliders = this.querySelectorAll('[data-product-images]');

      this.totalSlides = Math.max(0, this.cards.length - this.slidesToShow);
      
      this.setupEventListeners();
      this.setupImageAutoplay();
      
      if (this.autoplayEnabled) {
        this.startAutoplay();
      }
    }

    setupEventListeners() {
      this.addEventListener('mouseenter', () => {
        this.stopAutoplay();
        this.pauseImageAutoplay();
      });

      this.addEventListener('mouseleave', () => {
        if (this.autoplayEnabled) {
          this.startAutoplay();
        }
        this.resumeImageAutoplay();
      });

      let startX = 0;
      let currentX = 0;
      let isDragging = false;

      this.track.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        isDragging = true;
      });

      this.track.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        currentX = e.touches[0].clientX;});

      this.track.addEventListener('touchend', () => {
        if (!isDragging) return;
        const diff = startX - currentX;
        if (Math.abs(diff) > 50) {
          if (diff > 0) {
            this.nextSlide();
          } else {
            this.prevSlide();
          }
        }
        isDragging = false;
      });

      window.addEventListener('resize', () => this.updateSlidesToShow());
      this.updateSlidesToShow();
    }

    updateSlidesToShow() {
      const width = window.innerWidth;
      if (width <= 480) {
        this.slidesToShow = 1;
      } else if (width <= 749) {
        this.slidesToShow = 2;
      } else if (width <= 990) {
        this.slidesToShow = 3;
      } else if (width <= 1200) {
        this.slidesToShow = 4;
      } else {
        this.slidesToShow = 6;
      }
      
      this.totalSlides = Math.max(0, this.cards.length - this.slidesToShow);
      this.currentSlide = Math.min(this.currentSlide, this.totalSlides);this.updateSlidePosition();
    }

    setupImageAutoplay() {
      this.imageSliders.forEach((slider) => {
        const slides = slider.querySelectorAll('.ai-bestseller-image-slide-{{ ai_gen_id }}');
        if (slides.length <= 1) return;

        let currentImageSlide = 0;
        const imageInterval = setInterval(() => {
          if (slider.dataset.paused === 'true') return;
          
          currentImageSlide = (currentImageSlide + 1) % slides.length;
          slider.style.transform = `translateX(-${currentImageSlide * 100}%)`;
        }, this.autoplaySpeed);

        slider.dataset.interval = imageInterval;
      });
    }

    pauseImageAutoplay() {
      this.imageSliders.forEach((slider) => {
        slider.dataset.paused = 'true';
      });
    }

    resumeImageAutoplay() {
      this.imageSliders.forEach((slider) => {
        slider.dataset.paused = 'false';
      });
    }

    startAutoplay() {
      this.stopAutoplay();
      this.autoplayInterval = setInterval(() => {
        this.nextSlide();
      }, this.autoplaySpeed);
    }

    stopAutoplay() {
      if (this.autoplayInterval) {
        clearInterval(this.autoplayInterval);
        this.autoplayInterval = null;
      }
    }

    nextSlide() {
      if (this.currentSlide < this.totalSlides) {
        this.currentSlide++;
      } else {
        this.currentSlide = 0;
      }
      this.updateSlidePosition();
    }

    prevSlide() {
      if (this.currentSlide > 0) {
        this.currentSlide--;
      } else {
        this.currentSlide = this.totalSlides;
      }
      this.updateSlidePosition();
    }

    updateSlidePosition() {
      const cardWidth = this.cards[0]?.offsetWidth || 0;
      const gap = parseInt(getComputedStyle(this.track).gap) || 0;
      const translateX = this.currentSlide * (cardWidth + gap);
      this.track.style.transform = `translateX(-${translateX}px)`;
    }
  }

  customElements.define('bestseller-slider-{{ ai_gen_id }}', BestsellerSlider{{ ai_gen_id }});
})();
</script>

{% schema %}
{
  "name": "Best seller products",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section title",
      "default": "Best Sellers"
    },
    {
      "type": "collection",
      "id": "product_collection",
      "label": "Product collection"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "frame_width",
      "min": 800,
      "max": 1500,
      "step": 50,
      "unit": "px",
      "label": "Frame width",
      "default": 1500
    },
    {
      "type": "range",
      "id": "gap_size",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Gap between cards",
      "default": 20
    },
    {
      "type": "header",
      "content": "Card style"
    },
    {
      "type": "range",
      "id": "image_height",
      "min": 200,
      "max": 400,
      "step": 10,
      "unit": "px",
      "label": "Image height",
      "default": 280
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 10,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Card padding",
      "default": 16
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 8
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Product info"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "Show product title",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_brand",
      "label": "Show brand",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_series",
      "label": "Show series",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show description",
      "default": true
    },
    {
      "type": "range",
      "id": "description_length",
      "min": 50,
      "max": 200,
      "step": 10,
      "label": "Description length",
      "default": 80
    },
    {
      "type": "checkbox",
      "id": "show_color_swatches",
      "label": "Show color swatches",
      "default": true
    },
    {
      "type": "header",
      "content": "Color swatches"
    },
    {
      "type": "range",
      "id": "swatch_size",
      "min": 16,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Swatch size",
      "default": 20
    },
    {
      "type": "range",
      "id": "swatch_border_radius",
      "min": 0,
      "max": 16,
      "step": 2,
      "unit": "px",
      "label": "Swatch border radius",
      "default": 10
    },
    {
      "type": "range",
      "id": "swatch_border_width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "label": "Swatch border width",
      "default": 2
    },
    {
      "type": "color",
      "id": "swatch_border_color",
      "label": "Swatch border color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 20,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Section title size",
      "default": 28
    },
    {
      "type": "range",
      "id": "product_title_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Product title size",
      "default": 16
    },
    {
      "type": "select",
      "id": "product_title_weight",
      "label": "Product title weight",
      "options": [
        {"value": "400", "label": "Normal"},
        {"value": "500", "label": "Medium"},
        {"value": "600", "label": "Semi-bold"},
        {"value": "700", "label": "Bold"}
      ],
      "default": "600"
    },
    {
      "type": "select",
      "id": "product_title_transform",
      "label": "Product title transform",
      "options": [
        {"value": "none", "label": "None"},
        {"value": "uppercase", "label": "Uppercase"},
        {"value": "lowercase", "label": "Lowercase"},
        {"value": "capitalize", "label": "Capitalize"}
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "brand_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Brand size",
      "default": 12
    },
    {
      "type": "select",
      "id": "brand_weight",
      "label": "Brand weight",
      "options": [
        {"value": "400", "label": "Normal"},
        {"value": "500", "label": "Medium"},
        {"value": "600", "label": "Semi-bold"},
        {"value": "700", "label": "Bold"}
      ],
      "default": "400"
    },
    {
      "type": "range",
      "id": "series_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Series size",
      "default": 13
    },
    {
      "type": "select",
      "id": "series_weight",
      "label": "Series weight",
      "options": [
        {"value": "400", "label": "Normal"},
        {"value": "500", "label": "Medium"},
        {"value": "600", "label": "Semi-bold"},
        {"value": "700", "label": "Bold"}
      ],
      "default": "400"
    },
    {
      "type": "select",
      "id": "series_style",
      "label": "Series style",
      "options": [
        {"value": "normal", "label": "Normal"},
        {"value": "italic", "label": "Italic"}
      ],
      "default": "italic"
    },
    {
      "type": "range",
      "id": "description_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Description size",
      "default": 13
    },
    {
      "type": "select",
      "id": "description_weight",
      "label": "Description weight",
      "options": [
        {"value": "400", "label": "Normal"},
        {"value": "500", "label": "Medium"},
        {"value": "600", "label": "Semi-bold"},
        {"value": "700", "label": "Bold"}
      ],
      "default": "400"
    },
    {
      "type": "range",
      "id": "price_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Price size",
      "default": 16
    },
    {
      "type": "select",
      "id": "price_weight",
      "label": "Price weight",
      "options": [
        {"value": "400", "label": "Normal"},
        {"value": "500", "label": "Medium"},
        {"value": "600", "label": "Semi-bold"},
        {"value": "700", "label": "Bold"}
      ],
      "default": "700"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Section title color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "product_title_color",
      "label": "Product title color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "product_title_hover_color",
      "label": "Product title hover color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "brand_color",
      "label": "Brand color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "series_color",
      "label": "Series color",
      "default": "#888888"
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Autoplay"
    },
    {
      "type": "checkbox",
      "id": "autoplay_enabled",
      "label": "Enable autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Autoplay speed",
      "default": 5
    }
  ],
  "presets": [
    {
      "name": "Best seller products"
    }
  ]
}
{% endschema %}