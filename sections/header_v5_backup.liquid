<link rel="stylesheet" href="{{ 'component-search.css' | asset_url }}" media="print" onload="this.media='all'">
{{ 'header-menu.css' | asset_url | stylesheet_tag }}

<header class="site-header">



<!-- ===== MOBILE TOPBAR (solo <992px) ===== -->
<div class="m-header d-lg-none">
  <!-- Left: burger + search -->
  <div class="m-left">





    <button class="m-btn m-burger"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation">



      
      <!-- burger -->
      <svg viewBox="0 0 24 24" width="26" height="26" aria-hidden="true">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
      </svg>
    </button>

    <a class="m-btn m-search" href="/search" aria-label="Search">
      <!-- search -->
      <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
        <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none"/>
        <path d="M20 20L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </a>
  </div>

  <!-- Center: logo -->
  <a href="{{ routes.root_url }}" class="m-brand" aria-label="{{ shop.name }}">
    {%- if settings.logo != blank -%}
      {{
        settings.logo
        | image_url: width: 480
        | image_tag:
          class: 'm-logo',
          widths: '160, 240, 320, 480',
          alt: settings.logo.alt | default: shop.name
      }}
    {%- else -%}
      <span class="m-logo-text">{{ shop.name }}</span>
    {%- endif -%}
  </a>

  <!-- Right: cart -->
  <a class="m-btn m-cart" href="{{ routes.cart_url }}" aria-label="{{ 'templates.cart.cart' | t }}">
    <!-- cart -->
    <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
      <path d="M4 6h2l2.5 9h9L20 8H7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="10" cy="19" r="1.5" fill="currentColor"/><circle cx="17" cy="19" r="1.5" fill="currentColor"/>
    </svg>
    {%- if cart != empty -%}
      <span class="m-bubble">{{ cart.item_count }}</span>
    {%- endif -%}
  </a>
</div>
<!-- ===== /MOBILE TOPBAR ===== -->








  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid page-width">
      <!-- Logo -->
      <a href="{{ routes.root_url }}" class="navbar-brand">
        {%- if settings.logo != blank -%}
          <div class="header__heading-logo-wrapper">
            {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
            {%- assign logo_height = settings.logo_width | divided_by: settings.logo.aspect_ratio -%}
            {% capture sizes %}(max-width: {{ settings.logo_width | times: 2 }}px) 50vw, {{ settings.logo_width }}px{% endcapture %}
            {% capture widths %}{{ settings.logo_width }}, {{ settings.logo_width | times: 1.5 | round }}, {{ settings.logo_width | times: 2 }}{% endcapture %}
            {{
              settings.logo
              | image_url: width: 600
              | image_tag:
                class: 'header__heading-logo motion-reduce',
                widths: widths,
                height: logo_height,
                width: settings.logo_width,
                alt: logo_alt,
                sizes: sizes,
                preload: true
            }}
          </div>
        {% else %}
          <span class="h2">{{ shop.name }}</span>
        {% endif %}
      </a>
      <!-- Toggler for mobile -->

      <button
        class="navbar-toggler collapsed"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menu Items -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="main-menu-bar navbar-nav mx-auto">
          {% for link in linklists['main-menu'].links %}
            {% assign parent_link_title = link.title | handleize | downcase %}
            {% if parent_link_title == 'products' %}
              <li class="nav-item dropdown position-static">
                <a
                  class="nav-link"
                  href="javascript:void(0);"
                  id="megaMenu-{{ parent_link_title }}"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  {{ link.title }}
                  {{ 'icon-caret.svg' | inline_asset_content }}
                </a>

                <div
                  class="dropdown-menu mega-menu {{ parent_link_title }}-dropdown-menu"
                  aria-labelledby="megaMenu-{{ parent_link_title }}"
                >
                  <div class="container-fluid page-width ">
                    <div class="row">
                      <div class="col-12 col-md-3 border-right">
                        <div class="dropdown-menu-item">
                          <ul class="list-unstyled mb-3 mb-md-3">
                            {% for link_all in linklists['all-categories'].links %}
                              {% if forloop.index == 1 %}
                                <li>
                                  <h3>
                                    <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                  </h3>
                                </li>
                              {% else %}
                                <li>
                                  <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>

                           <ul class="list-unstyled mb-3">
                            {% for link_all in linklists['program'].links %}
                              {% if forloop.index == 1 %}
                                <li>
                                  <h3>
                                    <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                  </h3>
                                </li>
                              {% else %}
                                <li>
                                  <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>
                        </div>
                      </div>
                       <div class="col-12 col-md-3 border-right">
                        <div class="dropdown-menu-item">
                          <ul class="list-unstyled mb-3 mb-md-3">
                            {% for link_all in linklists['hand-protection'].links %}
                              {% if forloop.index == 1 %}
                                <li>
                                  <h3>
                                    <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                  </h3>
                                </li>
                              {% else %}
                                <li>
                                  <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>

                           <ul class="list-unstyled mb-3">
                            {% for link_all in linklists['protective-clothing'].links %}
                              {% if forloop.index == 1 %}
                                <li>
                                  <h3>
                                    <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                  </h3>
                                </li>
                              {% else %}
                                <li>
                                  <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>
                        </div>
                      </div>
                       <div class="col-12 col-md-3 border-right">
                        <div class="dropdown-menu-item">
                          <ul class="list-unstyled mb-3 mb-md-3">
                            {% for link_all in linklists['hearing-protection'].links %}
                              {% if forloop.index == 1 %}
                                <li>
                                  <h3>
                                    <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                  </h3>
                                </li>
                              {% else %}
                                <li>
                                  <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>

                           <ul class="list-unstyled mb-3 mb-md-3">
                            {% for link_all in linklists['head-protection'].links %}
                              {% if forloop.index == 1 %}
                                <li>
                                  <h3>
                                    <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                  </h3>
                                </li>
                              {% else %}
                                <li>
                                  <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>
                          
                          <ul class="list-unstyled">
                            {% for link_all in linklists['ergonomics'].links %}
                              {% if forloop.index == 1 %}
                                <li>
                                  <h3>
                                    <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                  </h3>
                                </li>
                              {% else %}
                                <li>
                                  <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>
                        </div>
                      </div>
                      <div class="col-12 col-md-3 border-right">
                        <div class="dropdown-menu-item">

                          
                          
                          <ul class="list-unstyled mb-3 mb-md-3">
                            {% for link_all in linklists['eye-protection'].links %}
                              {% if forloop.index == 1 %}
                                <li>
                                  <h3>
                                    <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                  </h3>
                                </li>
                              {% else %}
                                <li>
                                  <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>
                          
                          <ul class="list-unstyled mb-3">
                            {% for link_all in linklists['microfiber-towels'].links %}
                              {% if forloop.index == 1 %}
                                <li>
                                  <h3>
                                    <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                  </h3>
                                </li>
                              {% else %}
                                <li>
                                  <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>
                         
                          <ul class="list-unstyled mb-3">
                            {% for link_all in linklists['sale'].links %}
                              {% if forloop.index == 1 %}
                                <li class="menu-slug-{{ link_all.title | handleize }}">
                                  <h3>
                                    <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                  </h3>
                                </li>
                              {% else %}
                                <li>
                                  <a href="{{ link_all.url }}">{{ link_all.title }}</a>
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>
                         
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            {% elsif parent_link_title == 'brands' %}
              <li class="nav-item dropdown position-static">
                <a
                  class="nav-link"
                  href="{{ link.url }}"
                  id="megaMenu-{{ parent_link_title }}"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  {{ link.title }}
                  {{ 'icon-caret.svg' | inline_asset_content }}
                </a>

                <!-- v icon -->
                {% if link.links.size > 0 %}
                  <div
                    class="dropdown-menu mega-menu {{ parent_link_title }}-dropdown-menu"
                    aria-labelledby="megaMenu-{{ parent_link_title }}"
                  >
                    <div class="container-fluid page-width">
                      <div class="row">
                        <div class="col-12 col-md-4 border-right">
                          <div
                            class="dropdown-menu-item"
                            onclick="location.href = '/pages/ppe-categories';"
                            style="cursor:pointer;"
                          >
                            <div class="imager text-center mb-3">
                              <img
                                src="{{ 'menu-brand-1.png' |asset_img_url : 'master' }}"
                                class="img-fluid"
                                width="auto"
                                height="125"
                                loading="lazy"
                              >
                            </div>
                            <h3 class="text-center mt-3 mt-md-4 mb-2">GE PPE</h3>
                            <p class="sp-16 text-center">
                              GE is one of the most valuable and respected brands in the world, renowned for its
                              unparalleled heritage of innovation and pioneering world-changing initiatives for the
                              betterment of all.
                            </p>
                          </div>
                        </div>
                        <div class="col-12 col-md-4 border-right">
                          <div
                            class="dropdown-menu-item"
                            onclick="location.href = '/collections/best-value';"
                            style="cursor:pointer;"
                          >
                        <div class="imager text-center mb-3">
                            <img
                            src="https://cdn.shopify.com/s/files/1/0660/8800/9781/files/menu-brand-4.png"
                            class="img-fluid"
                            width="auto"
                            height="125"
                            loading="lazy"
                           >
                        </div>
                            <h3 class="text-center mt-3 mt-md-4 mb-2">Best Value</h3>
                            <p class="sp-16 text-center">
                             Best Value is a fast-growing brand in 38+ countries, with 50,000+ points of sale and 3,000+ SKUs, focused on developing innovative, high-value products across 22 categories worldwide.
                            </p>
                          </div>
                        </div>
                        <div class="col-12 col-md-4">
                          <div
                            class="dropdown-menu-item"
                            onclick="location.href = '/collections/wd-40';"
                            style="cursor:pointer;"
                          >
                            <div class="imager text-center mb-3">
                              <img
                                src="{{ 'menu-brand-3.png' |asset_img_url : 'master' }}"
                                class="img-fluid"
                                width="auto"
                                height="125"
                                loading="lazy"
                              >
                            </div>
                            <h3 class="text-center mt-3 mt-md-4 mb-2">WD-40 Microfiber Towels</h3>
                            <p class="sp-16 text-center">
                              WD-40 Brand products help keep tractors, cars, motorcycles, bicycles and more running like
                              new. Before there’s a breakdown – reach for it – to save yourself time and money.
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                {% endif %}
              </li>
            {% elsif parent_link_title == 'industries' %}
              <li class="nav-item dropdown position-static">
                <a
                  class="nav-link"
                  href="{{ link.url }}"
                  id="megaMenu-{{ parent_link_title }}"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  {{ link.title }}
                  {{ 'icon-caret.svg' | inline_asset_content }}
                </a>

                <!-- v icon -->
                {% if link.links.size > 0 %}
                  <div
                    class="dropdown-menu mega-menu {{ parent_link_title }}-dropdown-menu"
                    aria-labelledby="megaMenu-{{ parent_link_title }}"
                  >
                    <div class="container-fluid page-width">
                      <div class="row">
                        {% assign link_count = link.links.size %}

                        {% for sublink in link.links %}
                          {% assign index0 = forloop.index0 %}
                          {% assign mod = index0 | modulo: 3 %}

                          {% if mod == 0 %}
                            <div class="col-12 col-md-4 border-right">
                          {% endif %}
                          {% assign my_collection = sublink.object %}
                          <div class="d-flex align-items-center gap-2 mb-3">
                            <img
                              src="{{ my_collection.metafields.custom.page_featured_image | img_url :'80x' }}"
                              class="img-fluid "
                              width="80"
                              height="80"
                              loading="lazy"
                            >
                            <a href="{{ sublink.url }}" class="dropdown-item">{{ sublink.title }}</a>
                          </div>
                          {% assign next_index = index0 | plus: 1 %}
                          {% assign close_mod = next_index | modulo: 3 %}
                          {% if close_mod == 0 or forloop.last %}
                            </div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                {% endif %}
              </li>
            {% elsif parent_link_title == 'resources' %}
              <li class="nav-item dropdown position-static">
                <a
                  class="nav-link"
                  href="javascript:void(0);"
                  id="megaMenu-{{ parent_link_title }}"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  {{ link.title }}
                  {{ 'icon-caret.svg' | inline_asset_content }}
                </a>

                <!-- v icon -->
                {% if link.links.size > 0 %}
                  <div
                    class="dropdown-menu mega-menu {{ parent_link_title }}-dropdown-menu"
                    aria-labelledby="megaMenu-{{ parent_link_title }}"
                  >
                    <div class="container-fluid page-width">
                      <div class="row">
                        <div class="col-12 d-flex align-items-start flex-wrap flex-lg-nowrap ">
                          {% for sublink in link.links %}
                            <div class="dropdown-menu-item border-right">
                              <h3>
                                <a href="{{ sublink.url }}">{{ sublink.title }}</a>
                              </h3>
                              {% if sublink.links.size > 0 %}
                                <ul class="list-unstyled ">
                                  {% for subsublink in sublink.links %}
                                    <li>
                                      <a href="{{ subsublink.url }}">{{ subsublink.title }}</a>
                                    </li>
                                  {% endfor %}
                                </ul>
                              {% endif %}
                            </div>
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                {% endif %}
              </li>
            {% elsif parent_link_title == 'contact' %}
              <li class="nav-item dropdown position-static">
                <a
                  class="nav-link"
                  href="{{ link.url }}"
                  id="megaMenu-{{ parent_link_title }}"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  {{ link.title }}
                  {{ 'icon-caret.svg' | inline_asset_content }}
                </a>

                <!-- v icon -->
                {% if link.links.size > 0 %}
                  <div
                    class="dropdown-menu mega-menu {{ parent_link_title }}-dropdown-menu"
                    aria-labelledby="megaMenu-{{ parent_link_title }}"
                  >
                    <div class="container-fluid page-width">
                      <div class="row">
                        {% for sublink in link.links %}
                          <div class="col-12 col-md-6 border-right">
                            {% assign my_collection = sublink.object %}
                            <div class="d-flex align-items-center gap-2 mb-3 justify-content-center">
                              <img
                                src="{{ my_collection.metafields.custom.page_featured_image | img_url :'80x' }}"
                                class="img-fluid "
                                width="80"
                                height="80"
                                loading="lazy"
                              >
                              <a href="{{ sublink.url }}" class="dropdown-item">{{ sublink.title }}</a>
                            </div>
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                {% endif %}
              </li>
             {% elsif parent_link_title == 'about-us' %}
               <li class="nav-item dropdown position-static">
                <a
                  class="nav-link"
                  href="{{ link.url }}"
                  id="menu-{{ parent_link_title }}"
                  role="link"
                >
                  {{ link.title }}
                </a>
                </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
      <ul class="navbar-nav align-items-center gap-1 gap-xxl-2 icosn d-none d-lg-flex">
        <li class="nav-item mobile-header-search">
          {% render 'header-search', input_id: 'Search-In-Modal' %}
        </li>
        <li>
          {%- if shop.customer_accounts_enabled -%}
            <a
              href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
              class="header__icon header__icon--account link focus-inset{% if section.settings.menu != blank %} small-hide{% endif %}"
              rel="nofollow"
            >
              {%- if section.settings.enable_customer_avatar -%}
                <account-icon>
                  {%- if customer and customer.has_avatar? -%}
                    {{ customer | avatar }}
                  {%- else -%}
                    <span class="svg-wrapper">{{ 'icon-account.svg' | inline_asset_content }}</span>
                  {%- endif -%}
                </account-icon>
              {%- else -%}
                <span class="svg-wrapper">{{ 'icon-account.svg' | inline_asset_content }}</span>
              {%- endif -%}
              <span class="visually-hidden">
                {%- liquid
                  if customer
                    echo 'customer.account_fallback' | t
                  else
                    echo 'customer.log_in' | t
                  endif
                -%}
              </span>
            </a>
          {%- endif -%}
        </li>
        <li class="nav-item">
          <a
            href="{{ routes.cart_url }}"
            class="header__icon header__icon--cart link focus-inset"
            id="cart-icon-bubble"
          >
            {% if cart == empty %}
              <span class="svg-wrapper">{{ 'icon-cart-empty.svg' | inline_asset_content }}</span>
            {% else %}
              <span class="svg-wrapper">{{ 'icon-cart.svg' | inline_asset_content }}</span>
            {% endif %}
            <span class="visually-hidden">{{ 'templates.cart.cart' | t }}</span>
            {%- if cart != empty -%}
              <div class="cart-count-bubble">
                {%- if cart.item_count < 100 -%}
                  <span aria-hidden="true">{{ cart.item_count }}</span>
                {%- endif -%}
                <span class="visually-hidden">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
              </div>
            {%- endif -%}
          </a>
        </li>
      </ul>
    </div>
  </nav>
</header>

{% schema %}
{
  "name": "t:sections.header.name",
  "class": "section-header position-sticky top-0",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "t:sections.header.settings.menu.label"
    },
  ],
}
{% endschema %}









<script>
(function(){
  function applyHeaderState(){
    var header = document.querySelector('header.site-header');
    if(!header) return;
    var scrolled = window.scrollY > 10;
    header.classList.toggle('scrolled', scrolled || header.classList.contains('nav-open'));
  }

  // Scroll state
  window.addEventListener('scroll', applyHeaderState, { passive:true });
  document.addEventListener('DOMContentLoaded', applyHeaderState);

  // Si usas Bootstrap 5, sincroniza con el collapse del menú
  document.addEventListener('DOMContentLoaded', function(){
    var header = document.querySelector('header.site-header');
    var nav = document.getElementById('navbarNav');
    if(!header || !nav) return;

    // Eventos de Bootstrap 5
    nav.addEventListener('shown.bs.collapse', function(){
      header.classList.add('nav-open');   // fuerza modo oscuro mientras el menú está abierto
      header.classList.add('scrolled');
    });
    nav.addEventListener('hidden.bs.collapse', function(){
      header.classList.remove('nav-open');
      applyHeaderState();                 // vuelve al estado según scroll
    });
  });
})();
</script>


<script>
(function(){
  function updateState(){
    var bar = document.querySelector('.m-header');
    if(!bar) return;
    var scrolled = window.scrollY > 10;
    bar.classList.toggle('scrolled', scrolled || bar.classList.contains('nav-open'));
  }
  window.addEventListener('scroll', updateState, { passive:true });
  document.addEventListener('DOMContentLoaded', updateState);

  // sincroniza con Bootstrap collapse
  document.addEventListener('DOMContentLoaded', function(){
    var bar = document.querySelector('.m-header');
    var nav = document.getElementById('navbarNav');
    if(!bar || !nav) return;
    nav.addEventListener('shown.bs.collapse', function(){ bar.classList.add('nav-open'); updateState(); });
    nav.addEventListener('hidden.bs.collapse', function(){ bar.classList.remove('nav-open'); updateState(); });
  });
})();
</script>





<script>
(function(){
  function setMbarHeightVar(){
    var m = document.querySelector('.m-header');
    var h = m ? m.offsetHeight : 56;
    document.documentElement.style.setProperty('--mbar-h', h + 'px');
  }

  function wireFixes(){
    var header = document.querySelector('header.site-header');
    var mbar   = document.querySelector('.m-header');
    var nav    = document.getElementById('navbarNav');
    if(!nav) return;

    // Usa Bootstrap si está, si no, fallback
    var BS = (window.bootstrap && window.bootstrap.Collapse) ? window.bootstrap : null;
    var bs = BS ? new BS.Collapse(nav, {toggle:false}) : null;

    function isOpen(){ return nav.classList.contains('show'); }

    function openNav(){
      bs ? bs.show() : nav.classList.add('show');
      document.body.classList.add('nav-open','nav-locked');
      if(header){
        header.classList.add('force-visible','nav-open');
        /* Remueve clases típicas que lo ocultan en scroll */
        header.classList.remove('scrolled-up','header--hide','is-hidden','hidden','header--hidden');
      }
      if(mbar) mbar.classList.add('nav-open');
      setMbarHeightVar();
    }

    function closeNav(){
      bs ? bs.hide() : nav.classList.remove('show');
      document.body.classList.remove('nav-open','nav-locked');
      if(header){
        header.classList.remove('force-visible','nav-open');
      }
      if(mbar) mbar.classList.remove('nav-open');
    }

    // Sincroniza con eventos Bootstrap si existen
    if (bs) {
      nav.addEventListener('shown.bs.collapse', openNav, { once:false });
      nav.addEventListener('hidden.bs.collapse', closeNav, { once:false });
    }

    // Toggler(s)
    Array.prototype.slice.call(document.querySelectorAll('[data-bs-target="#navbarNav"]'))
      .forEach(function(btn){
        btn.addEventListener('click', function(){
          setTimeout(function(){ isOpen() ? openNav() : closeNav(); }, 0);
        }, { passive:true });
      });

    // Cerrar con ESC
    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape' && isOpen()) closeNav();
    });

    // Cerrar al navegar a un link real
    nav.addEventListener('click', function(e){
      var el = e.target.closest && e.target.closest('a[href]');
      if(!el) return;
      var href = el.getAttribute('href') || '';
      if(href && href.charAt(0) !== '#') closeNav();
    });

    // Estado “scrolled” sin ocultar el header cuando el menú está abierto
    function applyHeaderState(){
      var scrolled = window.scrollY > 10;
      if(header){
        header.classList.toggle('scrolled', scrolled && !isOpen());
        if(isOpen()) header.classList.add('force-visible');
      }
      if(mbar){
        mbar.classList.toggle('scrolled', scrolled || isOpen());
      }
    }
    window.addEventListener('scroll', applyHeaderState, { passive:true });

    // Inicializaciones
    setMbarHeightVar();
    applyHeaderState();
    window.addEventListener('resize', setMbarHeightVar);
    setTimeout(setMbarHeightVar, 250);
  }

  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', wireFixes);
  } else {
    wireFixes();
  }
})();
</script>