<!--
================================================================================
  CACO CUSTOM HEADER - v5.1
  Sticky header + Mobile drawer (light, app-like design)
  
  TABLE OF CONTENTS:
  ==================
  1. INITIAL FALLBACK SCRIPT (line ~15)
  2. LIQUID VARIABLES & MENU LOGIC (line ~20)
  3. HTML STRUCTURE (line ~45)
     - Announcement Bar
     - Header Top (Logo, Search, Cart)
     - Header Bottom (Navigation)
     - Mobile Drawer
  4. CSS STYLES (line ~1374)
     - CSS Variables
     - Scroll Behavior
     - Announcement Bar
     - Search
     - Navigation & Dropdowns
     - Mobile Drawer
     - Animations
  5. JAVASCRIPT (line ~3312)
     - 5.1 Sticky Header Logic (3317)
     - 5.2 Mega Menu Sidebar (3474)
     - 5.3 Overlay Manager (3536)
     - 5.4 Cart Drawer Integration (3602)
     - 5.5 Cart Count Auto-Update (3619)
     - 5.6 Partner Dropdown (3792)
     - 5.7 Help Center Dropdown (3821)
     - 5.8 Industries Dropdown (3854)
     - 5.9 Announcement Slider (3885)
     - 5.10 Predictive Search (4002)
     - 5.11 Mobile Drawer (4173)
     - 5.12 Voice Search (4426)
     - 5.13 Animated Search Placeholder (4511)
  6. SCHEMA (line ~4505)
  
  LIQUID VARIABLES IN CSS/JS:
  - announcement_font_size (CSS)
  - search_max_width (CSS)
  - mega_sidebar_width (CSS)
  - mega_sidebar_bg (CSS)
  - promo_max_width (CSS)
  - promo_image_height (CSS)
  - enable_predictive_search (JS)
  - predictive_limit (JS)
  - predictive_min_chars (JS)
  - predictive_debounce (JS)
  - predictive_overlay (JS)
================================================================================
-->

<style>
  /* ‚ö° CRITICAL HEADER STYLES (Pre-load) */
  :root {
    --caco-header-height: 178px;
    --announcement-bg: #0051c3;
    --header-bg: #ffffff;
    --primary-blue: #0051c3;

    /* Liquid-controlled variables */
    --caco-announcement-font-size: {{ section.settings.announcement_font_size | default: 13 }};
    --caco-search-max-width: {{ section.settings.search_max_width | default: 900 }};
    --caco-mega-sidebar-width: {{ section.settings.mega_sidebar_width | default: 27 }};
    --caco-mega-sidebar-bg: {{ section.settings.mega_sidebar_bg | default: "#f9fafb" }};
    --caco-promo-max-width: {{ section.settings.promo_max_width | default: 280 }};
    --caco-promo-image-height: {{ section.settings.promo_image_height | default: 200 }};
  }
  
  /* Evita el salto de contenido inyectando el padding antes de que cargue el CSS completo */
  html.has-caco-sticky body,
  body.has-caco-sticky {
    padding-top: var(--caco-header-height) !important;
  }

  /* Asegura que el contenedor no parpadee ni se mueva al cargar */
  .caco-header-wrapper {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 200;
    background: var(--header-bg);
    /* INICIO OCULTO: Se fuerza oculto por defecto hasta que JS confirme "is-ready" */
    opacity: 0;
    visibility: hidden;
    /* Chrome stability fixes */
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000;
    will-change: transform;
  }

  /* Estado LISTO: Solo ahora se muestra */
  .caco-header-wrapper.caco-is-ready {
    opacity: 1 !important;
    visibility: visible !important;
  }

  /* Pre-layout para la barra de anuncios */
  .caco-announcement-bar {
    height: 44px;
    background: var(--announcement-bg);
    overflow: hidden;
  }

  /* üö´ DEFENSIVE HIDING:
     Excluimos estos elementos del √°rbol de renderizado inicial por completo.
     Esto evita que el navegador gaste recursos calculando su layout o 
     descargando iconos secundarios antes de lo necesario. */
  .caco-dropdown,
  .caco-predictive-results,
  .caco-help-dropdown,
  .caco-industries-dropdown,
  .caco-partner-dropdown,
  .caco-mobile-drawer {
    display: none !important;
  }

  /* Restauramos el renderizado una vez que el header est√° estable */
  .caco-is-ready .caco-dropdown,
  .caco-is-ready .caco-predictive-results,
  .caco-is-ready .caco-help-dropdown,
  .caco-is-ready .caco-industries-dropdown,
  .caco-is-ready .caco-partner-dropdown,
  .caco-is-ready .caco-mobile-drawer {
    display: block !important; /* O flex si es necesario, pero block es seguro para contener */
    opacity: 0;
    visibility: hidden;
  }
  
  /* Caso especial para el mega-menu container */
  .caco-is-ready .caco-nav-item.mega-menu > .caco-dropdown {
    display: flex !important;
  }


  /* Fix SVG Flicker */
  .caco-header-wrapper svg {
    display: inline-block;
    vertical-align: middle;
    width: 24px;   /* Tama√±o base para iconos */
    height: 24px;
    flex-shrink: 0;
  }

  /* üö´ CRITICAL: HIDE MOBILE ELEMENTS ON DESKTOP */
  /* This prevents the flash of mobile icons/menus before media queries load */
  .caco-mobile-toggle,
  .caco-search-icon--mobile,
  .caco-mobile-drawer-search,
  .caco-mobile-only-ann,
  .md-only {
    display: none !important;
  }

  /* Show them only on mobile via media query */
  @media (max-width: 1024px) {
    .caco-mobile-toggle { display: inline-flex !important; }
    .caco-search-icon--mobile { display: flex !important; }
    .caco-mobile-drawer-search { display: block !important; }
    .caco-mobile-only-ann { display: block !important; }
    .md-only { display: block !important; }
  }

  /* Skeleton de b√∫squeda para evitar Layout Shift */
  .caco-search-input {
    height: 50px;
    border-radius: 16px;
    border: 1px solid #d1d5db;
    background: #fff;
    width: 100%;
  }

  /* Aseguramos que la navegaci√≥n sea visible solo cuando est√© lista */
  .caco-is-ready .caco-nav-list,
  .has-caco-sticky .caco-nav-list {
    visibility: visible !important;
  }
  
  @media (max-width: 768px) {
    :root { --caco-header-height: 130px; }
  }
</style>
<link rel="stylesheet" href="{{ 'section-header.css' | asset_url }}" media="print" onload="this.media='all'">
<noscript>{{ 'section-header.css' | asset_url | stylesheet_tag }}</noscript>


<script>
  // Fallback ultra-r√°pido para el padding del body
  (function() {
    try {
      document.documentElement.classList.add('has-caco-sticky');
      var h = window.innerWidth <= 768 ? '130px' : '178px';
      document.documentElement.style.setProperty('--caco-header-height', h);
    } catch (e) {}
  })();
</script>

{%- assign caco_search_categories = '' | split: ',' -%}
{%- assign caco_search_handles = '' | split: ',' -%}
{%- assign caco_mega_triggers = section.blocks | where: 'type', 'mega_trigger' -%}
{%- for link in section.settings.menu.links -%}
  {%- assign is_mega = false -%}
  {%- assign link_title_down = link.title | strip | downcase -%}

  {%- for trigger in caco_mega_triggers -%}
    {%- assign trigger_name = trigger.settings.menu_item | downcase -%}
    {%- if trigger_name == link_title_down -%}
      {%- assign is_mega = true -%}
    {%- endif -%}
  {%- endfor -%}

  {%- if is_mega and link.links != blank -%}
    {%- for childlink in link.links -%}
      {%- unless caco_search_handles contains childlink.handle -%}
        {%- assign caco_search_handles = caco_search_handles | push: childlink.handle -%}
        {%- assign combined = childlink.title | append: '||' | append: childlink.url | append: '||' | append: childlink.handle -%}
        {%- assign caco_search_categories = caco_search_categories | push: combined -%}
      {%- endunless -%}
    {%- endfor -%}
  {%- endif -%}
{%- endfor -%}

<div class="caco-header-wrapper" style="opacity:0;visibility:hidden;">
  <!-- -------------------------------------------------------------------------
       3.1 Announcement Bar
       ------------------------------------------------------------------------- -->
  {%- if section.settings.show_announcement -%}
    {%- assign announcements = section.blocks | where: "type", "announcement" -%}
    <div
      class="caco-announcement-bar caco-announcement-bar--{{ section.settings.announcement_effect | default: 'fade' }}"
      id="caco-announcement-bar"
      data-interval="{{ section.settings.announcement_interval | default: 8 }}"
    >
      <div class="caco-container" style="position:relative;display:flex;align-items:center;justify-content:center;height:100%;">
        <div class="caco-announcement-content">
          <div class="caco-announcement-slider">
            {%- if announcements.size > 0 -%}
              {%- comment -%} 
                REDUNDANCIA PARA MOBILE: Mostramos el marquee por defecto en CSS para evitar 
                el parpadeo de reconstrucci√≥n en JS.
              {%- endcomment -%}
              <div class="caco-announcement-marquee-mobile caco-mobile-only-ann">
                <div class="caco-announcement-marquee-track">
                  {%- capture marquee_text -%}
                    {%- for block in announcements -%}{{ block.settings.text | strip_html | strip }}{% unless forloop.last %}   ‚Ä¢   {% endunless %}{%- endfor -%}
                  {%- endcapture -%}
                  <div class="caco-announcement-marquee-item">{{ marquee_text }}</div>
                  <div class="caco-announcement-marquee-item">{{ marquee_text }}</div>
                </div>
              </div>

              {%- for block in announcements -%}
                <div
                  class="caco-announcement-slide {% if forloop.first %}active{% endif %} caco-desktop-only-ann"
                  data-index="{{ forloop.index0 | plus: 0 }}"
                >
                  {{ block.settings.text }}
                </div>
              {%- endfor -%}
            {%- else -%}
              <div class="caco-announcement-slide active" data-index="0">Welcome to our store</div>
            {%- endif -%}
          </div>
        </div>

        <div class="caco-ann-controls">
          <div class="caco-ann-nav-group">
            <button class="caco-ann-nav caco-ann-prev" type="button" aria-label="Previous announcement">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <span class="caco-ann-counter">
              <span id="caco-ann-current">1</span> /
              <span id="caco-ann-total">{{ announcements.size | default: 1 }}</span>
            </span>
            <button class="caco-ann-nav caco-ann-next" type="button" aria-label="Next announcement">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>
         
        </div>
      </div>
    </div>
  {%- endif -%}

  <!-- Overlay used when predictive search is open -->
  <div class="caco-search-overlay" id="caco-search-overlay"></div>

  <!-- TOP HEADER -->
  <!-- -------------------------------------------------------------------------
       3.2 Header Top (Logo, Search, Tools)
       ------------------------------------------------------------------------- -->
  <header class="caco-header-top">
    <div class="caco-container caco-grid-container">
      <div class="caco-area-left">
        <!-- Burger (mobile only) -->
        <button class="caco-mobile-toggle md-hidden" id="caco-mobile-trigger" aria-label="Toggle menu">
          <span class="caco-burger-icon caco-burger-icon--menu">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7">
              <line x1="3" y1="6"  x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </span>
          <span class="caco-burger-icon caco-burger-icon--close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </span>
        </button>

        <!-- Logo -->
        <div class="caco-logo">
          <a href="{{ routes.root_url }}">
            {%- if section.settings.logo != blank -%}
              {%- assign logo_height = section.settings.logo_width | divided_by: section.settings.logo.aspect_ratio -%}
              {{ section.settings.logo | image_url: width: 600 | image_tag: class: 'caco-logo-img', width: section.settings.logo_width, height: logo_height, alt: shop.name, preload: true, fetchpriority: 'high', loading: 'eager' }}
            {%- else -%}
              <span class="caco-logo-text">{{ shop.name }}</span>
            {%- endif -%}
          </a>
        </div>
      </div>

      <!-- Desktop search in the middle -->
      <div class="caco-area-center small-hidden">
        <div class="caco-search-bar-container">
          <form action="{{ routes.search_url }}" method="get" role="search" class="caco-search-form caco-search-form--desktop">
            <div class="caco-search-icon">
              <svg
                class="caco-search-icon-svg"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <circle
                  cx="11"
                  cy="11"
                  r="6"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.9"
                />
                <line
                  x1="15"
                  y1="15"
                  x2="20"
                  y2="20"
                  stroke="currentColor"
                  stroke-width="1.9"
                  stroke-linecap="round"
                />
              </svg>
            </div>

            <!-- VOICE SEARCH BUTTON ‚Äì DESKTOP -->
            <button
              type="button"
              class="caco-search-voice-btn caco-search-voice-btn--desktop"
              aria-label="Search by voice"
            >
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8">
                <path d="M12 3a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V6a3 3 0 0 0-3-3z"></path>
                <path d="M19 11a7 7 0 0 1-14 0"></path>
                <path d="M12 18v3"></path>
                <path d="M9 21h6"></path>
              </svg>
            </button>

            <label class="visually-hidden" for="CacoSearchInputDesktop">Search gloves, helmets, tools and more‚Ä¶</label>
            <input
              id="CacoSearchInputDesktop"
              class="caco-search-input caco-search-input--desktop"
              type="search"
              name="q"
              placeholder="Search gloves, helmets, tools and more‚Ä¶"
              autocomplete="off"
            >
          </form>
          {% if caco_search_categories.size > 0 %}
            <div class="caco-search-categories" data-search-tags="desktop">
              <div class="caco-search-categories__title">Browse by category</div>
              <div class="caco-search-categories__list">
                {% for cat in caco_search_categories %}
                  {% assign parts = cat | split: '||' %}
                  <a class="caco-search-pill" href="{{ parts[1] }}" data-category-handle="{{ parts[2] }}">{{ parts[0] }}</a>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        </div>
      </div>

      <div class="caco-area-right">
        <div class="caco-tools">
          {%- assign partner_links = section.blocks | where: 'type', 'partner_link' -%}
          {%- if partner_links.size > 0 -%}
            <div class="caco-partner-menu small-hidden">
              <button type="button" class="caco-icon-btn caco-partner-toggle" aria-haspopup="true" aria-expanded="false">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path d="M8 10a4 4 0 118 0 4 4 0 01-8 0z"></path>
                  <path d="M3 21a7 7 0 0118 0"></path>
                  <path d="M4 7h4"></path>
                  <path d="M16 7h4"></path>
                </svg>
              </button>
              <div class="caco-partner-dropdown" role="menu">
                <ul>
                  {%- for block in partner_links -%}
                    <li><a href="{{ block.settings.url }}" class="caco-partner-link">{{ block.settings.label }}</a></li>
                  {%- endfor -%}
                </ul>
              </div>
            </div>
          {%- endif -%}

          {% if shop.customer_accounts_enabled %}
            <a href="{{ routes.account_url }}" class="caco-link-login small-hidden">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </a>
          {% endif %}

          <a
            href="{{ routes.cart_url }}"
            class="caco-icon-btn caco-cart-btn"
            data-caco-cart-drawer
            aria-label="{{ 'sections.cart.title' | t }}"
          >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"></path>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <path d="M16 10a4 4 0 01-8 0"></path>
            </svg>
            {%- if cart.item_count > 0 -%}
              <div class="caco-cart-count">{{ cart.item_count }}</div>
            {%- endif -%}
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- DESKTOP NAVIGATION -->
  <!-- -------------------------------------------------------------------------
       3.3 Header Bottom (Desktop Navigation)
       ------------------------------------------------------------------------- -->
  <div class="caco-header-bottom small-hidden">
    <div class="caco-container">
      <nav class="caco-nav">
        <ul class="caco-nav-list">
          {%- for link in section.settings.menu.links -%}
            {%- assign is_mega = false -%}
            {%- assign link_title_down = link.title | strip | downcase -%}

            {%- for block in section.blocks -%}
              {%- if block.type == 'mega_trigger' -%}
                {%- assign trigger_name = block.settings.menu_item | downcase -%}
                {%- if trigger_name == link_title_down -%}
                  {%- assign is_mega = true -%}
                {%- endif -%}
              {%- endif -%}
            {%- endfor -%}

            <li class="caco-nav-item {% if is_mega %}mega-menu{% endif %}">
              <a href="{{ link.url }}" class="caco-nav-link {% if link.current %}active{% endif %}">
                {{ link.title | escape }}
                {%- for block in section.blocks -%}
                  {%- if block.type == 'badge' and block.settings.link_title != blank -%}
                    {%- assign badge_target = block.settings.link_title | strip | downcase -%}
                    {%- if badge_target == link_title_down -%}
                      <span class="caco-badge" style="background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}">{{ block.settings.text }}</span>
                    {%- endif -%}
                  {%- endif -%}
                {%- endfor -%}
              </a>

              {%- if link.links != blank -%}
                <div class="caco-dropdown">


{%- if is_mega -%}
  {%- comment %}
    Detectar si este mega menu tiene promos a la derecha.
  {% endcomment -%}
  {%- assign has_promos_for_menu = false -%}
  {%- for block in section.blocks -%}
    {%- if block.type == 'promo_block' -%}
      {%- assign target_menu = block.settings.menu_handle | handleize -%}
      {%- if block.settings.apply_global or target_menu == link.handle -%}
        {%- assign has_promos_for_menu = true -%}
      {%- endif -%}
    {%- endif -%}
  {%- endfor -%}

  <!-- Mega menu -->
  <div class="caco-mega-container{% unless has_promos_for_menu %} caco-mega-container--no-promos{% endunless %}">





                      {%- assign first_panel_handle = '' -%}
                      {%- for childlink in link.links -%}
                        {%- if first_panel_handle == '' and childlink.links != blank -%}
                          {%- assign first_panel_handle = childlink.handle -%}
                        {%- endif -%}
                      {%- endfor -%}






                      <!-- Sidebar -->
                      <div class="caco-mega-sidebar">
                        <ul>
                            {%- for childlink in link.links -%}
                              {%- assign child_title_down = childlink.title | strip | downcase -%}
                              {%- assign child_handle_down = childlink.handle | strip | downcase -%}
                              {%- assign is_sale_link = false -%}
                              {%- assign has_panel_content = false -%}
                              {%- if childlink.links != blank -%}
                                {%- assign has_panel_content = true -%}
                              {%- endif -%}
                              {%- if child_title_down == 'sale' or child_handle_down == 'sale' -%}
                                {%- assign is_sale_link = true -%}
                              {%- endif -%}
                              {%- assign is_default_active = false -%}
                              {%- if first_panel_handle != '' and childlink.handle == first_panel_handle -%}
                                {%- assign is_default_active = true -%}
                              {%- elsif first_panel_handle == '' and forloop.first -%}
                                {%- assign is_default_active = true -%}
                              {%- endif -%}
                            <li>
                              <a
                                href="{{ childlink.url }}"
                                class="caco-mega-sidebar-link {% if is_default_active %}active{% endif %}{% if is_sale_link %} caco-mega-sidebar-link--sale{% endif %}{% unless has_panel_content %} caco-mega-sidebar-link--no-panel{% endunless %}"
                                {% if has_panel_content %}data-target="{{ childlink.handle }}"{% endif %}
                              >
                                <span class="caco-mega-sidebar-link__label{% if is_sale_link %} caco-mega-sidebar-link__label--sale{% endif %}">
                                  {% if is_sale_link %}
                                    <span class="caco-sale-icon" role="img" aria-label="Sale" aria-hidden="false">
                                      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20.59 13.41L12 4.83a2 2 0 00-1.41-.58H4v6.59a2 2 0 00.59 1.41l8.58 8.59a2 2 0 002.83 0l4.59-4.59a2 2 0 000-2.83z" stroke-linecap="round" stroke-linejoin="round"></path>
                                        <circle cx="7.5" cy="7.5" r="1.5" fill="currentColor" stroke="none"></circle>
                                      </svg>
                                    </span>
                                  {% endif %}
                                  {{ childlink.title }}
                                  {%- for block in section.blocks -%}
                                    {%- if block.type == 'badge' and block.settings.link_title != blank -%}
                                      {%- assign badge_target = block.settings.link_title | strip | downcase -%}
                                      {%- if badge_target == child_title_down -%}
                                        <span class="caco-badge small" style="background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}">{{ block.settings.text }}</span>
                                      {%- endif -%}
                                    {%- endif -%}
                                  {%- endfor -%}
                                </span>
                                <svg class="caco-chevron" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                              </a>
                            </li>
                          {%- endfor -%}
                        </ul>
                      </div>

                      <!-- Main content panels -->
                      <div class="caco-mega-content">
                        {%- for childlink in link.links -%}
                          {%- if childlink.links == blank -%}
                            {%- continue -%}
                          {%- endif -%}
                          {%- assign child_title_down = childlink.title | strip | downcase -%}
                          <div class="caco-mega-panel {% if childlink.handle == first_panel_handle %}active{% endif %}" id="panel-{{ childlink.handle }}">
                            <a href="{{ childlink.url }}" class="caco-mega-panel-title-link">
                              <h3 class="caco-mega-panel-title">
                                {{ childlink.title }}
                                <span class="caco-see-all">View all</span>
                              </h3>
                            </a>

                            {%- if childlink.links != blank -%}
                              <ul class="caco-mega-grid">
                                {%- for grandchild in childlink.links -%}
                                  {%- assign grand_title_down = grandchild.title | strip | downcase -%}
                                  <li>
                                    <a href="{{ grandchild.url }}">
                                      {{ grandchild.title }}
                                      {%- for block in section.blocks -%}
                                        {%- if block.type == 'badge' and block.settings.link_title != blank -%}
                                          {%- assign badge_target = block.settings.link_title | strip | downcase -%}
                                          {%- if badge_target == grand_title_down -%}
                                            <span class="caco-badge mini" style="background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}">{{ block.settings.text }}</span>
                                          {%- endif -%}
                                        {%- endif -%}
                                      {%- endfor -%}
                                    </a>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            {%- endif -%}

                            <!-- Inline promos area (center) -->
                            {%- assign current_panel_handle = childlink.handle -%}
                            <div class="caco-mega-inline-promos">
                              {%- for block in section.blocks -%}
                                {%- if block.type == 'mega_promo_card' or block.type == 'mega_promo_banner' -%}
                                  {%- assign scope = block.settings.scope | default: 'panel' -%}
                                  {%- assign show_block = false -%}

                                  {%- if scope == 'global' -%}
                                    {%- assign show_block = true -%}
                                  {%- elsif scope == 'menu' and block.settings.parent_menu_handle == link.handle -%}
                                    {%- assign show_block = true -%}
                                  {%- elsif scope == 'panel' and block.settings.panel_handle == current_panel_handle -%}
                                    {%- assign show_block = true -%}
                                  {%- endif -%}

                                  {%- if show_block -%}
                                    {%- if block.type == 'mega_promo_card' -%}
                                      <a href="{{ block.settings.url }}" class="caco-mega-inline-card" {{ block.shopify_attributes }}>
                                        {%- if block.settings.image != blank -%}
                                          <div class="caco-mega-inline-image">
                                            {{ block.settings.image | image_url: width: 260 | image_tag: loading: 'lazy' }}
                                          </div>
                                        {%- endif -%}
                                        <div class="caco-mega-inline-body">
                                          <span class="caco-mega-inline-title">{{ block.settings.title }}</span>
                                          {%- if block.settings.meta != blank -%}
                                            <span class="caco-mega-inline-meta">{{ block.settings.meta }}</span>
                                          {%- endif -%}
                                        </div>
                                      </a>
                                    {%- else -%}
                                      <a href="{{ block.settings.url }}" class="caco-mega-inline-banner" {{ block.shopify_attributes }}>
                                        {%- if block.settings.image != blank -%}
                                          {{ block.settings.image | image_url: width: 600 | image_tag: loading: 'lazy' }}
                                        {%- endif -%}
                                        {%- if block.settings.text != blank -%}
                                          <span class="caco-mega-inline-banner-text">{{ block.settings.text }}</span>
                                        {%- endif -%}
                                      </a>
                                    {%- endif -%}
                                  {%- endif -%}
                                {%- endif -%}
                              {%- endfor -%}
                            </div>
                          </div>
                        {%- endfor -%}
                      </div>

                      <!-- Right column promos -->
                      <div class="caco-mega-promos">
                        {%- assign has_promos = false -%}
                        {%- for block in section.blocks -%}
                          {%- if block.type == 'promo_block' -%}
                            {%- assign target_menu = block.settings.menu_handle | handleize -%}
                            {%- assign show_here = false -%}

                            {%- if block.settings.apply_global -%}
                              {%- assign show_here = true -%}
                            {%- elsif target_menu == link.handle -%}
                              {%- assign show_here = true -%}
                            {%- endif -%}

                            {%- if show_here -%}
                              {%- assign has_promos = true -%}
                              <div class="caco-promo-card" {{ block.shopify_attributes }}>
                                {%- if block.settings.image != blank -%}
                                  <div class="caco-promo-img-wrap">
                                    {{ block.settings.image | image_url: width: 600 | image_tag: loading: 'lazy' }}
                                  </div>
                                {%- endif -%}
                                <div class="caco-promo-text">
                                  {%- if block.settings.title != blank -%}
                                    <h4>{{ block.settings.title }}</h4>
                                  {%- endif -%}
                                  {%- if block.settings.coupon != blank -%}
                                    <div class="caco-coupon-box">
                                      <span>Code: <strong>{{ block.settings.coupon }}</strong></span>
                                    </div>
                                  {%- endif -%}
                                  {%- if block.settings.countdown_date != blank -%}
                                    <div class="caco-countdown" data-date="{{ block.settings.countdown_date }}">Loading...</div>
                                  {%- endif -%}
                                  {%- if block.settings.link != blank -%}
                                    <a href="{{ block.settings.link }}" class="caco-promo-btn">Shop now</a>
                                  {%- endif -%}
                                </div>
                              </div>
                            {%- endif -%}
                          {%- endif -%}
                        {%- endfor -%}
                      </div>
                    </div>
                  {%- else -%}
                    <!-- Simple dropdown mejorado: muestra todos los submen√∫s -->
                    <div class="caco-simple-dropdown">
                      <ul class="caco-simple-list">
                        {%- for childlink in link.links -%}
                          {%- assign child_title_down = childlink.title | strip | downcase -%}
                          <li class="caco-simple-item">
                            <!-- Nivel 1 -->
                            <a href="{{ childlink.url }}" class="caco-simple-link caco-simple-link--parent">
                              <span class="caco-simple-title">
                                {{ childlink.title }}
                                {%- for block in section.blocks -%}
                                  {%- if block.type == 'badge' and block.settings.link_title != blank -%}
                                    {%- assign badge_target = block.settings.link_title | strip | downcase -%}
                                    {%- if badge_target == child_title_down -%}
                                      <span class="caco-badge small" style="background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}">
                                        {{ block.settings.text }}
                                      </span>
                                    {%- endif -%}
                                  {%- endif -%}
                                {%- endfor -%}
                              </span>
                            </a>

                            {%- if childlink.links != blank -%}
                              <!-- Nivel 2 (submen√∫s) -->
                              <ul class="caco-simple-sub">
                                {%- for grandchild in childlink.links -%}
                                  {%- assign grand_title_down = grandchild.title | strip | downcase -%}
                                  <li>
                                    <a href="{{ grandchild.url }}" class="caco-simple-link caco-simple-link--child">
                                      <span class="caco-simple-sub-title">
                                        {{ grandchild.title }}
                                        {%- for block in section.blocks -%}
                                          {%- if block.type == 'badge' and block.settings.link_title != blank -%}
                                            {%- assign badge_target = block.settings.link_title | strip | downcase -%}
                                            {%- if badge_target == grand_title_down -%}
                                              <span class="caco-badge mini" style="background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}">
                                                {{ block.settings.text }}
                                              </span>
                                            {%- endif -%}
                                          {%- endif -%}
                                        {%- endfor -%}
                                      </span>
                                    </a>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            {%- endif -%}
                          </li>
                        {%- endfor -%}
                      </ul>
                    </div>
                  {%- endif -%}

                </div>
              {%- endif -%}
            </li>
          {%- endfor -%}
        </ul>













        <div class="caco-nav-right-links">
          {%- assign help_items = section.blocks | where: 'type', 'help_menu_item' -%}
          {%- assign industry_items = section.blocks | where: 'type', 'industry_menu_item' -%}

          {%- if help_items.size > 0 -%}
            <!-- HELP CENTER DROPDOWN (DESKTOP) -->
            <div class="caco-help-menu">
              <button
                type="button"
                class="caco-nav-aux-link caco-help-toggle"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <span class="caco-nav-aux-icon">
                  {%- if section.settings.help_icon_svg != blank -%}
                    {{ section.settings.help_icon_svg }}
                  {%- else -%}
                    <svg
                      class="caco-help-svg-desktop"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                    >
                      <circle
                        cx="12"
                        cy="12"
                        r="9"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.8"
                      />
                      <path
                        d="M12 16.4v-1.4"
                        stroke="currentColor"
                        stroke-width="1.8"
                        stroke-linecap="round"
                      />
                      <path
                        d="M10.4 9.2a1.8 1.8 0 1 1 3 1.4c-.4.3-.8.6-1.1.9-.4.4-.5.7-.5 1.3"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.8"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  {%- endif -%}
                </span>
                <span class="caco-nav-aux-text">
                  {{ section.settings.help_label | default: 'Help Center' }}
                </span>
                <svg
                  class="caco-help-chevron"
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.6"
                >
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>

              <div class="caco-help-dropdown" role="menu">
                <ul>
                  {%- for block in help_items -%}
                    <li>
                      <a
                        href="{{ block.settings.url }}"
                        class="caco-help-link"
                        {{ block.shopify_attributes }}
                      >
                        {%- if block.settings.icon_svg != blank -%}
                          <span class="caco-help-icon" aria-hidden="true">
                            {{ block.settings.icon_svg }}
                          </span>
                        {%- endif -%}

                        <span class="caco-help-copy">
                          <span class="caco-help-title">
                            {{ block.settings.label }}
                          </span>
                          {%- if block.settings.description != blank -%}
                            <span class="caco-help-description">
                              {{ block.settings.description }}
                            </span>
                          {%- endif -%}
                        </span>

                        {%- if block.settings.show_badge -%}
                          <span class="caco-help-badge">
                            {{ block.settings.badge_text | default: 'New' }}
                          </span>
                        {%- endif -%}
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            </div>

          {%- elsif section.settings.help_link != blank -%}
            <!-- SIMPLE HELP PILL (SIN DROPDOWN) -->
            <a
              href="{{ section.settings.help_link }}"
              class="caco-nav-aux-link caco-nav-aux-link--help"
            >
              <span class="caco-nav-aux-icon">
                {%- if section.settings.help_icon_svg != blank -%}
                  {{ section.settings.help_icon_svg }}
                {%- else -%}
                  <svg
                    class="caco-help-svg-desktop"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <circle
                      cx="12"
                      cy="12"
                      r="9"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.8"
                    />
                    <path
                      d="M12 16.4v-1.4"
                      stroke="currentColor"
                      stroke-width="1.8"
                      stroke-linecap="round"
                    />
                    <path
                      d="M10.4 9.2a1.8 1.8 0 1 1 3 1.4c-.4.3-.8.6-1.1.9-.4.4-.5.7-.5 1.3"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.8"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                {%- endif -%}
              </span>
              <span class="caco-nav-aux-text">
                {{ section.settings.help_label | default: 'Help Center' }}
              </span>
            </a>
          {%- endif -%}

          {%- if industry_items.size > 0 -%}
            <!-- INDUSTRIES DROPDOWN (DESKTOP) -->
            <div class="caco-industries-menu">
              <button
                type="button"
                class="caco-nav-aux-link caco-industries-toggle"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <span class="caco-nav-aux-icon">
                  {%- if section.settings.industries_icon_svg != blank -%}
                    {{ section.settings.industries_icon_svg }}
                  {%- else -%}
                    <svg
                      class="caco-help-svg-desktop"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                    >
                      <circle
                        cx="12"
                        cy="12"
                        r="9"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.8"
                      />
                      <path
                        d="M8 14h8"
                        stroke="currentColor"
                        stroke-width="1.6"
                        stroke-linecap="round"
                      />
                      <path
                        d="M9 10l2-3h2l2 3"
                        stroke="currentColor"
                        stroke-width="1.6"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  {%- endif -%}
                </span>
                <span class="caco-nav-aux-text">
                  {{ section.settings.industries_label | default: 'Industries' }}
                </span>
                <svg
                  class="caco-help-chevron"
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.6"
                >
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>

              <div class="caco-industries-dropdown" role="menu">
                <ul>
                  {%- for block in industry_items -%}
                    <li>
                      <a
                        href="{{ block.settings.url }}"
                        class="caco-help-link"
                        {{ block.shopify_attributes }}
                      >
                        {%- if block.settings.icon_svg != blank -%}
                          <span class="caco-help-icon" aria-hidden="true">
                            {{ block.settings.icon_svg }}
                          </span>
                        {%- endif -%}

                        <span class="caco-help-copy">
                          <span class="caco-help-title">
                            {{ block.settings.label }}
                          </span>
                          {%- if block.settings.description != blank -%}
                            <span class="caco-help-description">
                              {{ block.settings.description }}
                            </span>
                          {%- endif -%}
                        </span>

                        {%- if block.settings.show_badge -%}
                          <span class="caco-help-badge">
                            {{ block.settings.badge_text | default: 'New' }}
                          </span>
                        {%- endif -%}
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            </div>

          {%- elsif section.settings.industries_link != blank -%}
            <!-- SIMPLE INDUSTRIES PILL (SIN DROPDOWN) -->
            <a
              href="{{ section.settings.industries_link }}"
              class="caco-nav-aux-link caco-nav-aux-link--industries"
            >
              <span class="caco-nav-aux-icon">
                {%- if section.settings.industries_icon_svg != blank -%}
                  {{ section.settings.industries_icon_svg }}
                {%- else -%}
                  <svg
                    class="caco-help-svg-desktop"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <circle
                      cx="12"
                      cy="12"
                      r="9"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.8"
                    />
                    <path
                      d="M8 14h8"
                      stroke="currentColor"
                      stroke-width="1.6"
                      stroke-linecap="round"
                    />
                    <path
                      d="M9 10l2-3h2l2 3"
                      stroke="currentColor"
                      stroke-width="1.6"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                {%- endif -%}
              </span>
              <span class="caco-nav-aux-text">
                {{ section.settings.industries_label | default: 'Industries' }}
              </span>
            </a>
          {%- endif -%}

          <div class="caco-loading-icon" aria-hidden="true">
            <span class="caco-loading-dot"></span>
            <span class="caco-loading-dot"></span>
            <span class="caco-loading-dot"></span>
          </div>
        </div>































            <span class="caco-loading-dot"></span>
            <span class="caco-loading-dot"></span>
            <span class="caco-loading-dot"></span>
          </div>
        </div>
      </nav>
    </div>
  </div>

  <!-- MOBILE OVERLAY + DRAWER (Panels) -->
  <div class="caco-mobile-overlay md-hidden" id="caco-mobile-overlay"></div>
  <!-- -------------------------------------------------------------------------
       3.4 Mobile Drawer (Navigation & Mobile Search)
       ------------------------------------------------------------------------- -->
  <div class="caco-mobile-drawer md-hidden" id="caco-mobile-drawer" aria-hidden="true">
    <div class="caco-mobile-drawer-inner">
      <!-- Search inside drawer -->  
      <div class="caco-mobile-drawer-search">
        <form action="{{ routes.search_url }}" method="get" role="search" class="caco-search-form caco-search-form--mobile">
          <div class="caco-search-icon caco-search-icon--mobile">
            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
            </svg>
          </div>

          <!-- VOICE SEARCH BUTTON ‚Äì MOBILE -->
          <button
            type="button"
            class="caco-search-voice-btn caco-search-voice-btn--mobile"
            aria-label="Search by voice"
          >
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8">
              <path d="M12 3a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V6a3 3 0 0 0-3-3z"></path>
              <path d="M19 11a7 7 0 0 1-14 0"></path>
              <path d="M12 18v3"></path>
              <path d="M9 21h6"></path>
            </svg>
          </button>

          <label class="visually-hidden" for="CacoSearchInputMobile">Search gloves, helmets, tools and more‚Ä¶</label>
          <input
            id="CacoSearchInputMobile"
            class="caco-search-input caco-search-input--mobile"
            type="search"
            name="q"
            placeholder="Search gloves, helmets, tools and more‚Ä¶"
            autocomplete="off"
          >
        </form>
        {% if caco_search_categories.size > 0 %}
          <div class="caco-search-categories" data-search-tags="mobile">
            <div class="caco-search-categories__title">Browse by category</div>
            <div class="caco-search-categories__list">
              {% for cat in caco_search_categories %}
                {% assign parts = cat | split: '||' %}
                <a class="caco-search-pill" href="{{ parts[1] }}" data-category-handle="{{ parts[2] }}">{{ parts[0] }}</a>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>

      <div class="caco-mobile-drawer-header">
        <div class="caco-mobile-drawer-grabber"></div>
        <button class="caco-mobile-back" type="button" aria-label="Back">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <span class="caco-mobile-drawer-title" data-panel-title>Menu</span>

        <div class="caco-loading-icon caco-loading-icon--mobile" aria-hidden="true">
          <span class="caco-loading-dot"></span>
          <span class="caco-loading-dot"></span>
          <span class="caco-loading-dot"></span>
        </div>
      </div>

      <!-- Mobile navigation: panel-based -->
      <div class="caco-mobile-drawer-content">
        <div class="caco-mobile-panels">

          <!-- PANEL HELP CENTER -->
          <div
            class="caco-mobile-panel"
            data-panel-id="panel-help-center"
            data-panel-title="{{ section.settings.help_label | default: 'Help Center' }}"
          >
            <ul class="caco-mobile-nav">
              <li class="caco-mobile-item">
                <a href="/pages/contact" class="caco-mobile-link caco-mobile-link-sub caco-mobile-link-help-item">
                  <span class="caco-mobile-help-item-text">
                    <span class="caco-mobile-help-item-title">General inquiries</span>
                    <span class="caco-mobile-help-item-sub">Questions, quotes or support</span>
                  </span>
                </a>
              </li>

              <li class="caco-mobile-item">
                <a href="/pages/become-a-distributor" class="caco-mobile-link caco-mobile-link-sub caco-mobile-link-help-item">
                  <span class="caco-mobile-help-item-text">
                    <span class="caco-mobile-help-item-title">Become a distributor</span>
                    <span class="caco-mobile-help-item-sub">Partner with us in your region</span>
                  </span>
                </a>
              </li>

              <li class="caco-mobile-item">
                <a href="/pages/faqs" class="caco-mobile-link caco-mobile-link-sub caco-mobile-link-help-item">
                  <span class="caco-mobile-help-item-text">
                    <span class="caco-mobile-help-item-title">FAQs</span>
                    <span class="caco-mobile-help-item-sub">Fast answers, no waiting</span>
                  </span>
                </a>
              </li>
            </ul>
          </div>

          <!-- PANEL INDUSTRIES (lista interna de industrias) -->
          <div
            class="caco-mobile-panel"
            data-panel-id="panel-industries-center"
            data-panel-title="{{ section.settings.industries_label | default: 'Industries' }}"
          >
            <ul class="caco-mobile-nav">
              {%- assign industry_items = section.blocks | where: 'type', 'industry_menu_item' -%}
              {%- for block in industry_items -%}
                <li class="caco-mobile-item">
                  <a
                    href="{{ block.settings.url }}"
                    class="caco-mobile-link caco-mobile-link-sub caco-mobile-link-help-item"
                    {{ block.shopify_attributes }}
                  >
                    <span class="caco-mobile-help-item-text">
                      <span class="caco-mobile-help-item-title">
                        {{ block.settings.label }}
                      </span>
                      {%- if block.settings.description != blank -%}
                        <span class="caco-mobile-help-item-sub">
                          {{ block.settings.description }}
                        </span>
                      {%- endif -%}
                    </span>
                  </a>
                </li>
              {%- endfor -%}
            </ul>
          </div>

          {%- comment -%} ROOT PANEL {%- endcomment -%}
          <div
            class="caco-mobile-panel is-active"
            data-panel-id="root"
            data-panel-title="Menu"
            data-panel-root
          >
            <ul class="caco-mobile-nav">
              {%- for link in section.settings.menu.links -%}
                {%- assign top_title_down = link.title | strip | downcase -%}
                {%- assign top_handle_down = link.handle | strip | downcase -%}
                {%- assign is_sale_link = false -%}
                {%- if top_title_down == 'sale' or top_handle_down == 'sale' -%}
                  {%- assign is_sale_link = true -%}
                {%- endif -%}

                {%- comment -%}
                  No mostrar "Industries" como item principal en mobile.
                  (Sigue existiendo en desktop y en su propio panel.)
                {%- endcomment -%}
                {%- if top_title_down == 'industries' -%}
                  {%- continue -%}
                {%- endif -%}

                {%- if link.links != blank -%}
                  <li class="caco-mobile-item">
                    <button
                      class="caco-mobile-link caco-mobile-link--has-children{% if is_sale_link %} caco-mobile-link--sale{% endif %}"
                      type="button"
                      data-panel-target="panel-top-{{ link.handle }}"
                    >
                      <span class="caco-mobile-link-label{% if is_sale_link %} caco-mobile-link-label--sale{% endif %}">
                        {{ link.title }}
                        {%- for block in section.blocks -%}
                          {%- if block.type == 'badge' and block.settings.link_title != blank -%}
                            {%- assign badge_target = block.settings.link_title | strip | downcase -%}
                            {%- if badge_target == top_title_down -%}
                              <span class="caco-badge small" style="background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}">{{ block.settings.text }}</span>
                            {%- endif -%}
                          {%- endif -%}
                        {%- endfor -%}
                      </span>
                      <span class="caco-mobile-icon caco-mobile-icon--forward">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                          <polyline points="9 6 15 12 9 18"></polyline>
                        </svg>
                      </span>
                    </button>
                  </li>
                {%- else -%}
                  <li class="caco-mobile-item">
                    <a href="{{ link.url }}" class="caco-mobile-link{% if is_sale_link %} caco-mobile-link--sale caco-mobile-link--pill{% endif %}">
                      <span class="caco-mobile-link-label{% if is_sale_link %} caco-mobile-link-label--sale{% endif %}">
                        {{ link.title }}
                        {%- for block in section.blocks -%}
                          {%- if block.type == 'badge' and block.settings.link_title != blank -%}
                            {%- assign badge_target = block.settings.link_title | strip | downcase -%}
                            {%- if badge_target == top_title_down -%}
                              <span class="caco-badge small" style="background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}">{{ block.settings.text }}</span>
                            {%- endif -%}
                          {%- endif -%}
                        {%- endfor -%}
                      </span>
                    </a>
                  </li>
                {%- endif -%}
              {%- endfor -%}

              {%- comment -%}
                Help Center + Industries al final del root, pensados para ir lado a lado en mobile.
              {%- endcomment -%}



              <li class="caco-mobile-item caco-mobile-item--help-industries">
                <div class="caco-mobile-dual-card-row">
                  <!-- Help Center card -->
                  <button
                    type="button"
                    class="caco-mobile-link caco-mobile-link-help"
                    data-panel-target="panel-help-center"
                  >
                   
                   
                   
                   
                   
  <span class="caco-mobile-help-icon">
  {%- if section.settings.help_icon_svg != blank -%}
    {{ section.settings.help_icon_svg }}
  {%- else -%}
    <svg
      class="caco-help-svg"
      viewBox="0 0 24 24"
      aria-hidden="true"
      fill="none"
      stroke="currentColor"
      stroke-width="2.2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <!-- Bold question mark -->
      <path d="M9.3 9.2a2.9 2.9 0 0 1 5.1-1.9c.9 1.2.7 2.8-.4 3.7-.7.6-1.3 1-1.7 1.4-.4.5-.6.9-.6 1.7v.6" />
      <path d="M12 17.8h0.01" />
    </svg>




  {%- endif -%}
</span>


                    <span class="caco-mobile-help-text">
                      <span class="caco-mobile-help-title">
                        {{ section.settings.help_label | default: 'Help Center' }}
                      </span>
                      <span class="caco-mobile-help-sub">
                        {{ section.settings.help_sub_label | default: 'Support, FAQs & contact' }}
                      </span>
                    </span>

                    <span class="caco-mobile-icon caco-mobile-icon--forward">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                        <polyline points="9 6 15 12 9 18"></polyline>
                      </svg>
                    </span>
                  </button>







                  <!-- Industries card -->
                  <button
                    type="button"
                    class="caco-mobile-link caco-mobile-link-help caco-mobile-link-industries"
                    data-panel-target="panel-industries-center"
                  >






      <span class="caco-mobile-help-icon">
    {%- if section.settings.industries_icon_svg != blank -%}
      {{ section.settings.industries_icon_svg }}
    {%- else -%}
      <svg
        class="caco-help-svg"
        viewBox="0 0 24 24"
        aria-hidden="true"
        fill="none"
        stroke="currentColor"
        stroke-width="1.7"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <!-- Engranaje tipo ‚Äúsettings‚Äù -->
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M19.4 15a1.6 1.6 0 0 0 .3 1.8l.1.1a1.9 1.9 0 0 1-2.7 2.7l-.1-.1a1.6 1.6 0 0 0-1.8-.3 1.6 1.6 0 0 0-1 1.5V21a2 2 0 0 1-4 0v-.2a1.6 1.6 0 0 0-1-1.5 1.6 1.6 0 0 0-1.8.3l-.1.1a1.9 1.9 0 0 1-2.7-2.7l.1-.1a1.6 1.6 0 0 0 .3-1.8 1.6 1.6 0 0 0-1.5-1H3a2 2 0 0 1 0-4h.2a1.6 1.6 0 0 0 1.5-1 1.6 1.6 0 0 0-.3-1.8l-.1-.1a1.9 1.9 0 0 1 2.7-2.7l.1.1a1.6 1.6 0 0 0 1.8.3h.1A1.6 1.6 0 0 0 10.8 3V3a2 2 0 0 1 4 0v.2a1.6 1.6 0 0 0 1 1.5h.1a1.6 1.6 0 0 0 1.8-.3l.1-.1a1.9 1.9 0 0 1 2.7 2.7l-.1.1a1.6 1.6 0 0 0-.3 1.8v.1a1.6 1.6 0 0 0 1.5 1H21a2 2 0 0 1 0 4h-.2a1.6 1.6 0 0 0-1.4 1Z"></path>
      </svg>
    {%- endif -%}
  </span>




  


                    <span class="caco-mobile-help-text">
                      <span class="caco-mobile-help-title">
                        {{ section.settings.industries_label | default: 'Industries' }}
                      </span>
                      <span class="caco-mobile-help-sub">
                        Solutions by industry
                      </span>
                    </span>

                    <span class="caco-mobile-icon caco-mobile-icon--forward">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                        <polyline points="9 6 15 12 9 18"></polyline>
                      </svg>
                    </span>
                  </button>
                </div>
              </li>








            </ul>
          </div>

          {%- comment -%} PANELS NIVEL 2 {%- endcomment -%}
          {%- for link in section.settings.menu.links -%}
            {%- assign top_title_down = link.title | strip | downcase -%}
            {%- if link.links != blank -%}
              <div
                class="caco-mobile-panel"
                data-panel-id="panel-top-{{ link.handle }}"
                data-panel-title="{{ link.title | escape }}"
              >
                <ul class="caco-mobile-nav">
                  {%- assign products_labels = 'Products,Productos' | split: ',' -%}
                  {%- if products_labels contains link.title -%}
                    <li class="caco-mobile-item">
                      <a href="/collections/all" class="caco-mobile-link caco-mobile-link-sub caco-mobile-link--pill" style="text-decoration: none;">
                        <span class="caco-mobile-link-label">All Products</span>
                      </a>
                    </li>
                  {%- endif -%}
                  {%- for childlink in link.links -%}
                    {%- assign child_title_down = childlink.title | strip | downcase -%}
                    {%- assign child_handle_down = childlink.handle | strip | downcase -%}
                    {%- assign is_sale_child = false -%}
                    {%- if child_title_down == 'sale' or child_handle_down == 'sale' -%}
                      {%- assign is_sale_child = true -%}
                    {%- endif -%}
                    {%- if childlink.links != blank -%}
                      <li class="caco-mobile-item">
                        <button
                          class="caco-mobile-link caco-mobile-link--has-children{% if is_sale_child %} caco-mobile-link--sale caco-mobile-link--pill{% endif %}"
                          type="button"
                          data-panel-target="panel-sub-{{ childlink.handle }}"
                        >
                          <span class="caco-mobile-link-label{% if is_sale_child %} caco-mobile-link-label--sale{% endif %}">
                            {{ childlink.title }}
                            {%- for block in section.blocks -%}
                              {%- if block.type == 'badge' and block.settings.link_title != blank -%}
                                {%- assign badge_target = block.settings.link_title | strip | downcase -%}
                                {%- if badge_target == child_title_down -%}
                                  <span class="caco-badge small" style="background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}">{{ block.settings.text }}</span>
                                {%- endif -%}
                              {%- endif -%}
                            {%- endfor -%}
                          </span>
                          <span class="caco-mobile-icon caco-mobile-icon--forward">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                              <polyline points="9 6 15 12 9 18"></polyline>
                            </svg>
                          </span>
                        </button>
                      </li>
                    {%- else -%}
                      <li class="caco-mobile-item">
                        <a href="{{ childlink.url }}" class="caco-mobile-link caco-mobile-link-sub{% if is_sale_child %} caco-mobile-link--sale caco-mobile-link--pill{% endif %}">
                          <span class="caco-mobile-link-label{% if is_sale_child %} caco-mobile-link-label--sale{% endif %}">
                            {{ childlink.title }}
                            {%- for block in section.blocks -%}
                              {%- if block.type == 'badge' and block.settings.link_title != blank -%}
                                {%- assign badge_target = block.settings.link_title | strip | downcase -%}
                                {%- if badge_target == child_title_down -%}
                                  <span class="caco-badge small" style="background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}">{{ block.settings.text }}</span>
                                {%- endif -%}
                              {%- endif -%}
                            {%- endfor -%}
                          </span>
                        </a>
                      </li>
                    {%- endif -%}
                  {%- endfor -%}
                </ul>
              </div>

              {%- comment -%} PANELS NIVEL 3 {%- endcomment -%}
              {%- for childlink in link.links -%}
                {%- if childlink.links != blank -%}
                  {%- assign child_title_down = childlink.title | strip | downcase -%}
                  <div
                    class="caco-mobile-panel"
                    data-panel-id="panel-sub-{{ childlink.handle }}"
                    data-panel-title="{{ childlink.title | escape }}"
                  >
                    <ul class="caco-mobile-nav">
                      <li class="caco-mobile-item caco-mobile-item--all">
                        <a
                          href="{{ childlink.url }}"
                          class="caco-mobile-link caco-mobile-link-sub caco-mobile-link-all"
                        >
                          <span class="caco-mobile-link-label">
                            All {{ childlink.title }}
                          </span>
                        </a>
                      </li>

                      {%- for grandchild in childlink.links -%}
                        {%- assign grand_title_down = grandchild.title | strip | downcase -%}
                        <li class="caco-mobile-item">
                          <a href="{{ grandchild.url }}" class="caco-mobile-link caco-mobile-link-grand">
                            <span class="caco-mobile-link-label">
                              {{ grandchild.title }}
                              {%- for block in section.blocks -%}
                                {%- if block.type == 'badge' and block.settings.link_title != blank -%}
                                  {%- assign badge_target = block.settings.link_title | strip | downcase -%}
                                  {%- if badge_target == grand_title_down -%}
                                    <span class="caco-badge mini" style="background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}">{{ block.settings.text }}</span>
                                  {%- endif -%}
                                {%- endif -%}
                              {%- endfor -%}
                            </span>
                          </a>
                        </li>
                      {%- endfor -%}
                    </ul>
                  </div>
                {%- endif -%}
              {%- endfor -%}
            {%- endif -%}
          {%- endfor -%}

        </div>
      </div>





      <!-- Footer links inside drawer (blocks) -->
      <div class="caco-mobile-drawer-footer">
        {%- assign footer_links = section.blocks | where: 'type', 'drawer_footer_link' -%}
        {%- for block in footer_links -%}
          {%- if block.settings.enabled and block.settings.label != blank and block.settings.url != blank -%}
            <a href="{{ block.settings.url }}" class="caco-mobile-footer-link" {{ block.shopify_attributes }}>
              {%- if block.settings.icon != blank -%}
                <span class="caco-mobile-footer-icon">{{ block.settings.icon }}</span>
              {%- endif -%}
              <span>{{ block.settings.label }}</span>
            </a>
          {%- endif -%}
        {%- endfor -%}
      </div>

    </div>
  </div>
</div>


<!-- ============================================================================
     5. JAVASCRIPT (Optimized & Externalized)
     ============================================================================ -->
<script>
  window.CacoHeaderConfig = {
    searchBase: '{{ routes.search_url }}',
    predictiveEnabled: {{ section.settings.enable_predictive_search | default: true | json }},
    predictiveLimit: {{ section.settings.predictive_limit | default: 5 | json }},
    predictiveMinChars: {{ section.settings.predictive_min_chars | default: 2 | json }},
    predictiveDebounce: {{ section.settings.predictive_debounce | default: 250 | json }},
    predictiveOverlayOn: {{ section.settings.predictive_overlay | default: true | json }}
  };
</script>
<script src="{{ 'section-header.js' | asset_url }}" defer="defer"></script>


{%- render 'cart-drawer' -%}






<!-- ============================================================================
     6. SCHEMA
     ============================================================================ -->
{% schema %}
{
  "name": "t:sections.header.name",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 10,
      "default": 180,
      "unit": "px",
      "label": "Logo width"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    },
    {
      "type": "checkbox",
      "id": "show_announcement",
      "label": "Show announcement bar",
      "default": true
    },
    {
      "type": "range",
      "id": "announcement_font_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "default": 13,
      "unit": "px",
      "label": "Announcement text size"
    },
    {
      "type": "range",
      "id": "announcement_interval",
      "min": 3,
      "max": 20,
      "step": 1,
      "default": 8,
      "unit": "sec",
      "label": "Announcement rotation interval"
    },
    {
      "type": "select",
      "id": "announcement_effect",
      "label": "Announcement transition",
      "default": "fade",
      "options": [
        { "value": "fade", "label": "Fade" },
        { "value": "slide", "label": "Slide up" }
      ]
    },
    {
      "type": "range",
      "id": "search_max_width",
      "min": 300,
      "max": 1100,
      "step": 20,
      "default": 900,
      "unit": "px",
      "label": "Desktop search bar max width"
    },
    {
      "type": "checkbox",
      "id": "enable_predictive_search",
      "label": "Enable predictive search (desktop & mobile)",
      "default": true
    },
    {
      "type": "range",
      "id": "predictive_limit",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 5,
      "label": "Predictive search result limit"
    },
    {
      "type": "range",
      "id": "predictive_min_chars",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 2,
      "label": "Minimum characters to start predictive search"
    },
    {
      "type": "range",
      "id": "predictive_debounce",
      "min": 100,
      "max": 600,
      "step": 50,
      "default": 250,
      "unit": "ms",
      "label": "Predictive search debounce time"
    },
    {
      "type": "checkbox",
      "id": "predictive_overlay",
      "label": "Darken background when predictive search is open",
      "default": true
    },
    {
      "type": "range",
      "id": "mega_sidebar_width",
      "min": 15,
      "max": 35,
      "step": 1,
      "default": 22,
      "unit": "%",
      "label": "Mega menu sidebar width"
    },
    {
      "type": "color",
      "id": "mega_sidebar_bg",
      "label": "Mega menu sidebar background",
      "default": "#f9fafb"
    },
    {
      "type": "range",
      "id": "promo_max_width",
      "min": 220,
      "max": 380,
      "step": 10,
      "default": 280,
      "unit": "px",
      "label": "Right promo column width"
    },
    {
      "type": "range",
      "id": "promo_image_height",
      "min": 140,
      "max": 280,
      "step": 10,
      "default": 200,
      "unit": "px",
      "label": "Right promo image height"
    },
    {
      "type": "text",
      "id": "help_label",
      "label": "Help Center label",
      "default": "Help Center"
    },
    {
      "type": "text",
      "id": "help_sub_label",
      "label": "Help Center sublabel (mobile)",
      "default": "Support, FAQs & contact"
    },
    {
      "type": "url",
      "id": "help_link",
      "label": "Help Center link"
    },
    {
      "type": "textarea",
      "id": "help_icon_svg",
      "label": "Custom Help icon SVG (desktop & mobile)",
      "info": "Optional. Paste raw <svg>‚Ä¶</svg>. If empty, default icon is used."
    },
    {
      "type": "text",
      "id": "industries_label",
      "label": "Industries label",
      "default": "Industries"
    },
    {
      "type": "textarea",
      "id": "industries_icon_svg",
      "label": "Custom Industries icon SVG (desktop & mobile)",
      "info": "Optional. Paste raw <svg>‚Ä¶</svg>. If empty, default icon is used."
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "default": "Welcome",
          "label": "Text"
        }
      ]
    },
    {
      "type": "badge",
      "name": "Menu badge",
      "settings": [
        {
          "type": "text",
          "id": "link_title",
          "label": "Link title to match",
          "info": "Exact title of any menu / submenu item"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Badge text",
          "default": "New"
        },
        {
          "type": "color",
          "id": "bg_color",
          "label": "Background color",
          "default": "#e11d48"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text color",
          "default": "#ffffff"
        }
      ]
    },
    {
      "type": "mega_trigger",
      "name": "Mega menu trigger",
      "settings": [
        {
          "type": "text",
          "id": "menu_item",
          "label": "Menu item title",
          "info": "Top-level link that should open a mega menu"
        }
      ]
    },
    {
      "type": "promo_block",
      "name": "Right Promo Banner",
      "settings": [
        {
          "type": "text",
          "id": "menu_handle",
          "label": "Parent menu handle",
          "info": "Handle of top menu (e.g. 'head-protection')"
        },
        {
          "type": "checkbox",
          "id": "apply_global",
          "label": "Show in all mega menus (global)",
          "default": false
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link URL"
        },
        {
          "type": "text",
          "id": "coupon",
          "label": "Coupon code"
        },
        {
          "type": "text",
          "id": "countdown_date",
          "label": "Countdown date (YYYY-MM-DD)",
          "info": "Optional"
        }
      ]
    },
    {
      "type": "mega_promo_card",
      "name": "Inline promo card",
      "settings": [
        {
          "type": "select",
          "id": "scope",
          "label": "Where to show",
          "default": "panel",
          "options": [
            { "value": "panel",  "label": "Specific subcategory panel" },
            { "value": "menu",   "label": "All panels of a menu" },
            { "value": "global", "label": "All mega menus (global)" }
          ]
        },
        {
          "type": "text",
          "id": "parent_menu_handle",
          "label": "Menu handle (for 'menu' scope)",
          "info": "Top menu handle, e.g. 'head-protection'"
        },
        {
          "type": "text",
          "id": "panel_handle",
          "label": "Panel handle (for 'panel' scope)",
          "info": "Child handle, e.g. 'head-protection-helmets'"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Product image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Promo product"
        },
        {
          "type": "text",
          "id": "meta",
          "label": "Meta / price line",
          "default": "From $9.99"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link URL"
        }
      ]
    },
    {
      "type": "mega_promo_banner",
      "name": "Inline promo banner",
      "settings": [
        {
          "type": "select",
          "id": "scope",
          "label": "Where to show",
          "default": "panel",
          "options": [
            { "value": "panel",  "label": "Specific subcategory panel" },
            { "value": "menu",   "label": "All panels of a menu" },
            { "value": "global", "label": "All mega menus (global)" }
          ]
        },
        {
          "type": "text",
          "id": "parent_menu_handle",
          "label": "Menu handle (for 'menu' scope)"
        },
        {
          "type": "text",
          "id": "panel_handle",
          "label": "Panel handle (for 'panel' scope)"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Banner image"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Overlay text"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link URL"
        }
      ]
    },
    {
      "type": "partner_link",
      "name": "Partner / rewards link",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Partners"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link URL"
        }
      ]
    },
    {
      "type": "drawer_footer_link",
      "name": "Drawer footer link",
      "settings": [
        {
          "type": "checkbox",
          "id": "enabled",
          "label": "Show this link",
          "default": true
        },
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Contact"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link URL"
        },
        {
          "type": "text",
          "id": "icon",
          "label": "Icon (emoji or short text)",
          "default": "üîó"
        }
      ]
    },
    {
      "type": "help_menu_item",
      "name": "Help Center item",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Title",
          "default": "General inquiries"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "description",
          "label": "Subtext",
          "default": "Questions, quotes or support"
        },
        {
          "type": "textarea",
          "id": "icon_svg",
          "label": "Icon SVG",
          "info": "Paste an <svg>‚Ä¶</svg> element. Leave blank to hide icon."
        },
        {
          "type": "checkbox",
          "id": "show_badge",
          "label": "Show badge",
          "default": false
        },
        {
          "type": "text",
          "id": "badge_text",
          "label": "Badge text",
          "default": "New"
        }
      ]
    },
    {
      "type": "industry_menu_item",
      "name": "Industries menu item",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Title",
          "default": "Construction"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "description",
          "label": "Subtext",
          "default": "PPE solutions for construction"
        },
        {
          "type": "textarea",
          "id": "icon_svg",
          "label": "Icon SVG",
          "info": "Paste an <svg>‚Ä¶</svg> element. Leave blank to hide icon."
        },
        {
          "type": "checkbox",
          "id": "show_badge",
          "label": "Show badge",
          "default": false
        },
        {
          "type": "text",
          "id": "badge_text",
          "label": "Badge text",
          "default": "New"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Header with drawer",
      "blocks": [
        {
          "type": "drawer_footer_link",
          "settings": {
            "enabled": true,
            "label": "Contact",
            "url": "/pages/contact",
            "icon": "‚úâÔ∏è"
          }
        },
        {
          "type": "drawer_footer_link",
          "settings": {
            "enabled": true,
            "label": "About",
            "url": "/pages/about-us",
            "icon": "‚ÑπÔ∏è"
          }
        },
        {
          "type": "drawer_footer_link",
          "settings": {
            "enabled": true,
            "label": "Resources",
            "url": "/pages/resources",
            "icon": "üìö"
          }
        }
      ]
    }
  ]
}
{% endschema %}
