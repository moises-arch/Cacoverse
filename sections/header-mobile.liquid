<!-- === HEADER MOBILE Â· PANEL TRACK + SEARCH (AJAX) Â· vNext === -->
<div class="mobile-header d-lg-none" id="mh">
  <!-- Top bar -->
  <div class="mh-bar">
    <button class="mh-btn mh-burger" id="mhBurger" aria-label="Open menu">
      <svg viewBox="0 0 24 24" width="26" height="26"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
    </button>

    <a href="{{ routes.root_url }}" class="mh-logo-wrap">



{{ settings.logo | image_url: width: 460 | image_tag: widths: '230,460,690', sizes: '(max-width: 600px) 180px, 230px', class: 'mh-logo', alt: shop.name, loading: 'eager' }}






    </a>







<a class="mh-btn mh-cart" href="{{ routes.cart_url }}" aria-label="Cart">
  <svg viewBox="0 0 24 24" width="22" height="22">
    <path d="M4 6h2l2.5 9h9L20 8H7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="10" cy="19" r="1.5"/>
    <circle cx="17" cy="19" r="1.5"/>
  </svg>
  {% if cart.item_count > 0 %}
    <span class="mh-cart-count">{{ cart.item_count }}</span>
  {% endif %}
</a>





  </div>

  <!-- Overlay -->
  <div class="mh-overlay" id="mhOverlay"></div>

  <!-- Drawer -->
  <nav class="mh-drawer" id="mhDrawer" aria-hidden="true" aria-label="Mobile menu" role="dialog">
    <div class="mh-head">
      <button class="mh-back" id="mhBack" aria-label="Back">â€¹</button>
      <span class="mh-title" id="mhTitle" aria-live="polite">Menu</span>
      <button class="mh-close" id="mhClose" aria-label="Close">Ã—</button>
    </div>

    <!-- PANELS + SEARCH LAYER -->
    <div class="mh-panels" id="mhPanels">
      <div class="mh-track" id="mhTrack">
        {%- assign menu_handle = section.settings.menu | default: 'main-menu' -%}

        <!-- ROOT -->
        <section class="mh-pane" id="pane-root" data-title="Menu" tabindex="-1" aria-label="Level 1">
          <ul class="mh-list">
            {%- for link in linklists[menu_handle].links -%}
              {%- assign l1_id = 'pane-l1-' | append: forloop.index0 -%}
              {%- assign l1_handle = link.title | handleize -%}
              <li class="mh-item" data-handle="{{ l1_handle }}">
                {%- if link.links.size > 0 -%}
                  <button class="mh-row mh-parent" type="button" data-target="{{ l1_id }}" aria-label="Open {{ link.title }}">
                    <div class="mh-left">
                      {%- assign icon_key = 'menu_icon_' | append: forloop.index0 -%}
                      {%- assign icon_img = section.settings[icon_key] -%}
                      {%- if icon_img != blank -%}
                        <img class="mh-ico" src="{{ icon_img | image_url: width: 48 }}" alt="" role="presentation" />
                      {%- endif -%}
                      <span class="mh-link">{{ link.title }}</span>
                    </div>
                    <span class="mh-caret">â€º</span>
                  </button>
                {%- else -%}
                  <a class="mh-row mh-row-link" href="{{ link.url }}">
                    <div class="mh-left">
                      {%- assign icon_key = 'menu_icon_' | append: forloop.index0 -%}
                      {%- assign icon_img = section.settings[icon_key] -%}
                      {%- if icon_img != blank -%}
                        <img class="mh-ico" src="{{ icon_img | image_url: width: 48 }}" alt="" role="presentation" />
                      {%- endif -%}
                      <span class="mh-link">{{ link.title }}</span>
                    </div>
                  </a>
                {%- endif -%}
              </li>
            {%- endfor -%}
          </ul>
        </section>

        <!-- LEVEL 2 -->
        {%- for link in linklists[menu_handle].links -%}
          {%- if link.links.size > 0 -%}
          {%- assign l1_id = 'pane-l1-' | append: forloop.index0 -%}
          <section class="mh-pane" id="{{ l1_id }}" data-title="{{ link.title }}" tabindex="-1" aria-label="Level 2">
            <ul class="mh-list">
              {%- for sub in link.links -%}
                {%- assign l2_id = 'pane-l2-' | append: forloop.parentloop.index0 | append: '-' | append: forloop.index0 -%}
                <li class="mh-item">
                  {%- if sub.links.size > 0 -%}
                    <button class="mh-row mh-parent" type="button" data-target="{{ l2_id }}" aria-label="Open {{ sub.title }}">
                      <div class="mh-left"><span class="mh-link">{{ sub.title }}</span></div>
                      <span class="mh-caret">â€º</span>
                    </button>
                  {%- else -%}
                    <a class="mh-row mh-row-link" href="{{ sub.url }}"><div class="mh-left"><span class="mh-link">{{ sub.title }}</span></div></a>
                  {%- endif -%}
                </li>
              {%- endfor -%}
            </ul>
          </section>

          <!-- LEVEL 3 -->
          {%- for sub in link.links -%}
            {%- if sub.links.size > 0 -%}
            {%- assign l2_id = 'pane-l2-' | append: forloop.parentloop.index0 | append: '-' | append: forloop.index0 -%}
            <section class="mh-pane" id="{{ l2_id }}" data-title="{{ sub.title }}" tabindex="-1" aria-label="Level 3">
              <ul class="mh-list">
                {%- for leaf in sub.links -%}
                  <li class="mh-item">
                    <a class="mh-row mh-row-link" href="{{ leaf.url }}"><div class="mh-left"><span class="mh-link">{{ leaf.title }}</span></div></a>
                  </li>
                {%- endfor -%}
              </ul>
            </section>
            {%- endif -%}
          {%- endfor -%}
          {%- endif -%}
        {%- endfor -%}
      </div>

      <!-- SEARCH LAYER: full frame entre header y bottom -->
      <div class="mh-search" id="mhSearch" aria-hidden="true">
        <div class="mh-search-results" id="mhSearchResults"></div>
      </div>
    </div>

    <!-- BOTTOM: SEARCH BAR + SOCIAL -->
    <div class="mh-bottom" style="padding-bottom: {{ section.settings.social_bottom_padding | default: 16 }}px;">
      <div class="mh-searchbar">
        <div class="mh-search-icon" aria-hidden="true">
          {% if section.settings.search_svg != blank %}
            {{ section.settings.search_svg }}
          {% else %}
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none"/><path d="M20 20l-4.2-4.2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          {% endif %}
        </div>
        <!-- type=text para evitar el cancel nativo (doble X) -->
        <input id="mhSearchInput" type="text" placeholder="Search productsâ€¦" autocomplete="off" />
        <button id="mhSearchClear" class="mh-search-clear" aria-label="Clear">Ã—</button>
      </div>

      <div class="mh-social">
        {% if section.settings.social_1_url and section.settings.social_1_svg %}
          <a href="{{ section.settings.social_1_url }}" target="_blank" rel="noopener" aria-label="Social 1" class="mh-social-btn">{{ section.settings.social_1_svg }}</a>
        {% endif %}
        {% if section.settings.social_2_url and section.settings.social_2_svg %}
          <a href="{{ section.settings.social_2_url }}" target="_blank" rel="noopener" aria-label="Social 2" class="mh-social-btn">{{ section.settings.social_2_svg }}</a>
        {% endif %}
        {% if section.settings.social_3_url and section.settings.social_3_svg %}
          <a href="{{ section.settings.social_3_url }}" target="_blank" rel="noopener" aria-label="Social 3" class="mh-social-btn">{{ section.settings.social_3_svg }}</a>
        {% endif %}
        {% if section.settings.social_4_url and section.settings.social_4_svg %}
          <a href="{{ section.settings.social_4_url }}" target="_blank" rel="noopener" aria-label="Social 4" class="mh-social-btn">{{ section.settings.social_4_svg }}</a>
        {% endif %}
      </div>
    </div>
  </nav>
</div>

<style>
:root{
  --mh-font: {{ section.settings.font_family | default: 'Barlow, sans-serif' }};
  --mh-size: {{ section.settings.font_size | default: '16px' }};
  --mh-weight: {{ section.settings.font_weight | default: '600' }};
  --mh-color: {{ section.settings.font_color | default: '#111' }};
  --mh-speed: .32s;
}

/* Top bar */
.mh-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.mh-btn{background:none;border:0;display:grid;place-items:center;color:#222}



/* ==== LOGO MOBILE FIX â€” nitidez + tamaÃ±o correcto ==== */
.mh-logo-wrap {
  display: flex;
  align-items: center;
  justify-content: center;
  max-width: 260px; /* ancho visual deseado */
}

.mh-logo {
  width: 100%;
  max-height: 35px; /* altura original */
  object-fit: contain;
}

/* Overlay */
.mh-overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:opacity var(--mh-speed) ease;z-index:9998}
.mh-overlay.is-on{opacity:1;pointer-events:auto}

/* Drawer */
.mh-drawer{position:fixed;top:0;bottom:0;left:0;width:82%;max-width:360px;background:#fff;box-shadow:2px 0 18px rgba(0,0,0,.18);transform:translateX(-100%);transition:transform var(--mh-speed) cubic-bezier(.4,0,.2,1);z-index:9999;display:flex;flex-direction:column}
.mh-drawer.is-open{transform:translateX(0)}
.mh-head{position:relative;height:56px;background:#f2f2f2;border-bottom:1px solid #e8e8e8}
.mh-title{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);margin:0;font-weight:700;font-size:18px}
.mh-back,.mh-close{position:absolute;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:50%;display:grid;place-items:center;color:#444;font-size:25px;background:none;border:0}
.mh-back{left:10px}.mh-close{right:10px}
.mh-back:hover,.mh-close:hover{background:#ececec}

















/* Panels / track */
.mh-panels{position:relative;flex:1 1 auto;overflow:hidden}
.mh-panels::-webkit-scrollbar{width:0;height:0} /* oculta vertical */




.mh-track{display:flex;flex-direction:row;min-height:100%;transition:transform var(--mh-speed) cubic-bezier(.4,0,.2,1);will-change:transform}






.mh-pane{flex:0 0 100%;min-width:100%;min-height:100%;background:#fff;display:flex;flex-direction:column}












.mh-list{list-style:none;margin:0;padding:0}
.mh-item{border-bottom:1px solid #f0f0f0}
.mh-row{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:0 6px;width:100%;background:#fff;border:0}
.mh-left{display:flex;align-items:center;gap:10px;min-width:0}
.mh-link,.mh-title-txt{font-family:var(--mh-font);font-size:var(--mh-size);font-weight:var(--mh-weight);color:var(--mh-color);text-decoration:none;display:block;padding:14px 18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}




.mh-row:hover,.mh-row-link:hover{background:#f9f9f9}
.mh-row,
.mh-row:hover,
.mh-row-link,
.mh-row-link:hover{
  border-radius:0 !important;
}



.mh-cart {
  position: relative;
   width: 28px;
  height: 28px;
}

.mh-cart-count {
  position: absolute;
  top: -1px;
  right: -3px;
  background: #1761a2; /* color primario de tu marca */
  color: #fff;
  font-size: 11px;
  font-weight: 700;
  border-radius: 999px;
  padding: 2px 5px;
  line-height: 1;
  min-width: 16px;
  text-align: center;
}


.mh-cart svg {
  width: 28px;
  height: 28px;
}





.mh-caret{flex:0 0 auto;width:32px;height:32px;border:1px solid rgba(0,0,0,.08);border-radius:999px;display:grid;place-items:center;margin-right:10px;color:#333}
.mh-ico{width:24px;height:24px;object-fit:contain;opacity:.9}
.mh-row-link{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:0 16px 0 6px;text-decoration:none;color:inherit}
.mh-backbar{display:none !important}














/* === SEARCH BOTTOM BAR === */
.mh-bottom{border-top:1px solid #eee;background:#f2f2f2}


.mh-searchbar{position:relative;display:flex;align-items:center;gap:8px;padding:10px 12px}
.mh-search-icon{position:absolute;left:22px;top:50%;transform:translateY(-50%);pointer-events:none}
.mh-search-icon svg{display:block}
.mh-searchbar input{appearance:none;border:none;outline:none;flex:1 1 auto;font-size:16px;padding:12px 42px 12px 44px;background:#fff;border:1px solid #ddd;width:100%;border-radius:0} /* full-frame look */
.mh-searchbar input::-webkit-search-cancel-button{display:none}
.mh-search-clear{background:none;border:0;font-size:22px;line-height:1;color:#666;width:28px;height:28px;display:grid;place-items:center;position:absolute;right:20px;top:50%;transform:translateY(-50%)}












/* Ocultar la X por defecto; mostrarla solo si hay texto */
.mh-search-clear{
  background:none;border:0;font-size:22px;line-height:1;color:#666;
  width:28px;height:28px;display:grid;place-items:center;
  position:absolute;right:20px;top:50%;transform:translateY(-50%);
  opacity:0; pointer-events:none; transition:opacity .15s ease;
}
.mh-searchbar.has-text .mh-search-clear{
  opacity:1; pointer-events:auto;
}



/* === SEARCH LAYER (FULL, SIN CORTES) === */
.mh-search{
  position:absolute;
  /* que cubra TODO entre el header y el fondo */
  top:0px;           /* altura del header gris */
  right:0;
  bottom:0;           /* llega hasta abajo */
  left:0;
  background:#fff;
  overflow:auto;
  display:none;
  z-index:3;
  /* para que el Ãºltimo resultado no quede oculto bajo el bottom */
  padding:0 0 var(--mh-bottom-height,112px) 0;
}
.mh-search.is-open{display:block}
.mh-search::-webkit-scrollbar{width:0;height:0}

/* sin huecos laterales/arriba, solo un poco de aire abajo del Ãºltimo Ã­tem */
.mh-search-results{padding:0 12px 8px 12px}

.mh-res{display:block;padding:12px 0;border-bottom:1px solid #f2f2f2;text-decoration:none;color:#111}
.mh-res-card{
  border:1px solid #e3e3e3;border-radius:8px;padding:10px;
  display:grid;grid-template-columns:76px 1fr;align-items:center;gap:12px;background:#fff;
}
.mh-res-img{width:76px;height:76px;object-fit:contain;display:block}
.mh-res-title{font-weight:700;text-decoration:none}
.mh-res-sku{font-size:12px;color:#666;margin-top:2px}

/* Social */
.mh-social{display:flex;gap:14px;justify-content:center;padding:10px 12px 0}





/* ==== Social icons â€” Flat Accent ==== */
:root{
  --social-accent: #104573;   /* color al hover/active (cÃ¡mbialo si quieres) */
  --social-bg: #f3f4f6;    /* fondo por defecto del botÃ³n */
  --social-ring: rgba(17,17,17,.15);
}

.mh-social{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:14px;
  padding:12px 16px 0;
}

/* BotÃ³n circular plano con sombra muy sutil */
.mh-social-btn{
  width:44px;
  height:44px;
  border-radius:999px;
  display:grid;
  place-items:center;
  background: var(--social-bg);
  border: 1px solid #e5e7eb;
  color:#222;                 /* el SVG hereda este color */
  box-shadow: 0 1px 2px rgba(0,0,0,.06);
  transition:
    transform .18s ease,
    background-color .18s ease,
    color .18s ease,
    box-shadow .18s ease,
    border-color .18s ease;
  text-decoration:none;
}

.mh-social-btn svg{
  width:20px;
  height:20px;
  display:block;
  fill: currentColor;
}

/* Hover: relleno de acento y texto blanco */
.mh-social-btn:hover{
  background: var(--social-accent);
  color:#fff;
  border-color: transparent;
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0,0,0,.18);
}

/* Active: menos elevaciÃ³n */
.mh-social-btn:active{
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(0,0,0,.14);
}

/* Focus accesible */
.mh-social-btn:focus-visible{
  outline:none;
  box-shadow:
    0 0 0 3px var(--social-ring),
    0 6px 14px rgba(0,0,0,.18);
}

/* Modo oscuro */
@media (prefers-color-scheme: dark){
  :root{
    --social-bg:#1f1f1f;
    --social-ring: rgba(255,255,255,.22);
  }
  .mh-social-btn{
    border-color:#333;
    color:#eaeaea;
    box-shadow: 0 1px 2px rgba(0,0,0,.4);
  }
  .mh-social-btn:hover{
    background: var(--social-accent);
    color:#fff;
    border-color: transparent;
    box-shadow: 0 8px 18px rgba(0,0,0,.5);
  }
}




 /* === iOS ULTRA FIX: bloquea scroll de fondo y mantiene scroll interno === */
body.drawer-lock {
  position: fixed;
  width: 100%;
  overflow: hidden;
  touch-action: none;
  overscroll-behavior: none;
}

/* Drawer 100% viewport */
.mh-drawer {
  position: fixed !important;
  top: 0;
  left: 0;
  width: 100vw !important;
  height: 100dvh !important;
  background: #fff !important;
  transform: translateX(-100%);
  transition: transform .32s cubic-bezier(.4,0,.2,1);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  z-index: 10001;
}
.mh-drawer.is-open {
  transform: translateX(0) !important;
}

/* Overlay negro */
.mh-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.35);
  opacity: 0;
  pointer-events: none;
  transition: opacity .3s ease;
  z-index: 10000;
}
.mh-overlay.is-on {
  opacity: 1;
  pointer-events: auto;
}

/* Fondo blanco debajo del overlay */
#ios-white-bg {
  position: fixed;
  inset: 0;
  background: #fff;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity .3s ease;
}
#ios-white-bg.is-visible {
  opacity: 1;
  pointer-events: auto;
}
/* === âœ… FINAL PATCH â€” Drawer FULL WIDTH (iOS + Android + Desktop) === */

.mh-drawer {
  position: fixed !important;
  top: 0;
  left: 0;
  right: 0;
  width: 100vw !important;
  max-width: 100vw !important;
  height: 100dvh !important;
  background: #fff !important;
  transform: translateX(-100%);
  transition: transform .32s cubic-bezier(.4,0,.2,1);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  box-shadow: none !important;
  z-index: 10001;
}

.mh-drawer.is-open {
  transform: translateX(0) !important;
}

/* Evita movimiento del contenido al abrir/cerrar */
body.drawer-lock {
  position: fixed;
  width: 100%;
  height: 100%;
  overflow: hidden;
  touch-action: none;
  overscroll-behavior: none;
}

/* Asegura fondo blanco visible debajo */
#ios-white-bg {
  position: fixed;
  inset: 0;
  background: #fff;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity .3s ease;
}
#ios-white-bg.is-visible {
  opacity: 1;
  pointer-events: auto;
}

/* Overlay encima del fondo blanco */
.mh-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.35);
  opacity: 0;
  pointer-events: none;
  transition: opacity .3s ease;
  z-index: 10000;
}
.mh-overlay.is-on {
  opacity: 1;
  pointer-events: auto;
}

/* === ðŸ§² STICKY HEADER â€” visible por defecto, se oculta al subir === */
.mobile-header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 10002;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  transition: top 0.35s ease;
  will-change: top;
}

.mobile-header.is-hidden {
  top: -80px; /* lo mueve fuera de pantalla */
}

body.has-sticky-header {
  padding-top: 56px; /* ajusta segÃºn la altura del header */
}












@media (prefers-reduced-motion: reduce){
  .mh-overlay,.mh-drawer,.mh-track{transition:none !important}
}
</style>










































<script>
/* === STICKY HEADER â€” visible por defecto, se oculta al bajar === */
document.addEventListener('DOMContentLoaded', () => {
  const header = document.querySelector('.mobile-header');
  let lastScroll = 0;
  let ticking = false;

  function updateHeader() {
    const currentScroll = window.scrollY;
    if (currentScroll > lastScroll && currentScroll > 80) {
      header.classList.add('is-hidden');
    } else if (currentScroll < lastScroll) {
      header.classList.remove('is-hidden');
      document.body.classList.add('has-sticky-header');
    }
    lastScroll = currentScroll <= 0 ? 0 : currentScroll;
    ticking = false;
  }

  window.addEventListener('scroll', () => {
    if (!ticking) {
      window.requestAnimationFrame(updateHeader);
      ticking = true;
    }
  });
});

/* === DRAWER OPEN/CLOSE === */
document.addEventListener('DOMContentLoaded', () => {
  const drawer = document.getElementById('mhDrawer');
  const overlay = document.getElementById('mhOverlay');
  const burger = document.getElementById('mhBurger');
  const closeBtn = document.getElementById('mhClose');
  const bg = document.getElementById('ios-white-bg');

  function lockBody(lock) {
    document.body.classList.toggle('drawer-lock', lock);
  }
  function toggleDrawer(open) {
    drawer.classList.toggle('is-open', open);
    overlay.classList.toggle('is-on', open);
    bg?.classList.toggle('is-visible', open);
    lockBody(open);
  }

  burger.addEventListener('click', () => toggleDrawer(true));
  closeBtn.addEventListener('click', () => toggleDrawer(false));
  overlay.addEventListener('click', () => toggleDrawer(false));
});

/* === FOCUS FIX === */
document.addEventListener('focusout', () => {
  const scrollY = document.body.style.top;
  document.body.style.position = '';
  document.body.style.top = '';
  window.scrollTo(0, parseInt(scrollY || '0') * -1);
});

/* === PANEL TRACK + SEARCH === */
document.addEventListener('DOMContentLoaded', () => {
  const drawer  = document.getElementById('mhDrawer');
  const overlay = document.getElementById('mhOverlay');
  const openBtn = document.getElementById('mhBurger');
  const closeBtn= document.getElementById('mhClose');
  const backTop = document.getElementById('mhBack');
  const titleEl = document.getElementById('mhTitle');
  const panels  = document.getElementById('mhPanels');
  const track   = document.getElementById('mhTrack');

  const panes = Array.from(track.querySelectorAll('.mh-pane'));
  const paneIndex = new Map(); panes.forEach((p,i)=>paneIndex.set(p.id,i));
  const idxOf = id => paneIndex.get(id) ?? 0;

  const rootId = 'pane-root';
  const stack = [rootId];
  const scrollMap = new Map();
  let firstFocusEl = null, lastFocusEl = null;

  const currentId = () => stack[stack.length-1];
  const setTitle  = (t)=>{ titleEl.textContent = t ?? (document.getElementById(currentId())?.dataset?.title || 'Menu'); };
  const setTransform = ()=>{ track.style.transform = `translateX(-${idxOf(currentId())*100}%)`; };
  const saveScroll   = ()=>{ scrollMap.set(currentId(), panels.scrollTop); };
  const restoreScroll= ()=>{ panels.scrollTop = scrollMap.get(currentId()) || 0; };
  const focusFirstInPane=()=>{
    const pane=document.getElementById(currentId());
    const f=pane.querySelectorAll('a,button,[tabindex]:not([tabindex="-1"])');
    if(f.length){ firstFocusEl=f[0]; lastFocusEl=f[f.length-1]; firstFocusEl.focus(); }
  };

  function openDrawer(){
    drawer.classList.add('is-open'); overlay.classList.add('is-on');
    drawer.setAttribute('aria-hidden','false');
    setTitle(); setTransform(); restoreScroll(); focusFirstInPane();
    document.getElementById('pane-root')?.classList.add('is-active');
    document.body.style.overflow='hidden';
  }
  function closeDrawer(){
    hideSearch();
    drawer.classList.remove('is-open'); overlay.classList.remove('is-on');
    drawer.setAttribute('aria-hidden','true');
    stack.length=1; setTitle(); setTransform();
    document.body.style.overflow='';
  }

  openBtn.addEventListener('click', openDrawer);
  overlay.addEventListener('click', closeDrawer);
  closeBtn.addEventListener('click', closeDrawer);

  /* === CONTROL DE TRANSICIÃ“N ENTRE PANELES â€” versiÃ³n fluida === */
  let isTransitioning = false;

  track.addEventListener('click', (e) => {
    const parent = e.target.closest('.mh-parent');
    if (parent && !isTransitioning) {
      const targetId = parent.dataset.target;
      if (!targetId || !document.getElementById(targetId)) return;
      e.preventDefault();
      isTransitioning = true;
      saveScroll();
      stack.push(targetId);
      setTitle();
      setTransform();

      panes.forEach(p => p.classList.remove('is-active'));
      document.getElementById(currentId())?.classList.add('is-active');

      setTimeout(() => {
        restoreScroll();
        focusFirstInPane();
        isTransitioning = false;
      }, 420);
    }
  });

  /* === BACK BUTTON === */
  backTop.addEventListener('click', () => {
    if (searchOpen) { hideSearch(); return; }
    if (isTransitioning) return;
    if (stack.length > 1) {
      isTransitioning = true;
      saveScroll();
      stack.pop();
      setTitle();
      setTransform();

      panes.forEach(p => p.classList.remove('is-active'));
      document.getElementById(currentId())?.classList.add('is-active');

      setTimeout(() => {
        restoreScroll();
        focusFirstInPane();
        isTransitioning = false;
      }, 420);
    } else {
      closeDrawer();
    }
  });

  /* === FOCUS TRAP + ESCAPE === */
  drawer.addEventListener('keydown', (e)=>{
    if (e.key==='Tab'){
      if (e.shiftKey && document.activeElement===firstFocusEl){ e.preventDefault(); lastFocusEl?.focus(); }
      else if (!e.shiftKey && document.activeElement===lastFocusEl){ e.preventDefault(); firstFocusEl?.focus(); }
    }
    if (e.key==='Escape'){ searchOpen ? hideSearch() : closeDrawer(); }
  });

  /* === SEARCH === */
  const searchLayer   = document.getElementById('mhSearch');
  const resultsWrap   = document.getElementById('mhSearchResults');
  const input         = document.getElementById('mhSearchInput');
  const btnClear      = document.getElementById('mhSearchClear');
  const searchBar     = document.querySelector('.mh-searchbar');

  function updateClearVisibility(){
    if (input.value.trim().length > 0) searchBar.classList.add('has-text');
    else searchBar.classList.remove('has-text');
  }

  let searchOpen = false;
  const bottom = document.querySelector('.mh-bottom');
  const setBottomHeight = ()=>{ document.documentElement.style.setProperty('--mh-bottom-height', `${bottom.getBoundingClientRect().height}px`); };
  setBottomHeight(); window.addEventListener('resize', setBottomHeight);

  function showSearch(){
    if(searchOpen) return;
    searchOpen = true;
    searchLayer.classList.add('is-open');
    setTitle('Search');
    input.focus();
    updateClearVisibility();
  }
  function hideSearch(){
    if(!searchOpen) return;
    searchOpen = false;
    searchLayer.classList.remove('is-open');
    setTitle();
    input.value=''; resultsWrap.innerHTML='';
    updateClearVisibility();
  }

  input.addEventListener('input', debounce(async ()=>{
    const q = input.value.trim();
    updateClearVisibility();
    if(q.length === 0){ hideSearch(); return; }
    if(q.length < 2){ resultsWrap.innerHTML=''; return; }
    showSearch();

    const url = `/search/suggest.json?q=${encodeURIComponent(q)}&resources[type]=product&resources[limit]=10`;
    try{
      const res = await fetch(url,{headers:{'Accept':'application/json'}});
      const data = await res.json();
      const products = (data.resources?.results?.products)||[];
      const enriched = await Promise.all(products.map(async p=>{
        let sku=''; 
        try{
          const pj = await fetch(`/products/${p.handle}.js`).then(r=>r.json());
          sku = pj.variants?.[0]?.sku || '';
        }catch(e){}
        const img = p.image ? p.image.replace(/(\.jpg|\.png|\.jpeg)(\?.*)?$/i,'$1') : '';
        return {title:p.title,url:p.url,image:img,sku};
      }));
      renderResults(enriched);
    }catch(e){
      resultsWrap.innerHTML = `<div style="padding:14px;color:#777">No results</div>`;
    }
  },220));

  btnClear.addEventListener('click', ()=>{ hideSearch(); });

  function renderResults(items){
    if(!items.length){ resultsWrap.innerHTML = `<div style="padding:14px;color:#777">No results</div>`; return; }
    resultsWrap.innerHTML = items.map(item=>{
      const imgUrl = item.image ? `${item.image}${item.image.includes('?')?'&':'?'}width=152` : '';
      return `
        <a class="mh-res" href="${item.url}">
          <div class="mh-res-card">
            <img class="mh-res-img" src="${imgUrl}" alt="" loading="lazy">
            <div>
              <div class="mh-res-title">${escapeHtml(item.title)}</div>
              ${item.sku ? `<div class="mh-res-sku">SKU: ${escapeHtml(item.sku)}</div>` : ``}
            </div>
          </div>
        </a>`;
    }).join('');
  }

  function debounce(fn,ms){ let t; return(...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; }
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
});
</script>







































{% schema %}
{
  "name": "Header Mobile",
  "settings": [
    { "type": "link_list", "id": "menu", "label": "Menu", "default": "main-menu" },

    { "type": "text", "id": "font_family", "label": "Font family", "default": "Barlow, sans-serif" },
    { "type": "range", "id": "font_size", "label": "Font size", "min": 12, "max": 22, "step": 1, "unit": "px", "default": 16 },
    { "type": "select", "id": "font_weight", "label": "Font weight", "options": [
      { "value": "400", "label": "Regular" },
      { "value": "500", "label": "Medium" },
      { "value": "600", "label": "Semi Bold" },
      { "value": "700", "label": "Bold" }
    ], "default": "600" },
    { "type": "color", "id": "font_color", "label": "Text color", "default": "#111111" },

    { "type": "image_picker", "id": "menu_icon_0", "label": "Icon 1 (L1)" },
    { "type": "image_picker", "id": "menu_icon_1", "label": "Icon 2 (L1)" },
    { "type": "image_picker", "id": "menu_icon_2", "label": "Icon 3 (L1)" },
    { "type": "image_picker", "id": "menu_icon_3", "label": "Icon 4 (L1)" },
    { "type": "image_picker", "id": "menu_icon_4", "label": "Icon 5 (L1)" },
    { "type": "image_picker", "id": "menu_icon_5", "label": "Icon 6 (L1)" },
    { "type": "image_picker", "id": "menu_icon_6", "label": "Icon 7 (L1)" },
    { "type": "image_picker", "id": "menu_icon_7", "label": "Icon 8 (L1)" },
    { "type": "image_picker", "id": "menu_icon_8", "label": "Icon 9 (L1)" },
    { "type": "image_picker", "id": "menu_icon_9", "label": "Icon 10 (L1)" },

    { "type": "textarea", "id": "search_svg", "label": "Search icon SVG (raw)", "info": "Pega SVG inline (sin <script>)." },

    { "type": "url", "id": "social_1_url", "label": "Social 1 URL" },
    { "type": "textarea", "id": "social_1_svg", "label": "Social 1 SVG" },

    { "type": "url", "id": "social_2_url", "label": "Social 2 URL" },
    { "type": "textarea", "id": "social_2_svg", "label": "Social 2 SVG" },

    { "type": "url", "id": "social_3_url", "label": "Social 3 URL" },
    { "type": "textarea", "id": "social_3_svg", "label": "Social 3 SVG" },

    { "type": "url", "id": "social_4_url", "label": "Social 4 URL" },
    { "type": "textarea", "id": "social_4_svg", "label": "Social 4 SVG" },

    { "type": "range", "id": "social_bottom_padding", "label": "Bottom padding (social)", "min": 0, "max": 48, "step": 2, "unit": "px", "default": 16 }
  ],
  "presets": [{ "name": "Header Mobile (Panel Track + Search)" }]
}
{% endschema %}
