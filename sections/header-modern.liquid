{% comment %}
  SECTION: header-modern.liquid
  - Mobile: burger (left) + centered logo + search & cart (right)
  - Desktop: mantiene tu mega-menu tal cual (se injecta dentro)
  - Sin dependencias de Bootstrap para el drawer móvil (JS mínimo propio)
{% endcomment %}

{% assign S = section.id %}

<header class="hdrx-{{ S }} hdrx header--sticky">
  <!-- Top bar -->
  <div class="hdrx-bar">
    <!-- Left: Burger -->
    <button class="hdrx-burger" aria-label="Open menu" data-hdrx="burger" aria-expanded="false" aria-controls="hdrx-drawer-{{ S }}">
      <!-- modern hamburger icon -->
      <svg viewBox="0 0 24 24" width="26" height="26" aria-hidden="true"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
    </button>

    <!-- Center: Brand -->
    <a href="{{ routes.root_url }}" class="hdrx-brand" aria-label="{{ shop.name }}">
      {% if settings.logo != blank %}
        {% assign logo_alt = settings.logo.alt | default: shop.name | escape %}
        {% assign logo_height = settings.logo_width | divided_by: settings.logo.aspect_ratio %}
        {% capture sizes %}(max-width: {{ settings.logo_width | times: 2 }}px) 50vw, {{ settings.logo_width }}px{% endcapture %}
        {% capture widths %}{{ settings.logo_width }}, {{ settings.logo_width | times: 1.5 | round }}, {{ settings.logo_width | times: 2 }}{% endcapture %}
        {{
          settings.logo
          | image_url: width: 600
          | image_tag:
            class: 'hdrx-logo',
            widths: widths,
            height: logo_height,
            width: settings.logo_width,
            alt: logo_alt,
            sizes: sizes,
            preload: true
        }}
      {% else %}
        <span class="hdrx-logo-text">{{ shop.name }}</span>
      {% endif %}
    </a>

    <!-- Right: Search + Cart -->
    <div class="hdrx-actions">
      <button class="hdrx-icon" aria-label="Search" data-hdrx="search">
        <!-- modern search icon -->
        <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
          <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none"></circle>
          <path d="M20 20L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
        </svg>
      </button>
      <a href="{{ routes.cart_url }}" class="hdrx-icon" aria-label="{{ 'templates.cart.cart' | t }}">
        <!-- modern bag icon -->
        <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
          <path d="M6 8h12l-1 12H7L6 8Z" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"></path>
          <path d="M9 8a3 3 0 1 1 6 0" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"></path>
        </svg>
        {% if cart != empty %}
          <span class="hdrx-bubble" aria-hidden="true">{{ cart.item_count }}</span>
        {% endif %}
      </a>
    </div>
  </div>

  <!-- Desktop nav (tu menú actual intacto) -->
  <nav class="hdrx-nav">
    <ul class="main-menu-bar navbar-nav mx-auto">
      {% for link in linklists['main-menu'].links %}
        {% assign parent_link_title = link.title | handleize | downcase %}

        {% if parent_link_title == 'products' %}
          <li class="nav-item dropdown position-static">
            <a class="nav-link" href="javascript:void(0);" role="button">
              {{ link.title }}
              {{ 'icon-caret.svg' | inline_asset_content }}
            </a>
            <div class="dropdown-menu mega-menu products-dropdown-menu">
              <div class="container-fluid page-width">
                <div class="row">
                  <div class="col-12 col-md-3 border-right">
                    <div class="dropdown-menu-item">
                      <ul class="list-unstyled mb-3 mb-md-3">
                        {% for link_all in linklists['all-categories'].links %}
                          {% if forloop.index == 1 %}
                            <li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                          {% else %}
                            <li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                      <ul class="list-unstyled mb-3">
                        {% for link_all in linklists['program'].links %}
                          {% if forloop.index == 1 %}
                            <li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                          {% else %}
                            <li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                  <div class="col-12 col-md-3 border-right">
                    <div class="dropdown-menu-item">
                      <ul class="list-unstyled mb-3 mb-md-3">
                        {% for link_all in linklists['hand-protection'].links %}
                          {% if forloop.index == 1 %}
                            <li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                          {% else %}
                            <li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                      <ul class="list-unstyled mb-3">
                        {% for link_all in linklists['protective-clothing'].links %}
                          {% if forloop.index == 1 %}
                            <li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                          {% else %}
                            <li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                  <div class="col-12 col-md-3 border-right">
                    <div class="dropdown-menu-item">
                      <ul class="list-unstyled mb-3 mb-md-3">
                        {% for link_all in linklists['hearing-protection'].links %}
                          {% if forloop.index == 1 %}
                            <li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                          {% else %}
                            <li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                      <ul class="list-unstyled mb-3 mb-md-3">
                        {% for link_all in linklists['head-protection'].links %}
                          {% if forloop.index == 1 %}
                            <li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                          {% else %}
                            <li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                      <ul class="list-unstyled">
                        {% for link_all in linklists['ergonomics'].links %}
                          {% if forloop.index == 1 %}
                            <li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                          {% else %}
                            <li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                  <div class="col-12 col-md-3 border-right">
                    <div class="dropdown-menu-item">
                      <ul class="list-unstyled mb-3 mb-md-3">
                        {% for link_all in linklists['eye-protection'].links %}
                          {% if forloop.index == 1 %}
                            <li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                          {% else %}
                            <li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                      <ul class="list-unstyled mb-3">
                        {% for link_all in linklists['microfiber-towels'].links %}
                          {% if forloop.index == 1 %}
                            <li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                          {% else %}
                            <li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                      <ul class="list-unstyled mb-3">
                        {% for link_all in linklists['sale'].links %}
                          {% if forloop.index == 1 %}
                            <li class="menu-slug-{{ link_all.title | handleize }}"><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                          {% else %}
                            <li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </li>

        {% elsif parent_link_title == 'brands' %}
          <li class="nav-item dropdown position-static">
            <a class="nav-link" href="{{ link.url }}" role="button">
              {{ link.title }}
              {{ 'icon-caret.svg' | inline_asset_content }}
            </a>
            {% if link.links.size > 0 %}
            <div class="dropdown-menu mega-menu brands-dropdown-menu">
              <div class="container-fluid page-width">
                <div class="row">
                  <div class="col-12 col-md-4 border-right">
                    <div class="dropdown-menu-item" onclick="location.href = '/pages/ppe-categories';" style="cursor:pointer;">
                      <div class="imager text-center mb-3">
                        <img src="{{ 'menu-brand-1.png' | asset_img_url: 'master' }}" class="img-fluid" width="auto" height="125" loading="lazy">
                      </div>
                      <h3 class="text-center mt-3 mt-md-4 mb-2">GE PPE</h3>
                      <p class="sp-16 text-center">GE is one of the most valuable and respected brands...</p>
                    </div>
                  </div>
                  <div class="col-12 col-md-4 border-right">
                    <div class="dropdown-menu-item" onclick="location.href = '/collections/best-value';" style="cursor:pointer;">
                      <div class="imager text-center mb-3">
                        <img src="https://cdn.shopify.com/s/files/1/0660/8800/9781/files/menu-brand-4.png" class="img-fluid" width="auto" height="125" loading="lazy">
                      </div>
                      <h3 class="text-center mt-3 mt-md-4 mb-2">Best Value</h3>
                      <p class="sp-16 text-center">Best Value is a fast-growing brand...</p>
                    </div>
                  </div>
                  <div class="col-12 col-md-4">
                    <div class="dropdown-menu-item" onclick="location.href = '/collections/wd-40';" style="cursor:pointer;">
                      <div class="imager text-center mb-3">
                        <img src="{{ 'menu-brand-3.png' | asset_img_url: 'master' }}" class="img-fluid" width="auto" height="125" loading="lazy">
                      </div>
                      <h3 class="text-center mt-3 mt-md-4 mb-2">WD-40 Microfiber Towels</h3>
                      <p class="sp-16 text-center">WD-40 Brand products help keep tractors...</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endif %}
          </li>

        {% elsif parent_link_title == 'industries' %}
          <li class="nav-item dropdown position-static">
            <a class="nav-link" href="{{ link.url }}" role="button">
              {{ link.title }}
              {{ 'icon-caret.svg' | inline_asset_content }}
            </a>
            {% if link.links.size > 0 %}
            <div class="dropdown-menu mega-menu industries-dropdown-menu">
              <div class="container-fluid page-width">
                <div class="row">
                  {% assign link_count = link.links.size %}
                  {% for sublink in link.links %}
                    {% assign index0 = forloop.index0 %}
                    {% assign mod = index0 | modulo: 3 %}
                    {% if mod == 0 %}<div class="col-12 col-md-4 border-right">{% endif %}
                      {% assign my_collection = sublink.object %}
                      <div class="d-flex align-items-center gap-2 mb-3">
                        <img src="{{ my_collection.metafields.custom.page_featured_image | img_url: '80x' }}" class="img-fluid" width="80" height="80" loading="lazy">
                        <a href="{{ sublink.url }}" class="dropdown-item">{{ sublink.title }}</a>
                      </div>
                    {% assign next_index = index0 | plus: 1 %}
                    {% assign close_mod = next_index | modulo: 3 %}
                    {% if close_mod == 0 or forloop.last %}</div>{% endif %}
                  {% endfor %}
                </div>
              </div>
            </div>
            {% endif %}
          </li>

        {% elsif parent_link_title == 'resources' %}
          <li class="nav-item dropdown position-static">
            <a class="nav-link" href="javascript:void(0);" role="button">
              {{ link.title }}
              {{ 'icon-caret.svg' | inline_asset_content }}
            </a>
            {% if link.links.size > 0 %}
            <div class="dropdown-menu mega-menu resources-dropdown-menu">
              <div class="container-fluid page-width">
                <div class="row">
                  <div class="col-12 d-flex align-items-start flex-wrap flex-lg-nowrap">
                    {% for sublink in link.links %}
                      <div class="dropdown-menu-item border-right">
                        <h3><a href="{{ sublink.url }}">{{ sublink.title }}</a></h3>
                        {% if sublink.links.size > 0 %}
                          <ul class="list-unstyled">
                            {% for subsublink in sublink.links %}
                              <li><a href="{{ subsublink.url }}">{{ subsublink.title }}</a></li>
                            {% endfor %}
                          </ul>
                        {% endif %}
                      </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
            {% endif %}
          </li>

        {% elsif parent_link_title == 'contact' %}
          <li class="nav-item dropdown position-static">
            <a class="nav-link" href="{{ link.url }}" role="button">
              {{ link.title }}
              {{ 'icon-caret.svg' | inline_asset_content }}
            </a>
            {% if link.links.size > 0 %}
            <div class="dropdown-menu mega-menu contact-dropdown-menu">
              <div class="container-fluid page-width">
                <div class="row">
                  {% for sublink in link.links %}
                    <div class="col-12 col-md-6 border-right">
                      {% assign my_collection = sublink.object %}
                      <div class="d-flex align-items-center gap-2 mb-3 justify-content-center">
                        <img src="{{ my_collection.metafields.custom.page_featured_image | img_url: '80x' }}" class="img-fluid" width="80" height="80" loading="lazy">
                        <a href="{{ sublink.url }}" class="dropdown-item">{{ sublink.title }}</a>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
            {% endif %}
          </li>

        {% elsif parent_link_title == 'about-us' %}
          <li class="nav-item"><a class="nav-link" href="{{ link.url }}">{{ link.title }}</a></li>
        {% endif %}
      {% endfor %}
    </ul>
  </nav>

  <!-- Mobile drawer -->
  <div id="hdrx-drawer-{{ S }}" class="hdrx-drawer" aria-hidden="true">
    <div class="hdrx-drawer-inner">
      <div class="hdrx-drawer-head">
        <span>{{ 'sections.header.menu' | t | default: 'Menu' }}</span>
        <button class="hdrx-close" aria-label="Close menu" data-hdrx="close">
          <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
      </div>
      <!-- Reutilizamos el mismo UL (estructura) para móvil: lo mostramos en columna -->
      <div class="hdrx-mobile-menu">
        {{ content_for_header | default: '' }}
        <ul class="hdrx-mobile-list">
          {% for link in linklists['main-menu'].links %}
            {% assign parent_link_title = link.title | handleize | downcase %}
            <li class="hdrx-item">
              <button class="hdrx-accordion" data-hdrx="acc">
                <span>{{ link.title }}</span>
                <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
              <div class="hdrx-panel">
                {% if parent_link_title == 'products' %}
                  <ul>
                    {% for link_all in linklists['all-categories'].links %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endfor %}
                    {% for link_all in linklists['program'].links %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endfor %}
                    {% for link_all in linklists['hand-protection'].links %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endfor %}
                    {% for link_all in linklists['protective-clothing'].links %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endfor %}
                    {% for link_all in linklists['hearing-protection'].links %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endfor %}
                    {% for link_all in linklists['head-protection'].links %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endfor %}
                    {% for link_all in linklists['ergonomics'].links %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endfor %}
                    {% for link_all in linklists['eye-protection'].links %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endfor %}
                    {% for link_all in linklists['microfiber-towels'].links %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endfor %}
                    {% for link_all in linklists['sale'].links %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endfor %}
                  </ul>
                {% elsif parent_link_title == 'brands' or parent_link_title == 'industries' or parent_link_title == 'resources' or parent_link_title == 'contact' %}
                  {% if link.links.size > 0 %}
                    <ul>
                      {% for sublink in link.links %}
                        <li><a href="{{ sublink.url }}">{{ sublink.title }}</a></li>
                      {% endfor %}
                    </ul>
                  {% else %}
                    <ul><li><a href="{{ link.url }}">{{ link.title }}</a></li></ul>
                  {% endif %}
                {% else %}
                  <ul><li><a href="{{ link.url }}">{{ link.title }}</a></li></ul>
                {% endif %}
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</header>

{% style %}
.hdrx-{{ S }}{--hdrx-bg:rgba(16,20,24,.55);--hdrx-fg:#fff;--hdrx-shadow:0 10px 30px rgba(0,0,0,.08)}
.hdrx{position:relative;z-index:1000}
.hdrx-bar{
  position:sticky; top:0; left:0; right:0; z-index:1001;
  display:grid; grid-template-columns:56px 1fr 100px; align-items:center; height:56px;
  background:var(--hdrx-bg); -webkit-backdrop-filter:blur(10px) saturate(140%); backdrop-filter:blur(10px) saturate(140%);
  border-bottom:1px solid rgba(255,255,255,.1); padding:0 10px;
}
.hdrx-burger,.hdrx-icon{background:transparent;border:0;color:var(--hdrx-fg);width:36px;height:36px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer}
.hdrx-brand{justify-self:center; pointer-events:auto; text-decoration:none}
.hdrx-logo{max-height:26px}
.hdrx-logo-text{color:var(--hdrx-fg);font-weight:700}
.hdrx-actions{justify-self:end;display:inline-flex;align-items:center;gap:14px}
.hdrx-bubble{position:absolute; transform:translate(10px,-10px); background:#ff3b30; color:#fff; font-size:11px; line-height:16px; min-width:16px; height:16px; border-radius:999px; padding:0 4px; text-align:center}

/* Desktop nav wraps your exact mega-menu */
.hdrx-nav{display:none}
@media(min-width:992px){ .hdrx-bar{grid-template-columns:220px 1fr 220px}
  .hdrx-nav{display:block; background:#fff}
}

/* Drawer mobile */
.hdrx-drawer{position:fixed; inset:0 0 0 0; z-index:1000; opacity:0; pointer-events:none; transition:opacity .25s ease}
.hdrx-drawer.is-open{opacity:1; pointer-events:auto}
.hdrx-drawer-inner{position:absolute; top:0; left:0; bottom:0; width:min(92vw,420px); background:#fff; box-shadow:var(--hdrx-shadow); transform:translateX(-100%); transition:transform .28s ease}
.hdrx-drawer.is-open .hdrx-drawer-inner{transform:translateX(0)}
.hdrx-drawer-head{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid #ebeff5; position:sticky; top:0; background:#fff; z-index:2}
.hdrx-close{background:transparent; border:0; width:36px; height:36px; color:#111; cursor:pointer}

/* Mobile list */
.hdrx-mobile-menu{padding:6px 10px 20px}
.hdrx-mobile-list{list-style:none; margin:0; padding:0}
.hdrx-item + .hdrx-item{border-top:1px solid #ebeff5}
.hdrx-accordion{width:100%; background:#fff; border:0; display:flex; align-items:center; justify-content:space-between; padding:14px 8px; font-weight:600; cursor:pointer}
.hdrx-panel{max-height:0; overflow:hidden; transition:max-height .25s ease}
.hdrx-panel ul{list-style:none; padding:0 0 8px 0; margin:0}
.hdrx-panel li a{display:block; padding:10px 8px; color:#111; text-decoration:none}
.hdrx-panel li a:hover{color:#0a5ba6}

/* Accessibility focus */
.hdrx-burger:focus,.hdrx-icon:focus,.hdrx-close:focus,.hdrx-accordion:focus{outline:2px solid rgba(23,97,162,.35); outline-offset:2px}
{% endstyle %}

<script>
(function(){
  const root = document.querySelector('.hdrx-{{ S }}');
  if(!root) return;
  const drawer = root.querySelector('#hdrx-drawer-{{ S }}');
  const burger = root.querySelector('[data-hdrx="burger"]');
  const searchBtn = root.querySelector('[data-hdrx="search"]');
  const closeBtn = root.querySelector('[data-hdrx="close"]');
  const accBtns = root.querySelectorAll('[data-hdrx="acc"]');

  function openDrawer(){ drawer.classList.add('is-open'); burger.setAttribute('aria-expanded','true'); document.body.style.overflow='hidden'; }
  function closeDrawer(){ drawer.classList.remove('is-open'); burger.setAttribute('aria-expanded','false'); document.body.style.overflow=''; }

  burger && burger.addEventListener('click', openDrawer);
  closeBtn && closeBtn.addEventListener('click', closeDrawer);
  drawer && drawer.addEventListener('click', (e)=>{ if(e.target === drawer) closeDrawer(); });

  // Mobile accordions
  accBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const panel = btn.nextElementSibling;
      const open = panel.style.maxHeight && panel.style.maxHeight !== '0px';
      panel.style.maxHeight = open ? '0px' : panel.scrollHeight + 'px';
      btn.classList.toggle('is-open', !open);
    });
  });

  // Search: intenta foco al input; si no existe, redirige a /search
  searchBtn && searchBtn.addEventListener('click', ()=>{
    const input = document.getElementById('Search-In-Modal') || document.querySelector('input[type="search"]');
    if(input){ try{ input.focus(); input.select && input.select(); }catch(e){} }
    else { window.location.href = '/search'; }
  });
})();
</script>

{% schema %}
{
  "name": "Modern Header (Moy)",
  "class": "section-header",
  "settings": [],
  "enabled_on": {
    "templates": ["*"]
  }
}
{% endschema %}
