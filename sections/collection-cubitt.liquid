{%- comment -%}
  Collection Cubitt Section
  Responsive 3/2/1 grid with Cubitt-style cards, badges, swatches, facets, sort, and pagination.
  Data: collection, collection.products, product, product.variants, product.featured_image
{%- endcomment -%}

<section id="collection-cubitt-section-{{ section.id }}" class="collection-cubitt" style="--gap: {{ section.settings.grid_gap | default: 24 }}px; --card-pad: {{ section.settings.card_padding | default: 20 }}px;">
  <style>
    #collection-cubitt-section-{{ section.id }} {
      --bg-page: #F5F5F5;
      --card-radius: 18px;
      --shadow: 0 6px 22px rgba(16,24,40,.08);
      --badge-bg: #E9ECF9;
      --price-color: #111827;
      background: var(--bg-page);
    }
    #collection-cubitt-section-{{ section.id }} .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 20px;
    }
    #collection-cubitt-section-{{ section.id }} .layout {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: var(--gap);
    }
    @media (max-width: 1024px) {
      #collection-cubitt-section-{{ section.id }} .layout {
        grid-template-columns: 1fr;
      }
    }
    /* Grid */
    #collection-cubitt-section-{{ section.id }} .grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: var(--gap);
    }
    @media (max-width: 1024px) {
      #collection-cubitt-section-{{ section.id }} .grid { grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    @media (max-width: 640px) {
      #collection-cubitt-section-{{ section.id }} .grid { grid-template-columns: 1fr; }
    }

    /* Card */
    #collection-cubitt-section-{{ section.id }} .card {
      background: #fff;
      border-radius: var(--card-radius);
      box-shadow: var(--shadow);
      padding: calc(var(--card-pad));
      position: relative;
      transition: transform .2s ease, box-shadow .2s ease;
      outline: none;
    }
    #collection-cubitt-section-{{ section.id }} .card:focus-visible {
      box-shadow: 0 0 0 3px rgba(34, 113, 254, .4), var(--shadow);
    }
    #collection-cubitt-section-{{ section.id }} .card:hover { transform: translateY(-3px); }

    /* Image square */
    #collection-cubitt-section-{{ section.id }} .image-wrap {
      width: 100%;
      aspect-ratio: 1/1;
      background: #fafafa;
      border-radius: 12px;
      display: grid;
      place-items: center;
      overflow: hidden;
      margin-bottom: 14px;
    }
    #collection-cubitt-section-{{ section.id }} .image-wrap img {
      width: 100%; height: 100%; object-fit: contain; display: block;
    }

    /* Badges */
    #collection-cubitt-section-{{ section.id }} .badges {
      position: absolute; top: 10px; left: 10px;
      display: flex; gap: 8px; flex-wrap: wrap;
    }
    #collection-cubitt-section-{{ section.id }} .badge {
      background: var(--badge-bg);
      border-radius: 999px;
      padding: 6px 10px; font-size: 12px; font-weight: 600; letter-spacing: .02em;
    }

    /* Typography */
    #collection-cubitt-section-{{ section.id }} .title { font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 6px 0 2px; }
    #collection-cubitt-section-{{ section.id }} .vendor { text-transform: uppercase; font-weight: 800; font-size: 12px; opacity: .9; letter-spacing: .06em; }
    #collection-cubitt-section-{{ section.id }} .product-title { font-weight: 600; font-size: 15px; }
    #collection-cubitt-section-{{ section.id }} .price { color: var(--price-color); font-weight: 700; font-size: 18px; margin-top: 8px; }

    /* Swatches */
    #collection-cubitt-section-{{ section.id }} .swatches { display: flex; gap: 10px; align-items: center; margin-top: 10px; }
    #collection-cubitt-section-{{ section.id }} .swatch { width: 22px; height: 22px; border-radius: 999px; border: 1px solid rgba(0,0,0,.08); box-shadow: inset 0 0 0 1px rgba(255,255,255,.5); }
    #collection-cubitt-section-{{ section.id }} .swatch[aria-label] { outline: none; }
    #collection-cubitt-section-{{ section.id }} .more-count { font-size: 12px; color: #6b7280; font-weight: 600; }

    /* Header controls */
    #collection-cubitt-section-{{ section.id }} .controls { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; gap: 12px; }
    #collection-cubitt-section-{{ section.id }} .sort {
      display: inline-flex; align-items: center; gap: 8px;
      background: #fff; border-radius: 999px; padding: 6px 10px; box-shadow: var(--shadow);
    }
    #collection-cubitt-section-{{ section.id }} select { border: none; background: transparent; font-size: 14px; }

    /* Sidebar */
    #collection-cubitt-section-{{ section.id }} .sidebar { position: sticky; top: 12px; align-self: start; }
    #collection-cubitt-section-{{ section.id }} .mobile-filters-toggle { display: none; }
    @media (max-width: 1024px) {
      #collection-cubitt-section-{{ section.id }} .sidebar { display: none; }
      #collection-cubitt-section-{{ section.id }} .mobile-filters-toggle { display: block; margin-bottom: 12px; }
      #collection-cubitt-section-{{ section.id }} details.mobile-facets { background: #fff; border-radius: 12px; padding: 10px; box-shadow: var(--shadow);} 
      #collection-cubitt-section-{{ section.id }} details.mobile-facets summary { cursor: pointer; font-weight: 700; }
    }

    /* Empty */
    #collection-cubitt-section-{{ section.id }} .empty { text-align: center; color: #6b7280; padding: 40px 0; }

    /* Pagination */
    #collection-cubitt-section-{{ section.id }} .pagination { display:flex; gap:8px; justify-content:center; align-items:center; margin-top: 22px; }
    #collection-cubitt-section-{{ section.id }} .pagination a,
    #collection-cubitt-section-{{ section.id }} .pagination span { background:#fff; padding:8px 12px; border-radius:999px; box-shadow: var(--shadow); font-size:14px; }
    #collection-cubitt-section-{{ section.id }} .pagination .current { font-weight: 800; }
  </style>

  <div class="container" role="region" aria-label="{{ collection.title | escape }}">
    <div class="controls">
      <div class="mobile-filters-toggle">
        <details class="mobile-facets">
          <summary>Filters</summary>
          {%- render 'facets', results: collection, enable_filtering: true -%}
        </details>
      </div>
      <div></div>
      <form class="sort" method="get" role="combobox" aria-label="Sort products">
        <label for="sort-by-{{ section.id }}" class="sr-only">{{ 'collections.sorting.title' | t }}</label>
        <select id="sort-by-{{ section.id }}" name="sort_by" aria-controls="product-grid-{{ section.id }}">
          {%- for option in collection.sort_options -%}
            <option value="{{ option.value }}"{% if option.value == collection.sort_by %} selected{% endif %}>{{ option.name | escape }}</option>
          {%- endfor -%}
        </select>
        <noscript><button type="submit">Apply</button></noscript>
      </form>
    </div>

    <div class="layout">
      {%- if section.settings.show_sidebar_filters -%}
        <aside class="sidebar" aria-label="Filters">
          {%- render 'facets', results: collection, enable_filtering: true -%}
        </aside>
      {%- endif -%}

      <div>
        {%- paginate collection.products by section.settings.paginate_by -%}
          {%- if paginate.items == 0 -%}
            <p class="empty">No products match your filters. Try removing some filters or clear all.</p>
          {%- else -%}
            <ul id="product-grid-{{ section.id }}" class="grid" role="list">
              {%- for product in collection.products -%}
                {%- if section.settings.respect_only_available and product.available == false -%}
                  {%- continue -%}
                {%- endif -%}
                <li>
                  {%- render 'card-product-cubitt', product: product, section: section -%}
                </li>
              {%- endfor -%}
            </ul>
            <nav class="pagination" role="navigation" aria-label="Pagination">
              {%- if paginate.pages > 1 -%}
                {%- if paginate.previous -%}
                  <a href="{{ paginate.previous.url }}" aria-label="Previous page">Prev</a>
                {%- endif -%}
                {%- for part in paginate.parts -%}
                  {%- if part.is_link -%}
                    <a href="{{ part.url }}">{{ part.title }}</a>
                  {%- else -%}
                    <span class="current">{{ part.title }}</span>
                  {%- endif -%}
                {%- endfor -%}
                {%- if paginate.next -%}
                  <a href="{{ paginate.next.url }}" aria-label="Next page">Next</a>
                {%- endif -%}
              {%- endif -%}
            </nav>
          {%- endif -%}
        {%- endpaginate -%}
      </div>
    </div>
  </div>

  {%- schema -%}
  {
    "name": "Collection Cubitt",
    "settings": [
      { "type": "text", "id": "fallback_badge_one", "label": "Fallback badge 1", "default": "GPS" },
      { "type": "text", "id": "fallback_badge_two", "label": "Fallback badge 2", "default": "VITA AI" },
      { "type": "checkbox", "id": "enable_swatches", "label": "Enable color swatches", "default": true },
      { "type": "checkbox", "id": "show_sidebar_filters", "label": "Show left filters", "default": true },
      { "type": "checkbox", "id": "respect_only_available", "label": "Hide unavailable products (server-side)", "default": false },
      { "type": "range", "id": "grid_gap", "label": "Grid gap (px)", "default": 24, "min": 12, "max": 40, "step": 2 },
      { "type": "range", "id": "card_padding", "label": "Card padding (px)", "default": 20, "min": 16, "max": 28, "step": 1 },
      { "type": "range", "id": "paginate_by", "label": "Products per page", "default": 12, "min": 6, "max": 36, "step": 3 }
    ],
    "presets": [
      { "name": "Collection Cubitt" }
    ]
  }
  {%- endschema -%}
</section>
