{% style %}
#shopify-section-{{ section.id }} {
  padding-top: {{ section.settings.padding_top_desktop }};
  padding-bottom: {{ section.settings.padding_bottom_desktop }};
  margin-top: 60px; /* ⬅️ Añadido manualmente */
}
@media (max-width: 767px) {
  #shopify-section-{{ section.id }} {
    padding-top: {{ section.settings.padding_top_mobile }};
    padding-bottom: {{ section.settings.padding_bottom_mobile }};
    margin-top: 40px; /* ⬅️ versión móvil opcional */
  }
}


{% endstyle %}




{{ 'main-product.css' | asset_url | stylesheet_tag }}
{{ 'trending_products.css' | asset_url | stylesheet_tag }}
<div class="page-width container-fluid">
  <div class="row">
    <div class="col-md-12">
      <h2 class="sh-48 mb-40">{{ section.settings.heading }}</h2>
    </div>
  </div>
  <div class="row trending_products">
    {% for block in section.blocks %}
      <div class="col-sm-6 col-md-2">
        {% render 'card-product', product: block.settings.product_id %}
      </div>
    {% endfor %}
  </div>
</div>

<script>
  // Create a map for each product's color options and images
  const productColorImageMap = {};
  {% for block in section.blocks %}
    productColorImageMap["{{ block.settings.product_id.id }}"] = {
      {% for variant in block.settings.product_id.variants %}
        "{{ variant.option1 | downcase }}": "{{ variant.featured_image | img_url: '342x' }}"{% unless forloop.last %},{% endunless %}
      {% endfor %}
    };
  {% endfor %}

  // Listen for color changes on each product
  document.querySelectorAll('.color-radio').forEach(radio => {
    radio.addEventListener('change', function () {
      const productId = this.dataset.productId; // Get product ID
      const selectedColor = this.value; // Get the selected color
      const newImageSrc = productColorImageMap[productId][selectedColor]; // Get the corresponding image URL

      // Check if the newImageSrc is a placeholder image
      if (newImageSrc && !newImageSrc.includes('/assets/no-image')) {
        // Update the image for the selected product
        const productImage = document.querySelector(`.card-media img[data-product-id="${productId}"]`);
        const loader = document.querySelector(`.loader[data-product-id="${productId}"]`);
        
        if (productImage) {
          // Show loader
          loader.style.display = 'block';
          productImage.style.opacity = 0;

          // Change the image source
          productImage.src = newImageSrc;

          // Wait for the image to load
          productImage.onload = () => {
            loader.style.display = 'none'; // Hide loader
            productImage.style.opacity = 1; // Show the image
          };

          // Handle image load failure
          productImage.onerror = () => {
            loader.style.display = 'none'; // Hide loader
            console.error(`Failed to load image for color: ${selectedColor}`);
          };
        }
      } else {
        console.log(`Placeholder image detected for color: ${selectedColor} of product ID: ${productId}. Image update skipped.`);
      }
    });
  });
</script>

{% schema %}
{
  "name": "Trending Products",
  "class": "trending-products",
  "settings": [
     {
      "type": "text",
      "id": "heading",
      "label": "heading",
    },
    {
      "type": "text",
      "id": "padding_top_desktop",
      "label": "Padding Desktop Top",
      "default": "60px"
    },
     {
      "type": "text",
      "id": "padding_bottom_desktop",
      "label": "Padding Desktop Bottom",
      "default": "80px"
    },
     {
      "type": "text",
      "id": "padding_top_mobile",
      "label": "Padding Mobile Top",
      "default": "40px"
    },
     {
      "type": "text",
      "id": "padding_bottom_mobile",
      "label": "Padding Mobile Bottom",
      "default": "40px"
    },

  ],
  "blocks": [
    {
      "type": "trending_product",
      "name": "Trending Product",
      "settings": [
        {
          "type": "product",
          "id": "product_id",
          "label": "Select Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Trending Products",
    }
  ]
}
{% endschema %}
