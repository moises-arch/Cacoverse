{%- style -%}
  .refined-faqs-section-{{ section.id }} {
    --padding-top-desktop: {{ section.settings.padding_top_desktop | default: '80px' }};
    --padding-bottom-desktop: {{ section.settings.padding_bottom_desktop | default: '80px' }};
    --padding-top-mobile: {{ section.settings.padding_top_mobile | default: '40px' }};
    --padding-bottom-mobile: {{ section.settings.padding_bottom_mobile | default: '40px' }};
  }
{%- endstyle -%}

{{ 'refined-faqs.css' | asset_url | stylesheet_tag }}

{% if page.metafields.custom.faq.value != blank %}
  <div class="refined-faqs-section refined-faqs-section-{{ section.id }}">
    <div class="refined-faqs-container">
      {% if section.settings.heading != blank %}
        <h2 class="refined-faqs-heading">{{ section.settings.heading }}</h2>
      {% endif %}

      <div class="refined-faq-list">
        {%- for faq_item in page.metafields.custom.faq.value -%}
          {%- capture row_type -%}{%- cycle 'question', 'answer' -%}{%- endcapture -%}
          
          {%- if row_type == 'question' -%}
            <div class="refined-faq-item">
              <button type="button" class="refined-faq-question" aria-expanded="false">
                <span class="refined-faq-question-text">{{ faq_item }}</span>
                <span class="refined-faq-icon">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </button>
          {%- else -%}
              <div class="refined-faq-answer-wrapper">
                <div class="refined-faq-answer">
                  {{ faq_item }}
                </div>
              </div>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>

      {% if section.settings.button_url != blank %}
        <div class="refined-faqs-button-wrapper">
          <a class="refined-btn" href="{{ section.settings.button_url }}">
            {{ section.settings.button_label | default: "Learn More" }}
          </a>
        </div>
      {% endif %}
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const faqContainer = document.querySelector('.refined-faqs-section-{{ section.id }}');
      if (!faqContainer) return;

      faqContainer.addEventListener('click', function(e) {
        const button = e.target.closest('.refined-faq-question');
        if (!button) return;

        const item = button.closest('.refined-faq-item');
        const wrapper = item.querySelector('.refined-faq-answer-wrapper');
        const isActive = item.classList.contains('active');

        // Close other items (optional - currently allowing multiple open)
        // To strictly allow one: 
        // faqContainer.querySelectorAll('.refined-faq-item.active').forEach(otherItem => {
        //   if (otherItem !== item) {
        //      otherItem.classList.remove('active');
        //      otherItem.querySelector('.refined-faq-answer-wrapper').style.maxHeight = null;
        //      otherItem.querySelector('.refined-faq-question').setAttribute('aria-expanded', 'false');
        //   }
        // });

        if (isActive) {
          item.classList.remove('active');
          button.setAttribute('aria-expanded', 'false');
          wrapper.style.maxHeight = null;
        } else {
          item.classList.add('active');
          button.setAttribute('aria-expanded', 'true');
          wrapper.style.maxHeight = wrapper.scrollHeight + "px";
        }
      });
    });
  </script>
{% endif %}

{% schema %}
{
  "name": "Pages FAQ",
  "class": "page-section-faqs",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label"
    },
     {
      "type": "url",
      "id": "button_url",
      "label": "Button Link"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "text",
      "id": "padding_top_desktop",
      "label": "Padding Top (Desktop)",
      "default": "80px"
    },
     {
      "type": "text",
      "id": "padding_bottom_desktop",
      "label": "Padding Bottom (Desktop)",
      "default": "80px"
    },
     {
      "type": "text",
      "id": "padding_top_mobile",
      "label": "Padding Top (Mobile)",
      "default": "40px"
    },
     {
      "type": "text",
      "id": "padding_bottom_mobile",
      "label": "Padding Bottom (Mobile)",
      "default": "40px"
    }
  ],
  "presets": [
    {
      "name": "Refined Page FIGS"
    }
  ]
}
{% endschema %}
