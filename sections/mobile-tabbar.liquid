{%- comment -%}
  sections/mobile-tabbar.liquid
  Mobile bottom tab bar with Theme Editor controls (Shopify-compatible Liquid).
{%- endcomment -%}

{%- liquid
  assign page_type = request.page_type | default: '' | downcase
  assign is_home = false
-%}
{% if page_type == 'index' %}{% assign is_home = true %}{% endif %}

{%- assign is_search = false -%}
{% if page_type == 'search' %}{% assign is_search = true %}{% endif %}

{%- assign is_collections = false -%}
{% if page_type == 'collection' or page_type == 'list-collections' %}
  {% assign is_collections = true %}
{% endif %}

{%- assign is_account = false -%}
{% if page_type contains 'customers' %}{% assign is_account = true %}{% endif %}

{%- assign is_cart = false -%}
{% if page_type == 'cart' %}{% assign is_cart = true %}{% endif %}

{%- assign cart_count = cart.item_count | default: 0 -%}

{%- if section.settings.enable_on_mobile -%}
<nav class="mh-tabbar" role="navigation" aria-label="Mobile tab bar">
  <ul class="mh-tabbar__list" role="list">
    {%- if section.settings.show_home -%}
    <li class="mh-tabbar__item">
      <a class="mh-tabbar__link{% if is_home %} is-active{% endif %}"
         href="{{ section.settings.home_link | default: routes.root_url }}"
         aria-label="{{ section.settings.home_label }}"
         aria-current="{% if is_home %}page{% else %}false{% endif %}">
        <span class="mh-tabbar__icon" aria-hidden="true">
          <!-- Home -->
          <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 10.5 12 3l9 7.5"></path><path d="M5 10v10h14V10"></path>
          </svg>
        </span>
        <span class="mh-tabbar__label">{{ section.settings.home_label }}</span>
      </a>
    </li>
    {%- endif -%}

    {%- if section.settings.show_search -%}
    <li class="mh-tabbar__item">
      <a class="mh-tabbar__link{% if is_search %} is-active{% endif %}"
         href="{{ section.settings.search_link | default: routes.search_url }}"
         aria-label="{{ section.settings.search_label }}"
         aria-current="{% if is_search %}page{% else %}false{% endif %}">
        <span class="mh-tabbar__icon" aria-hidden="true">
          <!-- Search -->
          <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="7"></circle><path d="m20 20-3.5-3.5"></path>
          </svg>
        </span>
        <span class="mh-tabbar__label">{{ section.settings.search_label }}</span>
      </a>
    </li>
    {%- endif -%}

    {%- if section.settings.show_collection -%}
    <li class="mh-tabbar__item">
      <a class="mh-tabbar__link{% if is_collections %} is-active{% endif %}"
         href="{{ section.settings.collections_link | default: '/collections' }}"
         aria-label="{{ section.settings.collection_label }}"
         aria-current="{% if is_collections %}page{% else %}false{% endif %}">
        <span class="mh-tabbar__icon" aria-hidden="true">
          <!-- Grid -->
          <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 3h6v6H3zM3 15h6v6H3zM15 3h6v6h-6zM15 15h6v6h-6z"></path>
          </svg>
        </span>
        <span class="mh-tabbar__label">{{ section.settings.collection_label }}</span>
      </a>
    </li>
    {%- endif -%}

    {%- if section.settings.show_account -%}
    <li class="mh-tabbar__item">
      <a class="mh-tabbar__link{% if is_account %} is-active{% endif %}"
         href="{{ section.settings.account_link | default: routes.account_url }}"
         aria-label="{{ section.settings.account_label }}"
         aria-current="{% if is_account %}page{% else %}false{% endif %}">
        <span class="mh-tabbar__icon" aria-hidden="true">
          <!-- Account -->
          <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="8" r="4"></circle><path d="M4 21c0-4.2 3.8-7 8-7s8 2.8 8 7"></path>
          </svg>
        </span>
        <span class="mh-tabbar__label">{{ section.settings.account_label }}</span>
      </a>
    </li>
    {%- endif -%}

    {%- if section.settings.show_cart -%}
    <li class="mh-tabbar__item">
      <a class="mh-tabbar__link{% if is_cart %} is-active{% endif %}"
         href="{{ section.settings.cart_link | default: routes.cart_url }}"
         aria-label="{{ section.settings.cart_label }}"
         aria-current="{% if is_cart %}page{% else %}false{% endif %}">
        <span class="mh-tabbar__icon" aria-hidden="true">
          <!-- Cart -->
          <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 6h15l-1.6 8.2A2 2 0 0 1 17.4 16H8.6a2 2 0 0 1-2-1.6L5 4H2"></path>
            <circle cx="9" cy="20" r="1.6"></circle><circle cx="17" cy="20" r="1.6"></circle>
          </svg>
          {%- if cart_count > 0 -%}
          <span class="mh-tabbar__badge" aria-label="{{ cart_count }} items in cart">{{ cart_count }}</span>
          {%- endif -%}
        </span>
        <span class="mh-tabbar__label">{{ section.settings.cart_label }}</span>
      </a>
    </li>
    {%- endif -%}
  </ul>
</nav>

<style>
  .mh-tabbar {
    --tabbar-bg: {{ section.settings.bg | default: '#ffffff' }};
    --tabbar-fg: {{ section.settings.fg | default: '#111111' }};
    --tabbar-active: {{ section.settings.active | default: '#0a6bff' }};
    --tabbar-badge: {{ section.settings.badge | default: '#fe5000' }};
    position: fixed; left: 0; right: 0; bottom: 0;
    background: var(--tabbar-bg); color: var(--tabbar-fg);
    border-top-left-radius: {{ section.settings.radius }}px;
    border-top-right-radius: {{ section.settings.radius }}px;
    box-shadow: 0 -8px 24px rgba(0,0,0,{{ section.settings.shadow_strength }});
    padding-bottom: {% if section.settings.use_safe_area %}max(env(safe-area-inset-bottom), 6px){% else %}6px{% endif %};
    z-index: {{ section.settings.z_index }};
    display: none;
  }
  @media (max-width: {{ section.settings.breakpoint }}px){
    .mh-tabbar { display: block; }
    {% if section.settings.add_body_padding %}
    body { padding-bottom: calc({{ section.settings.bar_height }}px + {% if section.settings.use_safe_area %}env(safe-area-inset-bottom){% else %}0px{% endif %}); }
    {% endif %}
  }
  .mh-tabbar__list{
    margin: 0; padding: 8px 10px 6px;
    display: grid; grid-template-columns: repeat(5, 1fr);
    list-style: none; align-items: end; gap: 2px;
    min-height: {{ section.settings.bar_height }}px;
  }
  .mh-tabbar__item{ text-align:center; }
  .mh-tabbar__link{
    position: relative; display:inline-flex; flex-direction:column;
    align-items:center; justify-content:center;
    min-width:44px; min-height:44px; padding:6px 4px;
    text-decoration:none; color:inherit; outline:0; border-radius:12px;
  }
  .mh-tabbar__link:focus-visible{ box-shadow: 0 0 0 2px var(--tabbar-active); }
  .mh-tabbar__link.is-active{ color: var(--tabbar-active); font-weight:600; }
  .mh-tabbar__icon{ position:relative; line-height:0; }
  .mh-tabbar__label{ display:block; font-size: {{ section.settings.label_size }}px; line-height:1.1; margin-top:2px; }
  .mh-tabbar__badge{
    position:absolute; top:-6px; right:-10px; min-width:18px; height:18px; padding:0 5px;
    border-radius:999px; background: var(--tabbar-badge); color:#fff; font-size:11px; font-weight:700; line-height:18px; text-align:center;
  }
</style>
{%- endif -%}

{% schema %}
{
  "name": "Mobile Tab Bar",
  "settings": [
    { "type": "checkbox", "id": "enable_on_mobile", "label": "Enable on mobile", "default": true },
    { "type": "range", "id": "breakpoint", "label": "Mobile breakpoint (px)", "min": 480, "max": 1200, "step": 8, "default": 768 },
    { "type": "range", "id": "bar_height", "label": "Bar height (px)", "min": 56, "max": 88, "step": 1, "default": 68 },
    { "type": "checkbox", "id": "add_body_padding", "label": "Add body bottom padding to avoid overlap", "default": true },
    { "type": "checkbox", "id": "use_safe_area", "label": "Respect iOS safe area", "default": true },
    { "type": "range", "id": "radius", "label": "Top corner radius (px)", "min": 0, "max": 24, "step": 1, "default": 14 },

    { "type": "range", "id": "shadow_strength", "label": "Shadow strength (alpha)", "min": 0, "max": 0.5, "step": 0.1, "default": 0.1 },

    { "type": "text", "id": "z_index", "label": "Z-index", "default": "1000" },

    { "type": "color", "id": "bg", "label": "Background color", "default": "#ffffff" },
    { "type": "color", "id": "fg", "label": "Text/Icon color", "default": "#111111" },
    { "type": "color", "id": "active", "label": "Active color", "default": "#0a6bff" },
    { "type": "color", "id": "badge", "label": "Cart badge color", "default": "#fe5000" },
    { "type": "range", "id": "label_size", "label": "Label font size (px)", "min": 9, "max": 13, "step": 1, "default": 11 },

    { "type": "header", "content": "Tabs" },

    { "type": "checkbox", "id": "show_home", "label": "Show Home", "default": true },
    { "type": "text", "id": "home_label", "label": "Home label", "default": "Home" },
    { "type": "url", "id": "home_link", "label": "Home link (optional)" },

    { "type": "checkbox", "id": "show_search", "label": "Show Search", "default": true },
    { "type": "text", "id": "search_label", "label": "Search label", "default": "Search" },
    { "type": "url", "id": "search_link", "label": "Search link (optional)" },

    { "type": "checkbox", "id": "show_collection", "label": "Show Collection", "default": true },
    { "type": "text", "id": "collection_label", "label": "Collection label", "default": "Collection" },
    { "type": "url", "id": "collections_link", "label": "Collections link (optional)" },

    { "type": "checkbox", "id": "show_account", "label": "Show Account", "default": true },
    { "type": "text", "id": "account_label", "label": "Account label", "default": "Account" },
    { "type": "url", "id": "account_link", "label": "Account link (optional)" },

    { "type": "checkbox", "id": "show_cart", "label": "Show Cart", "default": true },
    { "type": "text", "id": "cart_label", "label": "Cart label", "default": "Cart" },
    { "type": "url", "id": "cart_link", "label": "Cart link (optional)" }
  ],
  "presets": [{ "name": "Mobile Tab Bar" }]
}
{% endschema %}
