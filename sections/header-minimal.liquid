{% comment %}
  sections/header-hybrid.liquid
  - Desktop: copia 1:1 tu header (sin cambios visuales).
  - Mobile: barra propia (.hyx-topbar) con [burger | LOGO | search+cart], usando el MISMO collapse #navbarNav.
  - Íconos modernos (SVG inline) solo en móvil.
{% endcomment %}

<link rel="stylesheet" href="{{ 'component-search.css' | asset_url }}" media="print" onload="this.media='all'">
{{ 'header-menu.css' | asset_url | stylesheet_tag }}

<header class="site-header hyx">
  <!-- ===== MOBILE TOPBAR (solo <992px) ===== -->
  <div class="hyx-topbar d-lg-none">
    <!-- Izquierda: hamburger (controla #navbarNav) -->
    <button
      class="hyx-btn hyx-burger"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <!-- modern hamburger -->
      <svg viewBox="0 0 24 24" width="26" height="26" aria-hidden="true">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
      </svg>
    </button>

    <!-- Centro: LOGO -->
    <a href="{{ routes.root_url }}" class="hyx-brand" aria-label="{{ shop.name }}">
      {%- if settings.logo != blank -%}
        {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
        {%- assign logo_height = settings.logo_width | divided_by: settings.logo.aspect_ratio -%}
        {% capture sizes %}(max-width: {{ settings.logo_width | times: 2 }}px) 50vw, {{ settings.logo_width }}px{% endcapture %}
        {% capture widths %}{{ settings.logo_width }}, {{ settings.logo_width | times: 1.5 | round }}, {{ settings.logo_width | times: 2 }}{% endcapture %}
        {{
          settings.logo
          | image_url: width: 600
          | image_tag:
            class: 'hyx-logo',
            widths: widths,
            height: logo_height,
            width: settings.logo_width,
            alt: logo_alt,
            sizes: sizes,
            preload: true
        }}
      {% else %}
        <span class="hyx-logo-text">{{ shop.name }}</span>
      {% endif %}
    </a>

    <!-- Derecha: search + cart -->
    <div class="hyx-actions">
      <a class="hyx-btn" href="/search" aria-label="Search">
        <!-- modern search -->
        <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
          <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none"/>
          <path d="M20 20L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </a>
      <a class="hyx-btn hyx-cart" href="{{ routes.cart_url }}" aria-label="{{ 'templates.cart.cart' | t }}">
        <!-- modern bag -->
        <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
          <path d="M6 8h12l-1 12H7L6 8Z" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"/>
          <path d="M9 8a3 3 0 1 1 6 0" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
        </svg>
        {%- if cart != empty -%}
          <span class="hyx-bubble">{{ cart.item_count }}</span>
        {%- endif -%}
      </a>
    </div>
  </div>
  <!-- ===== /MOBILE TOPBAR ===== -->

  <!-- ===== TU NAVBAR ORIGINAL (sin cambios) ===== -->
  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid page-width">
      <!-- Logo (original) -->
      <a href="{{ routes.root_url }}" class="navbar-brand d-none d-lg-block">
        {%- if settings.logo != blank -%}
          <div class="header__heading-logo-wrapper">
            {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
            {%- assign logo_height = settings.logo_width | divided_by: settings.logo.aspect_ratio -%}
            {% capture sizes %}(max-width: {{ settings.logo_width | times: 2 }}px) 50vw, {{ settings.logo_width }}px{% endcapture %}
            {% capture widths %}{{ settings.logo_width }}, {{ settings.logo_width | times: 1.5 | round }}, {{ settings.logo_width | times: 2 }}{% endcapture %}
            {{
              settings.logo
              | image_url: width: 600
              | image_tag:
                class: 'header__heading-logo motion-reduce',
                widths: widths,
                height: logo_height,
                width: settings.logo_width,
                alt: logo_alt,
                sizes: sizes,
                preload: true
            }}
          </div>
        {% else %}
          <span class="h2">{{ shop.name }}</span>
        {% endif %}
      </a>

      <!-- Toggler original (oculto en móvil porque usamos el de la topbar) -->
      <button class="navbar-toggler d-none" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>

      <!-- Menú -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="main-menu-bar navbar-nav mx-auto">
          {% for link in linklists['main-menu'].links %}
            {% assign parent_link_title = link.title | handleize | downcase %}
            {% if parent_link_title == 'products' %}
              <li class="nav-item dropdown position-static">
                <a class="nav-link" href="javascript:void(0);" id="megaMenu-{{ parent_link_title }}" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  {{ link.title }} {{ 'icon-caret.svg' | inline_asset_content }}
                </a>
                <div class="dropdown-menu mega-menu {{ parent_link_title }}-dropdown-menu" aria-labelledby="megaMenu-{{ parent_link_title }}">
                  <div class="container-fluid page-width ">
                    <div class="row">
                      <div class="col-12 col-md-3 border-right">
                        <div class="dropdown-menu-item">
                          <ul class="list-unstyled mb-3 mb-md-3">
                            {% for link_all in linklists['all-categories'].links %}
                              {% if forloop.index == 1 %}<li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                              {% else %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endif %}
                            {% endfor %}
                          </ul>
                          <ul class="list-unstyled mb-3">
                            {% for link_all in linklists['program'].links %}
                              {% if forloop.index == 1 %}<li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                              {% else %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endif %}
                            {% endfor %}
                          </ul>
                        </div>
                      </div>
                      <div class="col-12 col-md-3 border-right">
                        <div class="dropdown-menu-item">
                          <ul class="list-unstyled mb-3 mb-md-3">
                            {% for link_all in linklists['hand-protection'].links %}
                              {% if forloop.index == 1 %}<li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                              {% else %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endif %}
                            {% endfor %}
                          </ul>
                          <ul class="list-unstyled mb-3">
                            {% for link_all in linklists['protective-clothing'].links %}
                              {% if forloop.index == 1 %}<li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                              {% else %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endif %}
                            {% endfor %}
                          </ul>
                        </div>
                      </div>
                      <div class="col-12 col-md-3 border-right">
                        <div class="dropdown-menu-item">
                          <ul class="list-unstyled mb-3 mb-md-3">
                            {% for link_all in linklists['hearing-protection'].links %}
                              {% if forloop.index == 1 %}<li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                              {% else %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endif %}
                            {% endfor %}
                          </ul>
                          <ul class="list-unstyled mb-3 mb-md-3">
                            {% for link_all in linklists['head-protection'].links %}
                              {% if forloop.index == 1 %}<li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                              {% else %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endif %}
                            {% endfor %}
                          </ul>
                          <ul class="list-unstyled">
                            {% for link_all in linklists['ergonomics'].links %}
                              {% if forloop.index == 1 %}<li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                              {% else %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endif %}
                            {% endfor %}
                          </ul>
                        </div>
                      </div>
                      <div class="col-12 col-md-3 border-right">
                        <div class="dropdown-menu-item">
                          <ul class="list-unstyled mb-3 mb-md-3">
                            {% for link_all in linklists['eye-protection'].links %}
                              {% if forloop.index == 1 %}<li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                              {% else %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endif %}
                            {% endfor %}
                          </ul>
                          <ul class="list-unstyled mb-3">
                            {% for link_all in linklists['microfiber-towels'].links %}
                              {% if forloop.index == 1 %}<li><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                              {% else %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endif %}
                            {% endfor %}
                          </ul>
                          <ul class="list-unstyled mb-3">
                            {% for link_all in linklists['sale'].links %}
                              {% if forloop.index == 1 %}<li class="menu-slug-{{ link_all.title | handleize }}"><h3><a href="{{ link_all.url }}">{{ link_all.title }}</a></h3></li>
                              {% else %}<li><a href="{{ link_all.url }}">{{ link_all.title }}</a></li>{% endif %}
                            {% endfor %}
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            {% elsif parent_link_title == 'brands' %}
              <li class="nav-item dropdown position-static">
                <a class="nav-link" href="{{ link.url }}" id="megaMenu-{{ parent_link_title }}" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  {{ link.title }} {{ 'icon-caret.svg' | inline_asset_content }}
                </a>
                {% if link.links.size > 0 %}
                  <div class="dropdown-menu mega-menu {{ parent_link_title }}-dropdown-menu" aria-labelledby="megaMenu-{{ parent_link_title }}">
                    <div class="container-fluid page-width">
                      <div class="row">
                        <div class="col-12 col-md-4 border-right">
                          <div class="dropdown-menu-item" onclick="location.href = '/pages/ppe-categories';" style="cursor:pointer;">
                            <div class="imager text-center mb-3">
                              <img src="{{ 'menu-brand-1.png' |asset_img_url : 'master' }}" class="img-fluid" width="auto" height="125" loading="lazy">
                            </div>
                            <h3 class="text-center mt-3 mt-md-4 mb-2">GE PPE</h3>
                            <p class="sp-16 text-center">GE is one of the most valuable and respected brands...</p>
                          </div>
                        </div>
                        <div class="col-12 col-md-4 border-right">
                          <div class="dropdown-menu-item" onclick="location.href = '/collections/best-value';" style="cursor:pointer;">
                            <div class="imager text-center mb-3">
                              <img src="https://cdn.shopify.com/s/files/1/0660/8800/9781/files/menu-brand-4.png" class="img-fluid" width="auto" height="125" loading="lazy">
                            </div>
                            <h3 class="text-center mt-3 mt-md-4 mb-2">Best Value</h3>
                            <p class="sp-16 text-center">Best Value is a fast-growing brand...</p>
                          </div>
                        </div>
                        <div class="col-12 col-md-4">
                          <div class="dropdown-menu-item" onclick="location.href = '/collections/wd-40';" style="cursor:pointer;">
                            <div class="imager text-center mb-3">
                              <img src="{{ 'menu-brand-3.png' |asset_img_url : 'master' }}" class="img-fluid" width="auto" height="125" loading="lazy">
                            </div>
                            <h3 class="text-center mt-3 mt-md-4 mb-2">WD-40 Microfiber Towels</h3>
                            <p class="sp-16 text-center">WD-40 Brand products help keep tractors...</p>
                          </div>
                        </div>
                      </div>
                    </div>
                {% endif %}
              </li>
            {% elsif parent_link_title == 'industries' %}
              <li class="nav-item dropdown position-static">
                <a class="nav-link" href="{{ link.url }}" id="megaMenu-{{ parent_link_title }}" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  {{ link.title }} {{ 'icon-caret.svg' | inline_asset_content }}
                </a>
                {% if link.links.size > 0 %}
                  <div class="dropdown-menu mega-menu {{ parent_link_title }}-dropdown-menu" aria-labelledby="megaMenu-{{ parent_link_title }}">
                    <div class="container-fluid page-width">
                      <div class="row">
                        {% assign link_count = link.links.size %}
                        {% for sublink in link.links %}
                          {% assign index0 = forloop.index0 %}
                          {% assign mod = index0 | modulo: 3 %}
                          {% if mod == 0 %}<div class="col-12 col-md-4 border-right">{% endif %}
                          {% assign my_collection = sublink.object %}
                          <div class="d-flex align-items-center gap-2 mb-3">
                            <img src="{{ my_collection.metafields.custom.page_featured_image | img_url :'80x' }}" class="img-fluid" width="80" height="80" loading="lazy">
                            <a href="{{ sublink.url }}" class="dropdown-item">{{ sublink.title }}</a>
                          </div>
                          {% assign next_index = index0 | plus: 1 %}
                          {% assign close_mod = next_index | modulo: 3 %}
                          {% if close_mod == 0 or forloop.last %}</div>{% endif %}
                        {% endfor %}
                      </div>
                    </div>
                {% endif %}
              </li>
            {% elsif parent_link_title == 'resources' %}
              <li class="nav-item dropdown position-static">
                <a class="nav-link" href="javascript:void(0);" id="megaMenu-{{ parent_link_title }}" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  {{ link.title }} {{ 'icon-caret.svg' | inline_asset_content }}
                </a>
                {% if link.links.size > 0 %}
                  <div class="dropdown-menu mega-menu {{ parent_link_title }}-dropdown-menu" aria-labelledby="megaMenu-{{ parent_link_title }}">
                    <div class="container-fluid page-width">
                      <div class="row">
                        <div class="col-12 d-flex align-items-start flex-wrap flex-lg-nowrap ">
                          {% for sublink in link.links %}
                            <div class="dropdown-menu-item border-right">
                              <h3><a href="{{ sublink.url }}">{{ sublink.title }}</a></h3>
                              {% if sublink.links.size > 0 %}
                                <ul class="list-unstyled ">
                                  {% for subsublink in sublink.links %}
                                    <li><a href="{{ subsublink.url }}">{{ subsublink.title }}</a></li>
                                  {% endfor %}
                                </ul>
                              {% endif %}
                            </div>
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                {% endif %}
              </li>
            {% elsif parent_link_title == 'contact' %}
              <li class="nav-item dropdown position-static">
                <a class="nav-link" href="{{ link.url }}" id="megaMenu-{{ parent_link_title }}" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  {{ link.title }} {{ 'icon-caret.svg' | inline_asset_content }}
                </a>
                {% if link.links.size > 0 %}
                  <div class="dropdown-menu mega-menu {{ parent_link_title }}-dropdown-menu" aria-labelledby="megaMenu-{{ parent_link_title }}">
                    <div class="container-fluid page-width">
                      <div class="row">
                        {% for sublink in link.links %}
                          <div class="col-12 col-md-6 border-right">
                            {% assign my_collection = sublink.object %}
                            <div class="d-flex align-items-center gap-2 mb-3 justify-content-center">
                              <img src="{{ my_collection.metafields.custom.page_featured_image | img_url :'80x' }}" class="img-fluid " width="80" height="80" loading="lazy">
                              <a href="{{ sublink.url }}" class="dropdown-item">{{ sublink.title }}</a>
                            </div>
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                {% endif %}
              </li>
             {% elsif parent_link_title == 'about-us' %}
               <li class="nav-item dropdown position-static">
                <a class="nav-link" href="{{ link.url }}" id="menu-{{ parent_link_title }}" role="link">
                  {{ link.title }}
                </a>
               </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>

      <!-- Iconos originales (solo desktop como siempre) -->
      <ul class="navbar-nav align-items-center gap-1 gap-xxl-2 icosn d-none d-lg-flex">
        <li class="nav-item mobile-header-search">{% render 'header-search', input_id: 'Search-In-Modal' %}</li>
        <li>
          {%- if shop.customer_accounts_enabled -%}
            <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
               class="header__icon header__icon--account link focus-inset" rel="nofollow">
              <span class="svg-wrapper">{{ 'icon-account.svg' | inline_asset_content }}</span>
              <span class="visually-hidden">{%- if customer -%}{{ 'customer.account_fallback' | t }}{%- else -%}{{ 'customer.log_in' | t }}{%- endif -%}</span>
            </a>
          {%- endif -%}
        </li>
        <li class="nav-item">
          <a href="{{ routes.cart_url }}" class="header__icon header__icon--cart link focus-inset" id="cart-icon-bubble">
            {% if cart == empty %}<span class="svg-wrapper">{{ 'icon-cart-empty.svg' | inline_asset_content }}</span>
            {% else %}<span class="svg-wrapper">{{ 'icon-cart.svg' | inline_asset_content }}</span>{% endif %}
            <span class="visually-hidden">{{ 'templates.cart.cart' | t }}</span>
            {%- if cart != empty -%}
              <div class="cart-count-bubble">{%- if cart.item_count < 100 -%}<span aria-hidden="true">{{ cart.item_count }}</span>{%- endif -%}
                <span class="visually-hidden">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
              </div>
            {%- endif -%}
          </a>
        </li>
      </ul>
    </div>
  </nav>
</header>

{% style %}
/* ====== HYBRID HEADER (namespaced .hyx) ====== */
.hyx .hyx-topbar{
  position: sticky; top: 0; z-index: 1100;
  display: grid; grid-template-columns: 56px 1fr 100px; align-items: center;
  height: 56px; padding: 0 10px;
  background: rgba(16,20,24,.55);
  -webkit-backdrop-filter: blur(10px) saturate(140%); backdrop-filter: blur(10px) saturate(140%);
  border-bottom: 1px solid rgba(255,255,255,.12);
}
.hyx .hyx-btn{background: transparent; border: 0; color: #fff; width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; cursor: pointer}
.hyx .hyx-brand{justify-self: center; text-decoration: none}
.hyx .hyx-logo{max-height: 26px; filter: brightness(0) invert(1)}
.hyx .hyx-logo-text{color:#fff; font-weight:700}
.hyx .hyx-actions{justify-self:end; display:inline-flex; gap:14px; align-items:center; position:relative}
.hyx .hyx-bubble{position:absolute; transform: translate(12px,-10px); min-width:16px; height:16px; border-radius:999px; background:#ff3b30; color:#fff; font-size:11px; line-height:16px; text-align:center; padding:0 4px}

/* Ocultar piezas duplicadas en móvil para evitar desorden */
@media (max-width: 991.98px){
  .hyx .navbar-brand{ display:none !important; }
  .hyx .navbar-toggler{ display:none !important; } /* usamos el burger de la topbar */
  .hyx .icosn{ display:none !important; }         /* iconos desktop fuera en móvil */
  /* Collapse ocupa toda la pantalla debajo de la topbar */
  .hyx .navbar-collapse{
    position: fixed !important; top: 56px !important; left:0; right:0; bottom:0;
    background:#fff; z-index: 1090; overflow-y: auto; border:0;
  }
}

/* Desktop: NO tocamos tu estilo; solo aseguramos que el navbar siga arriba del contenido */
@media (min-width: 992px){
  .hyx .hyx-topbar{ display:none; }
}
{% endstyle %}

{% schema %}
{
  "name": "Header Hybrid (Moy)",
  "class": "section-header",
  "settings": []
}
{% endschema %}
