{% comment %}
  Renders a swatch input component.
  Accepts:
  - id: {String} unique input id
  - type: {String} input type. Accepts 'radio' or 'checkbox', defaults to 'radio' (optional)
  - name: {String} input name,
  - value: {ProductOptionValueDrop} input value
  - swatch: {SwatchDrop} the swatch drop
  - product_form_id: {String} id of the form associted with the input
  - checked: {Boolean} default checked status
  - disabled: {Boolean} default disabled status (optional)
  - visually_disabled: {Boolean} style the swatch as disabled, but leave the input enabled (optional)
  - shape: {String} swatch shape. Accepts 'square', defaults to circle (optional)
  - help_text: {String} additional content to render inside the label (optional)
  - additional_props: {String} (optional) additional properties to attach to the input

  Usage:
   {% render 'swatch-input',
      id: input_id,
      name: input_name,
      value: input_value,
      swatch: swatch,
      product_form_id: product_form_id,
      checked: checked
    %}
{% endcomment %}

{%- liquid
  assign tooltip_bg = '#4b5563'
  assign tooltip_text = '#ffffff'

  if swatch.color
    assign rgb_parts = swatch.color.rgb | split: ','
    assign r = rgb_parts[0] | plus: 0
    assign g = rgb_parts[1] | plus: 0
    assign b = rgb_parts[2] | plus: 0
    assign r_weighted = r | times: 299
    assign g_weighted = g | times: 587
    assign b_weighted = b | times: 114
    assign brightness = r_weighted | plus: g_weighted | plus: b_weighted | divided_by: 1000

    assign tooltip_bg = 'rgb(' | append: swatch.color.rgb | append: ')'
    assign tooltip_text = '#ffffff'
    if brightness > 170
      assign tooltip_text = '#0f172a'
    endif
  endif
-%}

<input
  type="{{ type | default: 'radio' }}"
  id="{{ id }}"
  name="{{ name }}"
  value="{{ value }}"
  form="{{ product_form_id }}"
  class="swatch-input__input{% if visually_disabled %} visually-disabled{% endif %}"
  {% if checked %}
    checked
  {% endif %}
  {% if disabled %}
    disabled
  {% endif %}
  {% if additional_props %}
    {{ additional_props }}
  {% endif %}
>
<label
  for="{{ id }}"
  class="swatch-input__label{% if shape == 'square' %} swatch-input__label--square{% endif %}"
  data-tooltip="{{ value | escape }}"
  aria-label="{{ value | escape }}"
  style="--swatch-tooltip-bg: {{ tooltip_bg }}; --swatch-tooltip-text: {{ tooltip_text }};"
>
  {% render 'swatch', swatch: swatch, shape: shape %}
  {{ help_text }}
</label>
