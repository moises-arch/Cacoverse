{% liquid
  assign rating_count = product.metafields.junip.rating_count | default: 0 | plus: 0
  assign rating_value = product.metafields.junip.rating | default: product.metafields.junip.rating_average | default: 0
  assign rating_value_num = rating_value | plus: 0
  assign rating_tenths = rating_value_num | times: 10 | round: 0
  assign rating_display = rating_tenths | divided_by: 10.0
%}

{% if rating_count > 0 and rating_value_num > 0 %}
  <div class="junip-custom-stars" aria-label="Rated {{ rating_display }} out of 5 based on {{ rating_count }} reviews">
    <div class="junip-star-row" aria-hidden="true">
      {% for i in (1..5) %}
        {% assign fill = 0 %}
        {% if rating_value_num >= i %}
          {% assign fill = 100 %}
        {% elsif rating_value_num > i - 1 %}
          {% assign fill = rating_value_num | minus: i | plus: 1 | times: 100 | round: 0 %}
        {% endif %}
        <span class="junip-star" style="--fill: {{ fill }}%;">
          <svg viewBox="0 0 24 24" class="star-base" role="presentation" aria-hidden="true">
            <path d="M12 2.5l2.8 6.1 6.6.5-5 4.4 1.5 6.4-5.9-3.5-5.9 3.5 1.5-6.4-5-4.4 6.6-.5z" />
          </svg>
          <svg viewBox="0 0 24 24" class="star-fill" role="presentation" aria-hidden="true">
            <path d="M12 2.5l2.8 6.1 6.6.5-5 4.4 1.5 6.4-5.9-3.5-5.9 3.5 1.5-6.4-5-4.4 6.6-.5z" />
          </svg>
        </span>
      {% endfor %}
    </div>
    <span class="junip-rating-count">({{ rating_count }})</span>
  </div>
{% endif %}
