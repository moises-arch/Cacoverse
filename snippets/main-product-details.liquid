{{ 'page-faqs.css' | asset_url | stylesheet_tag }}

{% style %}
  .product__info-container .product-features li {
    font-weight: 400;
    font-size: 16px;
    line-height: 22px;
    color: var(--font-secondary-color);
    padding-bottom: 15px;
  }

  .product__info-container .download-resources li {
    box-sizing: border-box;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: flex-start;
    padding: 16px 0px;
    gap: 15px;
    border-bottom: 0.5px dashed #ABB8C3;
  }
{% endstyle %}

<div class="product-details-accordion page-faqs">
  <div class="product-details-accordion__shell">
    <div class="product-details-accordion__header">
      <p class="product-details-accordion__eyebrow">Product details</p>
    </div>

      <div class="faq-list">
      {%- assign first_item_active = true -%}

      <!-- Product Description Tab -->
      {% if product.description != blank %}
        <div class="faq-item{% if first_item_active %} active{% endif %}">
          <button class="faq-question" type="button" aria-expanded="{% if first_item_active %}true{% else %}false{% endif %}">
            <div class="faq-question__copy">
              <span class="faq-question__eyebrow">Overview</span>
              <span class="faq-question__title">Product Description</span>
            </div>
            <span class="faq-question__icon" aria-hidden="true" style="margin-left: auto;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-icon"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </span>
          </button>

          <div class="faq-answer" aria-hidden="{% if first_item_active %}false{% else %}true{% endif %}" {% if first_item_active %}style="display: block;"{% endif %}>
            <div class="faq-answer__inner">
              <div class="rte product-description-truncated is-collapsed" id="ProductDescriptionContent">
                {{ product.description }}
              </div>
              <div class="product-description-actions">
                <button type="button" class="btn-read-more" id="BtnReadMoreDescription">
                  <span>Show full description</span>
                  <svg width="10" height="6" viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 8px;">
                    <path d="M1 1L5 5L9 1"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
        {%- assign first_item_active = false -%}

        <style>
          .product-description-truncated {
            position: relative;
            transition: max-height 0.4s ease;
          }
          .product-description-truncated.is-collapsed {
            max-height: 250px;
            overflow: hidden;
          }
          /* Header block is now manually controlled by user HTML */
          .product-description-truncated > :first-child {
            margin-top: 0 !important;
          }
          .product-description-truncated.is-collapsed::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 120px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.8) 50%, rgba(255, 255, 255, 1) 100%);
            pointer-events: none;
            z-index: 2;
          }
          .product-description-actions {
            text-align: center;
            margin-top: 15px;
            position: relative;
            z-index: 3; /* Ensure button is above gradient */
          }
          .btn-read-more {
            background: #ffffff;
            border: 1px solid #E2E8F0;
            padding: 10px 24px;
            border-radius: 8px; /* Slightly rounded, modern */
            color: #1E293B; /* Slate 800 */
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
          }
          .btn-read-more:hover {
            background: #F8FAFC;
            border-color: #CBD5E1;
            color: #0F172A;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
          }
          .btn-read-more svg {
            transition: transform 0.3s ease;
          }
          .btn-read-more.expanded svg {
            transform: rotate(180deg);
          }
        </style>

        <script>
          document.addEventListener('DOMContentLoaded', function() {
            const content = document.getElementById('ProductDescriptionContent');
            const btn = document.getElementById('BtnReadMoreDescription');
            
            if(content && btn) {
              // Hide button if content is short
              if(content.scrollHeight <= 250) {
                btn.style.display = 'none';
                content.classList.remove('is-collapsed');
              } else {
                btn.addEventListener('click', function() {
                  const isCollapsed = content.classList.contains('is-collapsed');
                  const span = btn.querySelector('span');
                  
                  if(isCollapsed) {
                    content.classList.remove('is-collapsed');
                    span.textContent = 'Show less';
                    btn.classList.add('expanded');
                  } else {
                    content.classList.add('is-collapsed');
                    span.textContent = 'Show full description';
                    btn.classList.remove('expanded');
                    // Optional: scroll back?
                    // content.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                  }
                });
              }
            }
          });
        </script>
      {% endif %}

      <!-- Features -->
      {% if product.metafields.custom.product_details_features %}
        <div class="faq-item{% if first_item_active %} active{% endif %}">
          <button class="faq-question" type="button" aria-expanded="{% if first_item_active %}true{% else %}false{% endif %}">
            <div class="faq-question__copy">
              <span class="faq-question__eyebrow">Essentials</span>
              <span class="faq-question__title">Features</span>
            </div>
            <span class="faq-question__icon" aria-hidden="true" style="margin-left: auto;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-icon"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </span>
          </button>

          <div class="faq-answer" aria-hidden="{% if first_item_active %}false{% else %}true{% endif %}" {% if first_item_active %}style="display: block;"{% endif %}>
            <div class="faq-answer__inner">
              <p class="faq-answer__lede">Top benefits and standout attributes for this product.</p>
              <div class="meta-fields-details">
                <div class="product-features">
                  <ul class="list-unstyled two-column-list feature-grid">
                    {% for feature in product.metafields.custom.product_details_features.value %}
                      <li class="feature-pill">
                        <span class="feature-pill__icon">
                          <img
                            src="{{ 'feature-icon.png' | asset_url }}"
                            alt="Feature icon"
                            width="16"
                            height="16"
                            loading="lazy"
                            class="img-fluid "
                          >
                        </span>
                        <span class="feature-pill__label">{{ feature }}</span>
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        {%- assign first_item_active = false -%}
      {% endif %}

      {% if product.metafields.custom.product_details_specifications_name %}
        <div class="faq-item{% if first_item_active %} active{% endif %}">
          <button class="faq-question" type="button" aria-expanded="{% if first_item_active %}true{% else %}false{% endif %}">
            <div class="faq-question__copy">
              <span class="faq-question__eyebrow">Tech sheet</span>
              <span class="faq-question__title">Specifications</span>
            </div>
            <span class="faq-question__icon" aria-hidden="true" style="margin-left: auto;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-icon"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </span>
          </button>

          <div class="faq-answer" aria-hidden="{% if first_item_active %}false{% else %}true{% endif %}" {% if first_item_active %}style="display: block;"{% endif %}>
            <div class="faq-answer__inner">
              <p class="faq-answer__lede">Check the key technical data to validate compatibility and performance.</p>
              <div class="meta-fields-details">
                <div class="product-features">
                  <ul class="list-unstyled two-column-list spec-grid">
                    {% assign specification_values = product.metafields.custom.product_details_specification_values.value %}
                    {% for specification in product.metafields.custom.product_details_specifications_name.value %}
                      <li class="spec-grid__item">
                        <p class="spec-grid__label">{{ specification }}</p>
                        <p class="spec-grid__value">{{ specification_values[forloop.index0] -}}</p>
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        {%- assign first_item_active = false -%}
      {% endif %}

      <!-- Documentations -->
      {% if product.metafields.custom.product_details_download_title %}
        <div class="faq-item{% if first_item_active %} active{% endif %}">
          <button class="faq-question" type="button" aria-expanded="{% if first_item_active %}true{% else %}false{% endif %}">
            <div class="faq-question__copy">
              <span class="faq-question__eyebrow">Resources</span>
              <span class="faq-question__title">Documentation & downloads</span>
            </div>
            <span class="faq-question__icon" aria-hidden="true" style="margin-left: auto;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-icon"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </span>
          </button>

          <div class="faq-answer" aria-hidden="{% if first_item_active %}false{% else %}true{% endif %}" {% if first_item_active %}style="display: block;"{% endif %}>
            <div class="faq-answer__inner">
              <p class="faq-answer__lede">Manuals, sheets, and helpful files ready to download.</p>
              <div class="meta-fields-details">
                <div class="download-resources">
                  <ul class="list-unstyled two-column-list resource-grid">
                    {% assign document_links = product.metafields.custom.product_details_download_file_link.value %}
                    {% for document in product.metafields.custom.product_details_download_title.value %}
                      <li class="resource-chip">
                        <div class="resource-chip__body">
                          <span class="resource-chip__title">
                            <a
                              class="sp-16"
                              style="font-weight: 700;"
                              href="{% if document_links[forloop.index0] != blank %}{{ document_links[forloop.index0] }}{% else %}#{% endif %}"
                              target="_blank"
                            >
                              {{- document -}}
                            </a>
                          </span>
                          <span class="resource-chip__meta">PDF / direct download</span>
                        </div>
                        <span class="resource-chip__cta">
                          <a href="{% if document_links[forloop.index0] != blank %}{{ document_links[forloop.index0] }}{% else %}#{% endif %}"  target="_blank" aria-label="Download {{ document }}">
                            <img
                              src="{{ 'PDF.png' | asset_url }}"
                              width="40"
                              height="40"
                              alt="PDF download icon"
                              class="img-fluid"
                              loading="lazy"
                            >
                          </a>
                        </span>
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        {%- assign first_item_active = false -%}
      {% endif %}

      <!-- About the Product -->
      {% if product.metafields.custom.product_details_title and product.metafields.custom.product_detail_description %}
        <div class="faq-item{% if first_item_active %} active{% endif %}">
          <button class="faq-question" type="button" aria-expanded="{% if first_item_active %}true{% else %}false{% endif %}">
            <div class="faq-question__copy">
              <span class="faq-question__eyebrow">Overview</span>
              <span class="faq-question__title">About the product</span>
            </div>
            <span class="faq-question__icon" aria-hidden="true" style="margin-left: auto;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-icon"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </span>
          </button>

          <div class="faq-answer" aria-hidden="{% if first_item_active %}false{% else %}true{% endif %}" {% if first_item_active %}style="display: block;"{% endif %}>
            {% if product.metafields.custom.product_details_title
              and product.metafields.custom.product_detail_description
            %}
              <div class="faq-answer__inner">
                <div class="meta-fields-details">
                  <div class="section-product-details-title-description text-start ">
                    <h2 class="sh-22 mb-3 ">{{ product.metafields.custom.product_details_title }}</h2>
                    <p class="sp-16">{{ product.metafields.custom.product_detail_description }}</p>
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
        {%- assign first_item_active = false -%}
      {% endif %}

      <!-- About Some Feature detail the Product -->
      {% if product.metafields.custom.product_details_sub_title %}
        <div class="faq-item{% if first_item_active %} active{% endif %}">
          <button class="faq-question" type="button" aria-expanded="{% if first_item_active %}true{% else %}false{% endif %}">
            <div class="faq-question__copy">
              <span class="faq-question__eyebrow">Additional details</span>
              <span class="faq-question__title">{{ product.metafields.custom.product_details_sub_title }}</span>
            </div>
            <span class="faq-question__icon" aria-hidden="true" style="margin-left: auto;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-icon"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </span>
          </button>

          <div class="faq-answer" aria-hidden="{% if first_item_active %}false{% else %}true{% endif %}" {% if first_item_active %}style="display: block;"{% endif %}>
            {% if product.metafields.custom.product_details_sub_title %}
              <div class="faq-answer__inner">
                <div class="meta-fields-details">
                  <div class="section-product-details-title-description text-start ">
                    {{ product.metafields.custom.product_details_sub_details | metafield_tag }}
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
        {%- assign first_item_active = false -%}
      {% endif %}

      <!-- Automated FAQ Integration -->
      {% if product.metafields.custom.faq.value != blank %}
        {%- for faq_item in product.metafields.custom.faq.value -%}
          {%- capture row_type -%}{%- cycle 'question', 'answer' -%}{%- endcapture -%}
          {%- if row_type == 'question' -%}
            <div class="faq-item{% if first_item_active %} active{% endif %}">
              <button class="faq-question" type="button" aria-expanded="{% if first_item_active %}true{% else %}false{% endif %}">
                <div class="faq-question__copy">
                  <span class="faq-question__eyebrow">FAQ</span>
                  <span class="faq-question__title">{{ faq_item }}</span>
                </div>
                <span class="faq-question__icon" aria-hidden="true" style="margin-left: auto;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-icon"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </span>
              </button>
          {%- else -%}
              <div class="faq-answer" aria-hidden="{% if first_item_active %}false{% else %}true{% endif %}" {% if first_item_active %}style="display: block;"{% endif %}>
                <div class="faq-answer__inner">
                  <div class="meta-fields-details">
                    <p class="sp-16">{{ faq_item }}</p>
                  </div>
                </div>
              </div>
            </div>
            {%- assign first_item_active = false -%}
          {%- endif -%}
        {%- endfor -%}
      {% endif %}

    </div>
  </div>
</div>

{%- comment -%}
  Unified JSON-LD FAQ Schema
  This script handles SEO for ALL accordion items (Features, Specs, and FAQs).
{%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {%- assign schema_items = "" -%}
    
    {%- if product.metafields.custom.product_details_features -%}
      {%- capture item -%}
      {
        "@type": "Question",
        "name": "What are the main features of {{ product.title }}?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "{{ product.metafields.custom.product_details_features.value | join: ', ' | escape }}"
        }
      }
      {%- endcapture -%}
      {%- assign schema_items = schema_items | append: item -%}
    {%- endif -%}

    {%- if product.metafields.custom.product_details_specifications_name -%}
      {%- capture item -%}
      {%- if schema_items != "" -%},{%- endif -%}
      {
        "@type": "Question",
        "name": "What are the technical specifications for {{ product.title }}?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "{%- assign spec_names = product.metafields.custom.product_details_specifications_name.value -%}{%- assign spec_vals = product.metafields.custom.product_details_specification_values.value -%}{%- for name in spec_names -%}{{ name }}: {{ spec_vals[forloop.index0] }}{%- unless forloop.last -%}; {% endunless %}{%- endfor -%}"
        }
      }
      {%- endcapture -%}
      {%- assign schema_items = schema_items | append: item -%}
    {%- endif -%}

    {%- if product.metafields.custom.faq.value != blank -%}
      {%- for faq_item in product.metafields.custom.faq.value -%}
        {%- capture row_type -%}{%- cycle 'question', 'answer' -%}{%- endcapture -%}
        {%- if row_type == 'question' -%}
          {%- if schema_items != "" -%},{%- endif -%}
          {
            "@type": "Question",
            "name": {{ faq_item | json }},
            "acceptedAnswer": {
              "@type": "Answer",
              "text": 
        {%- else -%}
              {{ faq_item | strip_html | json }}
            }
          }
          {%- capture item -%}{%- endcapture -%}
          {%- assign schema_items = schema_items | append: item -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}

    {{ schema_items }}
  ]
}
</script>
