<!-- === HEADER MOBILE (slide menu) === -->
<div class="mobile-header d-lg-none">
  <div class="m-bar">
    <div class="m-left">
      <button class="m-btn m-burger" id="mBurger" aria-label="Open menu">
        <svg viewBox="0 0 24 24" width="26" height="26"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
      </button>
      <button class="m-btn m-search" id="mSearch" aria-label="Search">
        <svg viewBox="0 0 24 24" width="22" height="22"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none"/><path d="M20 20L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
    </div>

    <a href="{{ routes.root_url }}" class="m-logo-wrap">
      {{ settings.logo | image_url: width: 320 | image_tag: class: 'm-logo', alt: shop.name }}
    </a>

    <a class="m-btn m-cart" href="{{ routes.cart_url }}" aria-label="Cart">
      <svg viewBox="0 0 24 24" width="24" height="24"><path d="M4 6h2l2.5 9h9L20 8H7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/><circle cx="10" cy="19" r="1.5"/><circle cx="17" cy="19" r="1.5"/></svg>
      {% if cart != empty %}<span class="m-bubble">{{ cart.item_count }}</span>{% endif %}
    </a>
  </div>

  <!-- Slide Menu -->
  <div class="m-overlay"></div>
  <nav class="m-drawer">
    <div class="m-drawer-head">
      <button class="m-back" type="button">‹</button>
      <span class="m-title">Menu</span>
      <button class="m-close" type="button">×</button>
    </div>

    <ul class="m-menu">
      {% for link in linklists['main-menu'].links %}
        <li class="m-item">
          <a href="{{ link.url }}" class="m-link">
            {% assign index = forloop.index0 %}
            {% assign key = "menu_icon_" | append: index %}
            {% assign icon = section.settings[key] %}
            {% if icon != blank %}
              <img src="{{ icon | image_url: width: 40 }}" alt="{{ link.title }}" class="m-icon">
            {% endif %}
            <span>{{ link.title }}</span>
          </a>
          {% if link.links.size > 0 %}
            <button class="m-next">›</button>
            <ul class="m-sub">
              {% for sublink in link.links %}
                <li><a href="{{ sublink.url }}">{{ sublink.title }}</a></li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </nav>
</div>

<style>
.mobile-header{position:relative;z-index:9999;}
.m-bar{display:grid;grid-template-columns:auto 1fr auto;align-items:center;padding:8px 10px;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.05);}
.m-btn{background:none;border:0;display:grid;place-items:center;color:#222;}
.m-logo{max-height:28px;}
.m-bubble{background:#1761a2;color:#fff;font-size:11px;border-radius:50%;padding:0 5px;margin-left:2px;}
.m-overlay{position:fixed;inset:0;background:rgba(0,0,0,.3);opacity:0;pointer-events:none;transition:opacity .3s;}
.m-overlay.active{opacity:1;pointer-events:auto;}
.m-drawer{position:fixed;top:0;bottom:0;left:0;width:80%;max-width:340px;background:#fff;transform:translateX(-100%);transition:transform .3s ease;overflow-y:auto;}
.m-drawer.active{transform:translateX(0);}
.m-drawer-head{display:flex;justify-content:space-between;align-items:center;padding:14px;border-bottom:1px solid #eee;}
.m-menu{list-style:none;margin:0;padding:0;}
.m-item{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #eee;}
.m-link{display:flex;align-items:center;gap:10px;padding:14px;text-decoration:none;color:#111;font:600 15px/1.3 'Barlow',sans-serif;}
.m-icon{width:28px;height:28px;object-fit:contain;}
.m-sub{display:none;padding-left:24px;}
.m-item.open>.m-sub{display:block;}
.m-next,.m-close,.m-back{background:none;border:0;font-size:22px;color:#444;cursor:pointer;}
.m-back{display:none;margin-right:auto;}
</style>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  const burger=document.getElementById('mBurger');
  const overlay=document.querySelector('.m-overlay');
  const drawer=document.querySelector('.m-drawer');
  const closeBtn=document.querySelector('.m-close');
  const backBtn=document.querySelector('.m-back');
  const items=document.querySelectorAll('.m-item');

  const open=()=>{drawer.classList.add('active');overlay.classList.add('active');document.body.classList.add('nav-locked');};
  const close=()=>{drawer.classList.remove('active');overlay.classList.remove('active');document.body.classList.remove('nav-locked');items.forEach(i=>i.classList.remove('open'));backBtn.style.display='none';};

  burger.addEventListener('click',open);
  overlay.addEventListener('click',close);
  closeBtn.addEventListener('click',close);

  items.forEach(li=>{
    const next=li.querySelector('.m-next');
    const sub=li.querySelector('.m-sub');
    if(next&&sub){
      next.addEventListener('click',()=>{li.classList.add('open');backBtn.style.display='block';});
    }
  });
  backBtn.addEventListener('click',()=>{items.forEach(li=>li.classList.remove('open'));backBtn.style.display='none';});
});
</script>

